/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/base/Log","sap/base/util/uid","sap/base/strings/escapeRegExp"],function(e,i,r,t){"use strict";(function(n){var s="_skip",a=/\|id-[0-9]+-[0-9]+/,o=new RegExp(s+"[0-9]*$"),f=[],u=[],h={},l=0,c,p="|",d=[],y=false,g,v=false;e.sap.history=function(i){if(!e.isPlainObject(i)){return}if(!v){var r=e(n),t=n.location.href.split("#")[1]||"";r.on("hashchange",b);if(Array.isArray(i.routes)){var s,a;for(s=0;s<i.routes.length;s++){a=i.routes[s];if(a.path&&a.handler){e.sap.history.addRoute(a.path,a.handler)}}}if(e.isFunction(i.defaultHandler)){g=i.defaultHandler}u.push(t);if(t.length>1){r.trigger("hashchange",[true])}else{c=t}v=true}};e.sap.history.addHistory=function(e,i,r,t){var s,a;if(r===undefined){r=true}if(!t){a=T(e,i);s=m(a);if(s){a+=p+s}a+=p+(r?"1":"0")}else{a=O(c)}d.push(a);h[a]=true;n.location.hash=a;return a};e.sap.history.addVirtualHistory=function(){e.sap.history.addHistory("",undefined,false,true)};e.sap.history.addRoute=function(i,r,t){if(t){r=e.proxy(r,t)}var n={};n.sIdentifier=i;n["action"]=r;f.push(n);return this};e.sap.history.setDefaultHandler=function(e){g=e};e.sap.history.getDefaultHandler=function(){return g};e.sap.history.backToHash=function(r){r=r||"";var t;if(u.length===1){if(e.isFunction(g)){g()}}else{t=k(c,r);if(t<0){n.history.go(t)}else{i.error("jQuery.sap.history.backToHash: "+r+"is not in the history stack or it's after the current hash")}}};e.sap.history.backThroughPath=function(r){r=r||"";r=n.encodeURIComponent(r);var t;if(u.length===1){if(e.isFunction(g)){g()}}else{t=k(c,r,true);if(t<0){n.history.go(t)}else{i.error("jQuery.sap.history.backThroughPath: there's no history state which has the "+r+" identifier in the history stack before the current hash")}}};e.sap.history.back=function(i){if(u.length===1){if(e.isFunction(g)){g(e.sap.history.NavType.Back)}}else{if(!i){i=1}n.history.go(-1*i)}};e.sap.history.NavType={Back:"_back",Forward:"_forward",Bookmark:"_bookmark",Unknown:"_unknown"};function k(e,i,r){var t=u.indexOf(e),n,s,a;if(t>0){if(r){for(s=t-1;s>=0;s--){a=u[s];if(a.indexOf(i)===0&&!B(a)){return s-t}}}else{n=u.indexOf(i);if(n===-1&&i.length===0){return-1*t}if(n>-1&&n<t){return n-t}}}return 0}function b(e,i){var r=n.location.href.split("#")[1]||"";r=x(r);if(i||!h[r]){d.push(r)}if(!y){y=true;if(d.length>0){var t=d.shift();if(h[t]){I(t);delete h[t]}else{N(t)}c=t}y=false}}function x(e,i){var r=e,t=e?e.indexOf("#"):-1;if(t===0){r=r.slice(t+1)}if(i){r=r.replace(a,"")}return r}function O(e){var i=e?e:"";if(B(i)){var r=i.lastIndexOf(s);i=i.slice(0,r)}return i+s+l++}function T(e,i){var r=n.encodeURIComponent(e);var t=n.encodeURIComponent(n.JSON.stringify(i));return r+p+t}function m(e){var i=u.indexOf(c),t,n;if(i>-1){for(t=0;t<i+1;t++){n=u[t];if(n.slice(0,n.length-2)===e){return r()}}}return""}function I(e){var i=u.indexOf(c);if(!(i===-1||i===u.length-1)){u.splice(i+1,u.length-1-i)}u.push(e)}function B(e){return o.test(e)}function H(e,i){var r=u.indexOf(e),t;if(r!==-1){if(i){for(t=r;t<u.length;t++){if(!B(u[t])){return t-r}}}else{for(t=r;t>=0;t--){if(!B(u[t])){return t-r}}return-1*(r+1)}}}function N(r){var a,o,f,h,l;if(c===undefined){f=w(r);if(!f||!f.bBookmarkable){if(e.isFunction(g)){g(e.sap.history.NavType.Bookmark)}return}}if(r.length===0){if(e.isFunction(g)){g(e.sap.history.NavType.Back)}}else{h=u.indexOf(r);if(h===0){f=w(r);if(!f||!f.bBookmarkable){if(e.isFunction(g)){g(e.sap.history.NavType.Back)}return}}if(B(r)){if(B(c)){o=H(r,false);n.history.go(o)}else{var p=new RegExp(t(c+s)+"[0-9]*$");if(p.test(r)){o=H(r,true);if(o){n.history.go(o)}else{n.history.back()}}else{o=H(r,false);n.history.go(o)}}}else{if(h===-1){l=e.sap.history.NavType.Unknown;u.push(r)}else{if(u.indexOf(c,h+1)===-1){l=e.sap.history.NavType.Forward}else{l=e.sap.history.NavType.Back}}f=w(r);if(f){a=R(f.sIdentifier);if(a){a.action.apply(null,[f.oStateData,l])}}else{i.error("hash format error! The current Hash: "+r)}}}}function R(e){var i;for(i=0;i<f.length;i++){if(f[i].sIdentifier===e){return f[i]}}}function w(e){if(B(e)){var i=e.lastIndexOf(s);e=e.slice(0,i)}var r=e.split(p),t={};if(r.length===4||r.length===3){t.sIdentifier=n.decodeURIComponent(r[0]);t.oStateData=n.JSON.parse(n.decodeURIComponent(r[1]));if(r.length===4){t.uid=r[2]}t.bBookmarkable=r[r.length-1]==="0"?false:true;return t}else{return null}}})(this);return e});