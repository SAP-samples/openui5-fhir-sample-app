/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/model/Filter"],function(e){"use strict";var r={grandTotal:"boolean",max:"boolean",min:"boolean",name:"string",subtotals:"boolean",with:"string"},t={aggregate:"object",group:"object",groupLevels:"array"},n;function i(e,r,t){var n;function i(e){if(t){e+=" at property: "+t}throw new Error(e)}function o(e){return Array.isArray(e)?"array":typeof e}for(n in e){if(!(r&&n in r)){i("Unsupported '"+n+"'")}else if(o(e[n])!==r[n]){i("Not a "+r[n]+" value for '"+n+"'")}}}function o(e,r){var t;for(t in e){i(e[t],r,t)}}n={buildApply:function(e,n,a,g){var f,u="",s=[],l,p,c;function d(r){var t=e.aggregate[r],i=t.name||r,o=r,a=t.with;if(a){if((a==="average"||a==="countdistinct")&&(t.grandTotal||t.subtotals)){throw new Error("Cannot aggregate totals with '"+a+"'")}i+=" with "+a+" as "+r}else if(t.name){i+=" as "+r}if(!g){if(t.min){$(r,"min")}if(t.max){$(r,"max")}}if(t.grandTotal){p=true;if(!n.$skip){if(a){o+=" with "+a+" as UI5grand__"+r}s.push(o)}}return i}function h(r){return e.groupLevels.indexOf(r)<0}function $(e,r){var t="UI5"+r+"__"+e;s.push(e+" with "+r+" as "+t);if(a){a[t]={measure:e,method:r}}}function b(){var e="";if(n.$skip){e="skip("+n.$skip+")"}delete n.$skip;if(n.$top<Infinity){if(e){e+="/"}e+="top("+n.$top+")"}delete n.$top;return e}n=Object.assign({},n);i(e,t);e.groupLevels=e.groupLevels||[];if(e.groupLevels.length>1){throw new Error("More than one group level: "+e.groupLevels)}e.aggregate=e.aggregate||{};o(e.aggregate,r);f=Object.keys(e.aggregate).sort().map(d);if(p&&e.groupLevels.length){throw new Error("Cannot combine visual grouping with grand total")}if(f.length){u="aggregate("+f.join(",")+")"}e.group=e.group||{};o(e.group);l=e.groupLevels.concat(Object.keys(e.group).sort().filter(h));if(l.length){u="groupby(("+l.join(",")+(u?"),"+u+")":"))")}if(g){delete n.$count}else if(n.$count){s.push("$count as UI5__count");delete n.$count}if(n.$$filterBeforeAggregate){u="filter("+n.$$filterBeforeAggregate+")/"+u;delete n.$$filterBeforeAggregate}if(n.$filter){u+="/filter("+n.$filter+")";delete n.$filter}if(n.$orderby){u+="/orderby("+n.$orderby+")";delete n.$orderby}if(p){if(n.$skip){n.$skip-=1}else{n.$top-=1}}c=b();if(s.length){u+="/concat(aggregate("+s.join(",")+"),"+(c||"identity")+")"}else if(c){u+="/"+c}if(u){n.$apply=u}return n},hasGrandTotal:function(e){return!!e&&Object.keys(e).some(function(r){return e[r].grandTotal})},hasMinOrMax:function(e){return!!e&&Object.keys(e).some(function(r){var t=e[r];return t.min||t.max})},splitFilter:function(r,t){var n=[],i=[];function o(e){return e.aFilters?e.aFilters.some(o):e.sPath in t.aggregate}function a(e){if(e.aFilters&&e.bAnd){e.aFilters.forEach(a)}else{(o(e)?n:i).push(e)}}function g(r){return r.length>1?new e(r,true):r[0]}if(!t||!t.aggregate){return[r]}a(r);return[g(n),g(i)]}};return n},false);