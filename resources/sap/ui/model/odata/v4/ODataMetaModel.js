/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./ValueListType","./lib/_Helper","sap/base/assert","sap/base/Log","sap/base/util/JSTokenizer","sap/base/util/ObjectPath","sap/ui/base/SyncPromise","sap/ui/model/BindingMode","sap/ui/model/ChangeReason","sap/ui/model/ClientListBinding","sap/ui/model/Context","sap/ui/model/ContextBinding","sap/ui/model/MetaModel","sap/ui/model/PropertyBinding","sap/ui/model/odata/OperationMode","sap/ui/model/odata/type/Boolean","sap/ui/model/odata/type/Byte","sap/ui/model/odata/type/Date","sap/ui/model/odata/type/DateTimeOffset","sap/ui/model/odata/type/Decimal","sap/ui/model/odata/type/Double","sap/ui/model/odata/type/Guid","sap/ui/model/odata/type/Int16","sap/ui/model/odata/type/Int32","sap/ui/model/odata/type/Int64","sap/ui/model/odata/type/Raw","sap/ui/model/odata/type/SByte","sap/ui/model/odata/type/Single","sap/ui/model/odata/type/Stream","sap/ui/model/odata/type/String","sap/ui/model/odata/type/TimeOfDay","sap/ui/thirdparty/URI"],function(e,t,n,i,r,o,a,s,u,f,l,c,d,p,h,m,y,g,v,$,C,O,M,b,P,w,x,U,E,S,T,A){"use strict";var j,L=new Map,D=i.Level.DEBUG,I=/\$\(/g,R=/^-?\d+$/,V,q,N="sap.ui.model.odata.v4.ODataMetaModel",k,B=/\(.*\)$/,W=new w,F=/\$\)/g,_=new Map,G={messageChange:true},z={"Edm.Boolean":{Type:m},"Edm.Byte":{Type:y},"Edm.Date":{Type:g},"Edm.DateTimeOffset":{constraints:{$Precision:"precision"},Type:v},"Edm.Decimal":{constraints:{"@Org.OData.Validation.V1.Minimum/$Decimal":"minimum","@Org.OData.Validation.V1.Minimum@Org.OData.Validation.V1.Exclusive":"minimumExclusive","@Org.OData.Validation.V1.Maximum/$Decimal":"maximum","@Org.OData.Validation.V1.Maximum@Org.OData.Validation.V1.Exclusive":"maximumExclusive",$Precision:"precision",$Scale:"scale"},Type:$},"Edm.Double":{Type:C},"Edm.Guid":{Type:O},"Edm.Int16":{Type:M},"Edm.Int32":{Type:b},"Edm.Int64":{Type:P},"Edm.SByte":{Type:x},"Edm.Single":{Type:U},"Edm.Stream":{Type:E},"Edm.String":{constraints:{"@com.sap.vocabularies.Common.v1.IsDigitSequence":"isDigitSequence",$MaxLength:"maxLength"},Type:S},"Edm.TimeOfDay":{constraints:{$Precision:"precision"},Type:T}},K={},H="@com.sap.vocabularies.Common.v1.ValueList",J="@com.sap.vocabularies.Common.v1.ValueListMapping",Q="@com.sap.vocabularies.Common.v1.ValueListReferences",X="@com.sap.vocabularies.Common.v1.ValueListWithFixedValues",Y=i.Level.WARNING;function Z(e,t,n,i){var r,o=e.mSchema2MetadataUrl[t];if(!o){o=e.mSchema2MetadataUrl[t]={};o[n]=false}else if(!(n in o)){r=Object.keys(o)[0];if(o[r]){oe(e,"A schema cannot span more than one document: "+t+" - expected reference URI "+r+" but instead saw "+n,i)}o[n]=false}}function ee(e,t,n,i){var r,o,s,u;function f(e){var r,a;if(!(n in e)){i(Y,o," does not contain ",n);return}i(D,"Including ",n," from ",o);for(a in e){if(a[0]!=="$"&&ae(a)===n){r=e[a];t[a]=r;re(r,t.$Annotations)}}}if(n in t){return t[n]}u=e.mSchema2MetadataUrl[n];if(u){s=Object.keys(u);if(s.length>1){oe(e,"A schema cannot span more than one document: "+"schema is referenced by following URLs: "+s.join(", "),n)}o=s[0];u[o]=true;i(D,"Namespace ",n," found in $Include of ",o);r=e.mMetadataUrl2Promise[o];if(!r){i(D,"Reading ",o);r=e.mMetadataUrl2Promise[o]=a.resolve(e.oRequestor.read(o)).then(e.validate.bind(e,o))}r=r.then(f);if(n in t){return t[n]}t[n]=r;return r}}function te(e,t){if(e===t){return""}if(e.indexOf(t)===0&&e[t.length]==="#"&&e.indexOf("@",t.length)<0){return e.slice(t.length+1)}}function ne(e){var t=te(e,J);return t!==undefined?t:te(e,H)}function ie(e,t){return t.some(function(t){return e==="$ReturnType"?t.$ReturnType:t.$Parameter&&t.$Parameter.some(function(t){return t.$Name===e})})}function re(e,t,n){var i;function r(e,t){var i;for(i in t){if(n||!(i in e)){e[i]=t[i]}}}for(i in e.$Annotations){if(!(i in t)){t[i]={}}r(t[i],e.$Annotations[i])}delete e.$Annotations}function oe(e,t,n){var i=new Error(n+": "+t);e.oModel.reportError(t,N,i);throw i}function ae(e){return e.slice(0,e.lastIndexOf(".")+1)}V=c.extend("sap.ui.model.odata.v4.ODataMetaContextBinding",{constructor:function(e,t,i){n(!i||i.getModel()===e,"oContext must belong to this model");c.call(this,e,t,i)},initialize:function(){var e=this.oModel.createBindingContext(this.sPath,this.oContext);this.bInitial=false;if(e!==this.oElementContext){this.oElementContext=e;this._fireChange()}},setContext:function(e){n(!e||e.getModel()===this.oModel,"oContext must belong to this model");if(e!==this.oContext){this.oContext=e;if(!this.bInitial){this.initialize()}}}});q=f.extend("sap.ui.model.odata.v4.ODataMetaListBinding",{constructor:function(){f.apply(this,arguments)},_fireFilter:function(){},_fireSort:function(){},checkUpdate:function(e){var t=this.oList.length;this.update();if(e||this.oList.length!==t){this._fireChange({reason:u.Change})}},fetchContexts:function(){var e,t=this.oModel.resolve(this.sPath,this.oContext),n=this;if(!t){return a.resolve([])}e=t.endsWith("@");if(!e&&!t.endsWith("/")){t+="/"}return this.oModel.fetchObject(t).then(function(i){if(!i){return[]}if(e){t=t.slice(0,-1)}return Object.keys(i).filter(function(t){return t[0]!=="$"&&e!==(t[0]!=="@")}).map(function(e){return new l(n.oModel,t+e)})})},getContexts:function(e,t){this.iCurrentStart=e||0;this.iCurrentLength=Math.min(t||Infinity,this.iLength-this.iCurrentStart,this.oModel.iSizeLimit);return this.getCurrentContexts()},getCurrentContexts:function(){var e=[],t,n=this.iCurrentStart+this.iCurrentLength;for(t=this.iCurrentStart;t<n;t+=1){e.push(this.oList[this.aIndices[t]])}if(this.oList.dataRequested){e.dataRequested=true}return e},setContexts:function(e){this.oList=e;this.updateIndices();this.applyFilter();this.applySort();this.iLength=this._getLength()},update:function(){var e=[],t=this.fetchContexts(),n=this;if(t.isFulfilled()){e=t.getResult()}else{t.then(function(e){n.setContexts(e);n._fireChange({reason:u.Change})});e.dataRequested=true}this.setContexts(e)}});k=p.extend("sap.ui.model.odata.v4.ODataMetaPropertyBinding",{constructor:function(){p.apply(this,arguments);this.vValue=undefined},checkUpdate:function(e,t){var n,i=this;function r(n){if(e||n!==i.vValue){i.vValue=n;i._fireChange({reason:t||u.Change})}return n}n=this.oModel.fetchObject(this.sPath,this.oContext,this.mParameters).then(r);if(this.mParameters&&this.mParameters.$$valueAsPromise&&n.isPending()){r(n.unwrap())}else if(n.isRejected()){n.unwrap()}},getValue:function(){return this.vValue},setContext:function(e){if(this.oContext!==e){this.oContext=e;if(this.bRelative){this.checkUpdate(false,u.Context)}}},setValue:function(){throw new Error("Unsupported operation: ODataMetaPropertyBinding#setValue")}});var se=d.extend("sap.ui.model.odata.v4.ODataMetaModel",{constructor:function(e,t,n,i,r){d.call(this);this.aAnnotationUris=n&&!Array.isArray(n)?[n]:n;this.sDefaultBindingMode=s.OneTime;this.mETags={};this.dLastModified=new Date(0);this.oMetadataPromise=null;this.oModel=i;this.mMetadataUrl2Promise={};this.oRequestor=e;this.mSchema2MetadataUrl={};this.mSupportedBindingModes={OneTime:true,OneWay:true};this.bSupportReferences=r!==false;this.mUnsupportedFilterOperators={All:true,Any:true};this.sUrl=t}});se.prototype.$$valueAsPromise=true;se.prototype._mergeAnnotations=function(e,t){var n=this;this.validate(this.sUrl,e);e.$Annotations={};Object.keys(e).forEach(function(t){if(e[t].$kind==="Schema"){Z(n,t,n.sUrl);re(e[t],e.$Annotations)}});t.forEach(function(t,i){var r,o;n.validate(n.aAnnotationUris[i],t);for(o in t){if(o[0]!=="$"){if(o in e){oe(n,"A schema cannot span more than one document: "+o,n.aAnnotationUris[i])}r=t[o];e[o]=r;if(r.$kind==="Schema"){Z(n,o,n.aAnnotationUris[i]);re(r,e.$Annotations,true)}}}})};se.prototype.attachEvent=function(e){if(!(e in G)){throw new Error("Unsupported event '"+e+"': v4.ODataMetaModel#attachEvent")}return d.prototype.attachEvent.apply(this,arguments)};se.prototype.bindContext=function(e,t){return new V(this,e,t)};se.prototype.bindList=function(e,t,n,i){return new q(this,e,t,n,i)};se.prototype.bindProperty=function(e,t,n){return new k(this,e,t,n)};se.prototype.bindTree=function(){throw new Error("Unsupported operation: v4.ODataMetaModel#bindTree")};se.prototype.fetchCanonicalPath=function(e){return this.fetchUpdateData("",e).then(function(t){if(!t.editUrl){throw new Error(e.getPath()+": No canonical path for transient entity")}if(t.propertyPath){throw new Error("Context "+e.getPath()+" does not point to an entity. It should be "+t.entityPath)}return"/"+t.editUrl})};se.prototype.fetchData=function(){return this.fetchEntityContainer().then(function(e){return JSON.parse(JSON.stringify(e))})};se.prototype.fetchEntityContainer=function(e){var t,n=this;if(!this.oMetadataPromise){t=[a.resolve(this.oRequestor.read(this.sUrl,false,e))];if(this.aAnnotationUris){this.aAnnotationUris.forEach(function(i){t.push(a.resolve(n.oRequestor.read(i,true,e)))})}if(!e){this.oMetadataPromise=a.all(t).then(function(e){var t=e[0];n._mergeAnnotations(t,e.slice(1));return t})}}return this.oMetadataPromise};se.prototype.fetchObject=function(e,t,n){var s=this.resolve(e,t),u=this;if(!s){i.error("Invalid relative path w/o context",e,N);return a.resolve(null)}return this.fetchEntityContainer().then(function(f){var c,d,p,h,m,y,g,v,$;function C(e,t,n){var i,r,o,a,s="";if(t){r=t.indexOf("@@");if(r>0){t=t.slice(0,r)}}else{t=e}n=n||"";if(c){y=a=$.filter(b);if(a.length!==1){return P(Y,"Expected a single overload, but found "+a.length)}if(c!==K){s=a[0].$Parameter[0].$isCollection?"Collection("+c+")":c}o=v+"("+s+")"+n;if(f.$Annotations[o]){if(t==="@"){$=f.$Annotations[o];i=f.$Annotations[v+n];if(i){$=Object.assign({},i,$)}return false}if(t in f.$Annotations[o]){v=o;$=f;return true}}}v+=n;$=f;return true}function O(e,t){var i,a,s,f=e.indexOf("@",2);if(f>-1){return P(Y,"Unsupported path after ",e.slice(0,f))}e=e.slice(2);s=e.indexOf("(");if(s>0){if(!e.endsWith(")")){return P(Y,"Expected ')' instead of '",e.slice(-1),"'")}try{a=r.parseJS("["+e.slice(s+1,-1).replace(I,"{").replace(F,"}")+"]")}catch(e){return P(Y,e.message,": ",e.text.slice(1,e.at),"<--",e.text.slice(e.at,-1))}e=e.slice(0,s)}i=e[0]==="."?o.get(e.slice(1),n.scope):n&&o.get(e,n.scope)||(e==="requestCurrencyCodes"||e==="requestUnitsOfMeasure"?u[e].bind(u):o.get(e));if(typeof i!=="function"){return P(Y,e," is not a function but: "+i)}try{$=i($,{$$valueAsPromise:n&&n.$$valueAsPromise,arguments:a,context:new l(u,t),schemaChildName:g,overload:y.length===1?y[0]:undefined})}catch(t){P(Y,"Error calling ",e,": ",t)}return true}function M(e,t){var n;if(e==="$ReturnType"){if(t.$ReturnType){$=t.$ReturnType;return true}}else if(e&&t.$Parameter){n=t.$Parameter.filter(function(t){return t.$Name===e});if(n.length){$=n[0];return true}}return false}function b(e){return!e.$IsBound&&c===K||e.$IsBound&&c===e.$Parameter[0].$Type}function P(e){var t;if(i.isLoggable(e,N)){t=Array.isArray(p)?p.join("/"):p;i[e===D?"debug":"warning"](Array.prototype.slice.call(arguments,1).join("")+(t?" at /"+t:""),s,N)}if(e===Y){$=undefined}return false}function w(e,t){var n;function i(){p=p||v&&t&&v+"/"+t;return P.apply(this,arguments)}c=$&&$.$Type||c;if(u.bSupportReferences&&!(e in f)){n=ae(e);$=ee(u,f,n,i)}if(e in f){v=h=g=e;$=y=f[g];if(!a.isThenable($)){return true}}if(a.isThenable($)&&$.isPending()){return i(D,"Waiting for ",n)}return i(Y,"Unknown qualified name ",e)}function x(e,t,n){var i,r;if(e==="$Annotations"){return P(Y,"Invalid segment: $Annotations")}if(t&&typeof $==="object"&&e in $){if(e[0]==="$"||R.test(e)){m=false}}else{i=e.indexOf("@@");if(i<0){if(e.endsWith("@sapui.name")){i=e.length-11}else{i=e.indexOf("@")}}if(i>0){if(!x(e.slice(0,i),t,n)){return false}e=e.slice(i);r=true}if(typeof $==="string"&&!(r&&(e==="@sapui.name"||e[1]==="@"))&&!U($,n.slice(0,t))){return false}if(m){if(e[0]==="$"&&e!=="$Parameter"&&e!=="$ReturnType"||R.test(e)){m=false}else{if(r){}else if(e[0]!=="@"&&e.indexOf(".")>0){return w(e)}else if($&&"$Type"in $){if(!w($.$Type,"$Type")){return false}}else if($&&"$Action"in $){if(!w($.$Action,"$Action")){return false}c=K}else if($&&"$Function"in $){if(!w($.$Function,"$Function")){return false}c=K}else if(!t){v=h=g=g||f.$EntityContainer;$=y=y||f[g];if(Array.isArray($)&&M(e,$[0])){return true}if(e&&e[0]!=="@"&&!(e in y)){return P(Y,"Unknown child ",e," of ",g)}}if(Array.isArray($)){if(e==="$Parameter"){return true}if(e.startsWith("@$ui5.overload@")){e=e.slice(14);r=true}if(r){if(e[1]!=="@"&&!C(e)){return false}}else{if(e!==n[t]&&n[t][e.length+1]!=="@"&&ie(e,$)){h=e;return C(e,n[t].slice(e.length),"/"+h)}if(c){$=$.filter(b)}if(e==="@$ui5.overload"){return true}if($.length!==1){return P(Y,"Expected a single overload, but found "+$.length)}if(M(e,$[0])){return true}$=$[0].$ReturnType;v+="/0/$ReturnType";if($){if(e==="value"&&!(f[$.$Type]&&f[$.$Type].value)){h=undefined;return true}if(!w($.$Type,"$Type")){return false}}if(!e){return true}}}}}if(!e){return t+1>=n.length||P(Y,"Invalid empty segment")}if(e[0]==="@"){if(e==="@sapui.name"){$=h;if($===undefined){P(Y,"Unsupported path before @sapui.name")}else if(t+1<n.length){P(Y,"Unsupported path after @sapui.name")}return false}if(e[1]==="@"){if(t+1<n.length){return P(Y,"Unsupported path after ",e)}return O(e,[""].concat(n.slice(0,t),n[t].slice(0,i)).join("/"))}}if(!$||typeof $!=="object"){$=undefined;return!d&&P(D,"Invalid segment: ",e)}if(m&&e[0]==="@"){c=$.$Type||c;$=f.$Annotations[v]||{};m=false}else if(e==="$"&&t+1<n.length){return P(Y,"Unsupported path after $")}}if(e!=="@"&&e!=="$"){if(e[0]==="@"){d=true}h=m||e[0]==="@"?e:undefined;v=m?v+"/"+e:undefined;$=$[e]}return true}function U(e,t){var n;if(p){return P(Y,"Invalid recursion")}p=t;d=false;m=true;$=f;n=e.split("/").every(x);p=undefined;return n}if(!U(s.slice(1))&&a.isThenable($)){$=$.then(function(){return u.fetchObject(e,t,n)})}return $})};se.prototype.fetchUI5Type=function(e){var t=this.getMetaContext(e),n=this;if(e.endsWith("/$count")){j=j||new P;return a.resolve(j)}return this.fetchObject(undefined,t).catch(function(){}).then(function(r){var o=W,a;if(!r){i.warning("No metadata for path '"+e+"', using "+o.getName(),undefined,N);return o}if(r["$ui5.type"]){return r["$ui5.type"]}if(r.$isCollection){i.warning("Unsupported collection type, using "+o.getName(),e,N)}else{a=z[r.$Type];if(a){o=new a.Type(undefined,n.getConstraints(r,t.getPath()))}else{i.warning("Unsupported type '"+r.$Type+"', using "+o.getName(),e,N)}}r["$ui5.type"]=o;return o})};se.prototype.fetchUpdateData=function(e,n,i){var r=n.getModel(),o=r.resolve(e,n),s=this;function u(e){var t=new Error(o+": "+e);r.reportError(e,N,t);throw t}return this.fetchObject(this.getMetaPath(o)).then(function(){return s.fetchEntityContainer()}).then(function(r){var s,f=r[r.$EntityContainer],l,c,d,p,h,m,y,g;function v(e){var t=e.indexOf("(");return t>=0?e.slice(t):""}function $(e){s.push({path:h,prefix:e,type:g})}function C(e){var t=e.indexOf("(");return t>=0?e.slice(0,t):e}function O(e){if(e.includes("($uid=")){$(C(e))}else{s.push(e)}}y=o.slice(1).split("/");p=y.shift();h="/"+p;l=h;d=decodeURIComponent(C(p));c=f[d];if(!c){u("Not an entity set: "+d)}g=r[c.$Type];e="";m="";s=[];O(p);y.forEach(function(n){var i,o;h+="/"+n;if(R.test(n)){$(s.pop());l+="/"+n}else{o=decodeURIComponent(C(n));m=t.buildPath(m,o);i=g[o];if(!i){u("Not a (navigation) property: "+o)}g=r[i.$Type];if(i.$kind==="NavigationProperty"){if(c.$NavigationPropertyBinding&&m in c.$NavigationPropertyBinding){d=c.$NavigationPropertyBinding[m];c=f[d];m="";s=[encodeURIComponent(d)+v(n)];if(!i.$isCollection){$(s.pop())}}else{O(n)}l=h;e=""}else{e=t.buildPath(e,n)}}});if(i){return a.resolve({editUrl:undefined,entityPath:l,propertyPath:e})}return a.all(s.map(function(e){if(typeof e==="string"){return e}return n.fetchValue(e.path).then(function(n){var r;if(!n){u("No instance to calculate key predicate at "+e.path)}if(t.hasPrivateAnnotation(n,"transient")){i=true;return undefined}r=t.getPrivateAnnotation(n,"predicate");if(!r){u("No key predicate known at "+e.path)}return e.prefix+r},function(t){u(t.message+" at "+e.path)})})).then(function(t){return{editUrl:i?undefined:t.join("/"),entityPath:l,propertyPath:e}})})};se.prototype.fetchValueListMappings=function(e,n,i,r){var o=this,a=e.getMetaModel();function s(){var e=r[0],t="";if(r.length!==1){throw new Error("Expected a single overload, but found "+r.length)}if(e.$IsBound){t=e.$Parameter[0].$isCollection?"Collection("+e.$Parameter[0].$Type+")":e.$Parameter[0].$Type}return n+"("+t+")"}return a.fetchEntityContainer().then(function(r){var u,f=r.$Annotations,l,c=t.namespace(n),d={},p=o===a,h,m;if(i.$Name){l=s()+"/"+i.$Name;m=n+"/"+i.$Name}h=Object.keys(f).filter(function(n){if(t.namespace(n)===c){if(l?n===l||n===m:o.getObject("/"+n)===i){return true}if(p||m&&t.getMetaPath(n)===m){return false}throw new Error("Unexpected annotation target '"+n+"' with namespace of data service in "+e.sServiceUrl)}return false});if(!h.length){throw new Error("No annotation '"+H.slice(1)+"' in "+e.sServiceUrl)}if(h.length===1){u=f[h[0]]}else{u=Object.assign({},f[m],f[l])}Object.keys(u).forEach(function(t){var n=ne(t);if(n!==undefined){d[n]=u[t];["CollectionRoot","SearchSupported"].forEach(function(n){if(n in u[t]){throw new Error("Property '"+n+"' is not allowed in annotation '"+t.slice(1)+"' for target '"+h[0]+"' in "+e.sServiceUrl)}})}else if(!p){throw new Error("Unexpected annotation '"+t.slice(1)+"' for target '"+h[0]+"' with namespace of data service in "+e.sServiceUrl)}});return d})};se.prototype.fetchValueListType=function(t){var n=this.getMetaContext(t),i=this;return this.fetchObject(undefined,n).then(function(r){var o,a;if(!r){throw new Error("No metadata for "+t)}o=i.getObject("@",n);if(o[X]){return e.Fixed}for(a in o){if(te(a,Q)!==undefined||te(a,J)!==undefined){return e.Standard}if(te(a,H)!==undefined){return o[a].SearchSupported===false?e.Fixed:e.Standard}}return e.None})};se.prototype.getAbsoluteServiceUrl=function(e){var t=new A(this.sUrl).absoluteTo(document.baseURI).pathname().toString();return new A(e).absoluteTo(t).filename("").toString()};se.prototype.getAllPathReductions=function(e,t,n,i){var r=t.split("/").length,o,a={},s=e.split("/"),u=this;function f(e,t,o,s){var l,c,d;function p(i){if(!n){f(e,t,l-1,true)}if(s){t=t.slice();e=e.slice()}t.splice(l,i);e.splice(l,i);if(!n){a[e.join("/")]=true}}for(l=o;l>=r;l-=1){c=R.test(e[l+1])?l+2:l+1;if(c<e.length&&t[l].$Partner===e[c]&&!t[c].$isCollection&&t[c].$Partner===e[l].replace(B,"")){p(c-l+1)}else if(Array.isArray(t[l])&&e[l+1]==="$Parameter"){d=u.getObject(u.getMetaPath(e.slice(0,l+1).join("/")+"/@$ui5.overload"));if(d.length===1&&d[0].$Parameter[0].$Name===e[l+2]){p(3)}}else if(i&&t[l].$isCollection){break}}}o=s.map(function(e,t){return t<r||e[0]==="#"||e[0]==="@"||R.test(e)||e==="$Parameter"?{}:u.getObject(u.getMetaPath(s.slice(0,t+1).join("/")))||{}});a[e]=true;if(!(i&&o[s.length-1].$isCollection)){f(s,o,s.length-2)}return n?s.join("/"):Object.keys(a)};se.prototype.getConstraints=function(e,t){var n,i,r,o=z[e.$Type];function a(e,t){if(t!==undefined){i=i||{};i[e]=t}}if(o){r=o.constraints;for(n in r){a(r[n],n[0]==="@"?this.getObject(t+n):e[n])}if(e.$Nullable===false){a("nullable",false)}}return i};se.prototype.getData=t.createGetMethod("fetchData");se.prototype.getETags=function(){return this.mETags};se.prototype.getLastModified=function(){return this.dLastModified};se.prototype.getMetaContext=function(e){return new l(this,this.getMetaPath(e))};se.prototype.getMetaPath=function(e){return t.getMetaPath(e)};se.prototype.getObject=t.createGetMethod("fetchObject");se.prototype.getOrCreateSharedModel=function(e,t,n){var i,r;e=this.getAbsoluteServiceUrl(e);i=!!n+e;r=_.get(i);if(!r){r=new this.oModel.constructor({autoExpandSelect:n,groupId:t,httpHeaders:this.oModel.getHttpHeaders(),operationMode:h.Server,serviceUrl:e,synchronizationMode:"None"});r.setDefaultBindingMode(s.OneWay);_.set(i,r)}return r};se.prototype.getOriginalProperty=function(){throw new Error("Unsupported operation: v4.ODataMetaModel#getOriginalProperty")};se.prototype.getProperty=se.prototype.getObject;se.prototype.getReducedPath=function(e,t){return this.getAllPathReductions(e,t,true,true)};se.prototype.getUI5Type=t.createGetMethod("fetchUI5Type",true);se.prototype.getUnitOrCurrencyPath=function(e){var t=this.getObject("@",this.getMetaContext(e)),n=t&&(t["@Org.OData.Measures.V1.Unit"]||t["@Org.OData.Measures.V1.ISOCurrency"]);return n&&n.$Path};se.prototype.getValueListType=t.createGetMethod("fetchValueListType",true);se.prototype.isList=function(){throw new Error("Unsupported operation: v4.ODataMetaModel#isList")};se.prototype.refresh=function(){throw new Error("Unsupported operation: v4.ODataMetaModel#refresh")};se.prototype.requestCodeList=function(e,t,n){var r=this.fetchEntityContainer().getResult(),o=r[r.$EntityContainer],a=this;if(n&&n.context){if(n.context.getModel()!==this||n.context.getPath()!=="/"){throw new Error("Unsupported context: "+n.context)}}if(t!==undefined&&t!==o){throw new Error("Unsupported raw value: "+t)}return this.requestObject("/@com.sap.vocabularies.CodeList.v1."+e).then(function(e){var t,n,r,o,s;if(!e){return null}t=a.getAbsoluteServiceUrl(e.Url)+"#"+e.CollectionPath;o=L.get(t);if(o){return o}r=a.getOrCreateSharedModel(e.Url,"$direct");n=r.getMetaModel();s="/"+e.CollectionPath+"/";o=n.requestObject(s).then(function(t){var o=s+"@Org.OData.Core.V1.AlternateKeys",a=n.getObject(o),u,f=g(t.$Key),l=s+f+"@com.sap.vocabularies.Common.v1.",c,d,p=s+f+"@com.sap.vocabularies.CodeList.v1.StandardCode/$Path",h,m;function y(t,n){var r=n.getProperty(f),o={Text:n.getProperty(m),UnitSpecificScale:n.getProperty(d)};if(h){o.StandardCode=n.getProperty(h)}if(o.UnitSpecificScale===null){i.error("Ignoring customizing w/o unit-specific scale for code "+r+" from "+e.CollectionPath,e.Url,N)}else{t[r]=o}return t}function g(e){var t;if(e&&e.length===1){t=e[0]}else{throw new Error("Single key expected: "+s)}return typeof t==="string"?t:t[Object.keys(t)[0]]}if(a){if(a.length!==1){throw new Error("Single alternative expected: "+o)}else if(a[0].Key.length!==1){throw new Error("Single key expected: "+o+"/0/Key")}f=a[0].Key[0].Name.$PropertyPath}d=n.getObject(l+"UnitSpecificScale/$Path");m=n.getObject(l+"Text/$Path");c=[f,d,m];h=n.getObject(p);if(h){c.push(h)}u=r.bindList("/"+e.CollectionPath,null,null,null,{$select:c});return u.requestContexts(0,Infinity).then(function(t){if(!t.length){i.error("Customizing empty for ",r.sServiceUrl+e.CollectionPath,N)}return t.reduce(y,{})}).finally(function(){u.destroy()})});L.set(t,o);return o})};se.prototype.requestCurrencyCodes=function(e,t){return this.requestCodeList("CurrencyCodes",e,t)};se.prototype.requestData=t.createRequestMethod("fetchData");se.prototype.requestObject=t.createRequestMethod("fetchObject");se.prototype.requestUI5Type=t.createRequestMethod("fetchUI5Type");se.prototype.requestUnitsOfMeasure=function(e,t){return this.requestCodeList("UnitsOfMeasure",e,t)};se.prototype.requestValueListInfo=function(e,n){var i=this.getMetaPath(e),r=i.slice(0,i.lastIndexOf("/")).replace("/$Parameter",""),o=r.slice(r.lastIndexOf("/")+1),a=this;if(!o.includes(".")){o=undefined}return Promise.all([o||this.requestObject(r+"/@sapui.name"),this.requestObject(i),this.requestObject(i+"@"),this.requestObject(i+X),this.requestObject(r+"/@$ui5.overload")]).then(function(i){var r=i[2],o=i[3],s={},u=i[1],f={};function l(i,r,u,l){if(o!==undefined&&"SearchSupported"in i){throw new Error("Must not set 'SearchSupported' in annotation "+"'com.sap.vocabularies.Common.v1.ValueList' and annotation "+"'com.sap.vocabularies.Common.v1.ValueListWithFixedValues'")}if("CollectionRoot"in i){l=a.getOrCreateSharedModel(i.CollectionRoot,undefined,n);if(f[r]&&f[r].$model===l){s[r]=undefined}}if(s[r]){throw new Error("Annotations '"+H.slice(1)+"' with identical qualifier '"+r+"' for property "+e+" in "+s[r]+" and "+u)}s[r]=u;i=t.clone(i);i.$model=l;delete i.CollectionRoot;delete i.SearchSupported;f[r]=i}if(!u){throw new Error("No metadata for "+e)}return Promise.all(Object.keys(r).filter(function(e){return te(e,Q)!==undefined}).map(function(e){var t=r[e];return Promise.all(t.map(function(e){var t=a.getOrCreateSharedModel(e,undefined,n);return a.fetchValueListMappings(t,i[0],u,i[4]).then(function(n){Object.keys(n).forEach(function(i){l(n[i],i,e,t)})})}))})).then(function(){var t;Object.keys(r).filter(function(e){return ne(e)!==undefined}).forEach(function(e){l(r[e],ne(e),a.sUrl,a.oModel)});t=Object.keys(f);if(!t.length){throw new Error("No annotation '"+Q.slice(1)+"' for "+e)}if(o){if(t.length>1){throw new Error("Annotation '"+X.slice(1)+"' but multiple '"+H.slice(1)+"' for property "+e)}return{"":f[t[0]]}}return f})})};se.prototype.requestValueListType=t.createRequestMethod("fetchValueListType");se.prototype.resolve=function(e,t){var n,i;if(!e){return t?t.getPath():undefined}i=e[0];if(i==="/"){return e}if(!t){return undefined}if(i==="."){if(e[1]!=="/"){throw new Error("Unsupported relative path: "+e)}e=e.slice(2)}n=t.getPath();return i==="@"||n.endsWith("/")?n+e:n+"/"+e};se.prototype.setLegacySyntax=function(){throw new Error("Unsupported operation: v4.ODataMetaModel#setLegacySyntax")};se.prototype.toString=function(){return N+": "+this.sUrl};se.prototype.validate=function(e,t){var n,i,r,o,a,s;if(!this.bSupportReferences){return t}for(s in t.$Reference){a=t.$Reference[s];s=new A(s).absoluteTo(this.sUrl).toString();if("$IncludeAnnotations"in a){oe(this,"Unsupported IncludeAnnotations",e)}for(n in a.$Include){o=a.$Include[n];if(o in t){oe(this,"A schema cannot span more than one document: "+o+" - is both included and defined",e)}Z(this,o,s,e)}}r=t.$LastModified?new Date(t.$LastModified):null;this.mETags[e]=t.$ETag?t.$ETag:r;i=t.$Date?new Date(t.$Date):new Date;r=r||i;if(this.dLastModified<r){this.dLastModified=r}delete t.$Date;delete t.$ETag;delete t.$LastModified;return t};return se});