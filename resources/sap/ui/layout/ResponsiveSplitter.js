/*!
* OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["./library","./PaneContainer","./ResponsiveSplitterPage","./ResponsiveSplitterRenderer","./ResponsiveSplitterUtilities","./SplitPane","./Splitter","sap/ui/core/Control","sap/ui/core/delegate/ItemNavigation","sap/ui/core/ResizeHandler","sap/ui/core/RenderManager"],function(t,e,i,n,a,s,o,r,l,p,g){"use strict";var u=r.extend("sap.ui.layout.ResponsiveSplitter",{metadata:{library:"sap.ui.layout",properties:{width:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",group:"Appearance",defaultValue:"100%"}},defaultAggregation:"rootPaneContainer",aggregations:{rootPaneContainer:{type:"sap.ui.layout.PaneContainer",multiple:false},_pages:{type:"sap.ui.layout.ResponsiveSplitterPage",multiple:true,visibility:"hidden"}},associations:{defaultPane:{type:"sap.ui.layout.SplitPane",multiple:false}},events:{}},renderer:n});var h={MAX_VISIBLE_BUTTONS:7};u.prototype.init=function(){this._aPaneContainers=[];this._aPanes=[];this._oResourceBundle=sap.ui.getCore().getLibraryResourceBundle("sap.ui.layout");this.addEventDelegate({onAfterRendering:function(){this._initItemNavigation()}},this)};u.prototype.onBeforeRendering=function(){var t=this.getRootPaneContainer();if(t){this._oSplitterDelegate=this._oSplitterDelegate||{onAfterRendering:function(){this._setSplitterBarsTooltips(t._oSplitter);this._updatePaginatorButtonsTooltips()}};t._oSplitter.addEventDelegate(this._oSplitterDelegate,this);this._createWidthIntervals();this._createPages();this._detachResizeHandler()}};u.prototype.onAfterRendering=function(){this._parentResizeHandler=p.register(this,this._onParentResize.bind(this));var t=this.getRootPaneContainer();if(t){this._onParentResize()}};u.prototype.exit=function(){this._detachResizeHandler();this._oSplitterDelegate=null};u.prototype._setSplitterBarsTooltips=function(t,e){var i=t.$().find(" > .sapUiLoSplitterBar"),n=t.$().find(" > .sapUiLoSplitterContent"),a="",s,r,l,p;for(var g=0;g<n.length;g++){p=n[g].childNodes[0].id;l=sap.ui.getCore().byId(p);s=g+1;r=g+2;if(e){a+=this._oResourceBundle.getText("RESPONSIVE_SPLITTER_RESIZE",[e+"."+s,e+"."+r])}else{a+=this._oResourceBundle.getText("RESPONSIVE_SPLITTER_RESIZE",[s,r])}if(i[g]){i[g].setAttribute("title",a);a=""}if(l instanceof o){this._setSplitterBarsTooltips(l,s)}}};u.prototype._updatePaginatorButtonsTooltips=function(){var t=Array.prototype.slice.call(this._getVisibleButtons()),e=this.getRootPaneContainer()._oSplitter.getAssociatedContentAreas().length,i=this._oResourceBundle.getText("RESPONSIVE_SPLITTER_HOME")+" ",n=this._oResourceBundle.getText("RESPONSIVE_SPLITTER_AND"),a="",s=this,o;if(t.length>0){o=t.shift();for(var r=1;r<=e;r++){i+=r;if(r<e-1){i+=", "}else if(r===e-1){i+=" "+n+" "}}o.setAttribute("title",i);[].forEach.call(t,function(t){a=s._oResourceBundle.getText("RESPONSIVE_SPLITTER_GOTO")+" "+(e+1);e+=1;t.setAttribute("title",a)})}};u.prototype.onsapright=function(t){this._handleArrowNavigation(6,"Forward",t)};u.prototype.onsapleft=function(t){this._handleArrowNavigation(0,"Back",t)};u.prototype._initItemNavigation=function(){if(this._oItemNavigation){this._bPrevItemNavigation=true;this._clearItemNavigation()}this._oItemNavigation=new l;this._oItemNavigation.setCycling(false);this.addDelegate(this._oItemNavigation);this._setItemNavigation();if(this._bPrevItemNavigation){this._oItemNavigation.focusItem(0)}};u.prototype._setItemNavigation=function(){var t=this._getVisibleButtons(),e=[];this._oItemNavigation.setRootDomRef(this.$().find(".sapUiResponsiveSplitterPaginator")[0]);for(var i=0;i<t.length;i++){if(t[i]){e.push(t[i])}}this._oItemNavigation.setItemDomRefs(e)};u.prototype._clearItemNavigation=function(){this.removeDelegate(this._oItemNavigation);this._oItemNavigation.destroy();delete this._oItemNavigation};u.prototype._handleArrowNavigation=function(t,e,i){if(i.target===this._getVisibleButtons()[t]){this["_handlePaginator"+e](i);this._setItemNavigation()}else{return}};u.prototype._onParentResize=function(){var t=this._intervalHasChanged(),e=this.getRootPaneContainer();if(t&&e){this._arrangeContent();this._setPaginatorVisibility()}};u.prototype._detachResizeHandler=function(){if(this._parentResizeHandler){p.deregister(this._parentResizeHandler);this._parentResizeHandler=null}};u.prototype._createWidthIntervals=function(){var t=[];this._aIntervals=[];a.visitPanes(this.getRootPaneContainer(),function(e){var i=e.getRequiredParentWidth();if(t.indexOf(i)==-1){t.push(i)}});t.push(Number.NEGATIVE_INFINITY);t.push(Number.POSITIVE_INFINITY);t.sort(function(t,e){return t-e});for(var e=0;e<t.length-1;e++){var i=new a.splitterInterval(t[e],t[e+1],this.getRootPaneContainer());this._aIntervals.push(i)}};u.prototype._createPages=function(){var t=this._getMaxPageCount(),e=this.getAggregation("_pages")||[],n=e.length;if(n<t){while(n<t){n++;var a=new i;this.addAggregation("_pages",a,true)}}else if(n>t){while(n>t){n--;if(e[n].getDomRef()){g.preserveContent(e[n].getDomRef())}e[n].destroy()}}};u.prototype._intervalHasChanged=function(){var t=this.getDomRef().clientWidth,e=null,i=this._aIntervals;for(var n=0;n<i.length;n++){if(i[n].iFrom<t&&t<=i[n].iTo){e=i[n];break}}if(this._currentInterval!==e){this._currentInterval=e;return true}return false};u.prototype._setPaginatorVisibility=function(){var t=this.$().find(".sapUiResponsiveSplitterPaginatorButton"),e=this.$().find(".sapUiResponsiveSplitterPaginatorNavButton"),i=this.$().find(".sapUiResponsiveSplitterPaginator"),n=this._getHiddenPanes().length+1,a=n<h.MAX_VISIBLE_BUTTONS;t.addClass("sapUiResponsiveSplitterHiddenElement");if(n>1){this.addStyleClass("sapUiRSVisiblePaginator");t=t.slice(0,a?n:h.MAX_VISIBLE_BUTTONS);t.removeClass("sapUiResponsiveSplitterHiddenElement");t.removeClass("sapUiResponsiveSplitterHiddenPaginatorButton");e.toggleClass("sapUiResponsiveSplitterHiddenPaginatorButton",a);i.toggleClass("sapUiResponsiveSplitterWithNavButtons",!a)}else{this.removeStyleClass("sapUiRSVisiblePaginator")}};u.prototype._getMaxPageCount=function(){var t=0;this._aIntervals.forEach(function(e){if(e.iPagesCount>t){t=e.iPagesCount}});return t};u.prototype._arrangeContent=function(){var t=this.getAggregation("_pages")||[];this._clearContent();t.forEach(function(t){t.setVisible(false)});this._fillPageContent(this.getRootPaneContainer());this._activatePage(0)};u.prototype._activatePage=function(t){var e=this.$().find(".sapUiResponsiveSplitterPaginatorButton"),i=this.$().find(".sapUiResponsiveSplitterPaginatorSelectedButton"),n=e.index(i),a=this.getAggregation("_pages")||[];a[n]&&a[n].setVisible(false);a[t]&&a[t].setVisible(true);i.removeClass("sapUiResponsiveSplitterPaginatorSelectedButton");e.eq(t).addClass("sapUiResponsiveSplitterPaginatorSelectedButton");i.attr("aria-checked",false);e.eq(t).attr("aria-checked",true)};u.prototype._fillPageContent=function(t){var i=t instanceof e,n=t instanceof s,a=t.getParent(),o=a instanceof e,r=this.getAggregation("_pages"),l,p,g,u,h,d;if(i&&r){this._aPaneContainers.push(t);p=this._getAllPanesInInterval(t,this._currentInterval.iFrom).length>0;g=t._oSplitter;if(o&&p){a._oSplitter.addAssociatedContentArea(g)}else if(!o){r[0].setContent(g)}t.getPanes().forEach(function(t){this._fillPageContent(t)},this)}else if(n&&r){this._assignDefault(t);this._aPanes.push(t);u=t.getDemandPane();l=this._getHiddenPanes();h=l.length;d=this._getMaxPageCount();var f;if(t._isInInterval(this._currentInterval.iFrom)){a._oSplitter.addAssociatedContentArea(t.getContent())}else if(u&&h<d){for(f=0;f<h;f++){r[f+1].setContent(l[f].getContent())}}else if(u&&h===d){for(f=0;f<h;f++){r[f].setContent(l[f].getContent())}}else if(this._isDefault(t)){r[0].setContent(t.getContent())}}};u.prototype._isDefault=function(t){return this.getDefaultPane()===t.getId()};u.prototype._assignDefault=function(t){var e=this.getDefaultPane();this.setDefaultPane(e||t)};u.prototype._getAllPanesInInterval=function(t,i){var n=[];function a(t){t.getPanes().forEach(function(t){if(t instanceof e){a(t)}else if(t._isInInterval(i)){n.push(t)}});return n}return a(t,i)};u.prototype._getHiddenPanes=function(){return this._aPanes.filter(function(t){return t.getDemandPane()&&!t._isInInterval(this._currentInterval.iFrom)},this)};u.prototype._clearContent=function(){this._aPaneContainers.forEach(function(t){t._oSplitter.removeAllAssociatedContentAreas()});this._aPaneContainers=[];this._aPanes=[]};u.prototype._getVisibleButtons=function(){return this.$().find(".sapUiResponsiveSplitterPaginatorButton:not(.sapUiResponsiveSplitterHiddenElement, .sapUiResponsiveSplitterHiddenPaginatorButton)")};u.prototype._handlePaginatorButtonTap=function(t){var e=t.target,i=t.target.classList,n;if(i&&i.contains("sapUiResponsiveSplitterPaginatorButton")){n=e.getAttribute("page-index");this._activatePage(n)}else if(i&&i.contains("sapUiResponsiveSplitterPaginatorNavButton")){if(i.contains("sapUiResponsiveSplitterPaginatorButtonForward")){this._handlePaginatorForward(t)}else{this._handlePaginatorBack(t)}}};u.prototype._handlePaginatorForward=function(t){var e=this._getVisibleButtons(),i=this._getHiddenPanes().length,n=this.$().find(".sapUiResponsiveSplitterPaginatorButton.sapUiResponsiveSplitterHiddenElement"),a=n.filter(function(){return this.getAttribute("page-index")>=h.MAX_VISIBLE_BUTTONS&&this.getAttribute("page-index")<=i});if(a.length>0){e.first().addClass("sapUiResponsiveSplitterHiddenElement");a.last().removeClass("sapUiResponsiveSplitterHiddenElement")}};u.prototype._handlePaginatorBack=function(t){var e=this._getVisibleButtons(),i=this._getMaxPageCount()-h.MAX_VISIBLE_BUTTONS,n=this.$().find(".sapUiResponsiveSplitterPaginatorButton.sapUiResponsiveSplitterHiddenElement"),a=n.filter(function(){return this.getAttribute("page-index")<i});if(a.length>0){e.last().addClass("sapUiResponsiveSplitterHiddenElement");a.last().removeClass("sapUiResponsiveSplitterHiddenElement")}};u.prototype.ontap=u.prototype._handlePaginatorButtonTap;u.prototype.onsapenter=u.prototype._handlePaginatorButtonTap;u.prototype.onsapspace=u.prototype._handlePaginatorButtonTap;return u});