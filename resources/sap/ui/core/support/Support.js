/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/EventProvider","./Plugin","sap/ui/Device","sap/base/util/UriParameters","sap/ui/thirdparty/jquery","sap/base/Log","sap/base/util/deepExtend","sap/base/security/encodeURL"],function(e,t,i,n,o,r,s,a){"use strict";var u=e.extend("sap.ui.core.support.Support",{constructor:function(t){if(!l){throw Error()}e.apply(this);var r=this;this._sType=t;this._sLocalOrigin=window.location.protocol+"//"+window.location.host;var s=o.proxy(this._receiveEvent,this);if(window.addEventListener){window.addEventListener("message",s,false)}else{window.attachEvent("onmessage",s)}switch(t){case p.APPLICATION:this._isOpen=false;this.attachEvent(f.TEAR_DOWN,function(e){r._isOpen=false;if(i.browser.msie){o(document.getElementById(g+"-frame")).remove()}else{S(r._oRemoteWindow)}r._oRemoteWindow=null;u.exitPlugins(r,false)});this.attachEvent(f.LIBS,function(e){var t=u.getDiagnosticLibraries(),i=[];for(var n=0;n<t.length;n++){i.push(t[n].name)}r.sendEvent(f.LIBS,i)});this.attachEvent(f.SETUP,function(e){r._isOpen=true;u.initPlugins(r,false)});break;case p.IFRAME:this._oRemoteWindow=window.parent;this._sRemoteOrigin=n.fromQuery(window.location.search).get("sap-ui-xx-support-origin");this.openSupportTool();o(window).on("unload",function(e){S(r._oOpenedWindow)});break;case p.TOOL:this._oRemoteWindow=window.opener;this._sRemoteOrigin=n.fromQuery(window.location.search).get("sap-ui-xx-support-origin");o(window).on("unload",function(e){r.sendEvent(f.TEAR_DOWN);u.exitPlugins(r,true)});this.attachEvent(f.LIBS,function(e){var t=e.mParameters;if(!Array.isArray(t)){t=Object.keys(t).map(function(e){return t[e]})}sap.ui.getCore().loadLibraries(t,true).then(function(){o(function(){u.initPlugins(r,true).then(function(){r.sendEvent(f.SETUP)})})})});this.sendEvent(f.LIBS);break}}});var p={APPLICATION:"APPLICATION",IFRAME:"IFRAME",TOOL:"TOOL"};var f={LIBS:"sapUiSupportLibs",SETUP:"sapUiSupportSetup",TEAR_DOWN:"sapUiSupportTeardown"};u.StubType=p;u.EventType=f;var d=[];u.getStub=function(e){if(c){return c}if(e!=p.APPLICATION&&e!=p.IFRAME&&e!=p.TOOL){e=p.APPLICATION}l=true;c=new u(e);l=false;return c};u.getToolPlugins=function(){var e=[];for(var i=0;i<d.length;i++){if(d[i]instanceof t&&d[i].isToolPlugin()){e.push(d[i])}}return e};u.getAppPlugins=function(){var e=[];for(var i=0;i<d.length;i++){if(d[i]instanceof t&&d[i].isAppPlugin()){e.push(d[i])}}return e};u.prototype.getType=function(){return this._sType};u.prototype.isToolStub=function(){return this._sType===u.StubType.TOOL};u.prototype.isAppStub=function(){return this._sType===u.StubType.APPLICATION};u.prototype._receiveEvent=function(e){var t=e.data;if(typeof t==="string"&&t.indexOf("SAPUI5SupportTool*")===0){t=t.substr(18)}else{return}if(e.source!=this._oRemoteWindow){return}this._oRemoteOrigin=e.origin;if(this._sType===p.IFRAME){var i=this;setTimeout(function(){i._oOpenedWindow.sap.ui.core.support.Support.getStub(p.TOOL)._receiveEvent({source:window,data:e.data,origin:i._sLocalOrigin})},0)}else{var n=JSON.parse(t);var o=n.eventId;var r=n.params;this.fireEvent(o,r)}};u.prototype.sendEvent=function(e,t){if(!this._oRemoteWindow){return}t=t?t:{};if(i.browser.msie&&this._sType===p.TOOL){this._oRemoteWindow.sap.ui.core.support.Support.getStub(p.IFRAME).sendEvent(e,t)}else{var n=t;if(i.browser.msie){n={};s(n,t)}var o={eventId:e,params:n};var r="SAPUI5SupportTool*"+JSON.stringify(o);this._oRemoteWindow.postMessage(r,this._sRemoteOrigin)}};u.prototype.openSupportTool=function(){var e=sap.ui.require.toUrl("sap/ui/core/support/support.html");var t="?sap-ui-xx-noless=true&sap-ui-xx-support-origin="+a(this._sLocalOrigin);var o;if(this._sType===p.APPLICATION){var r=window.document.getElementById("sap-ui-bootstrap");if(r){var s=sap.ui.require.toUrl("");var u=r.getAttribute("src");if(typeof u==="string"&&u.indexOf(s)===0){o=u.substr(s.length)}}}else if(this._sType===p.IFRAME){o=n.fromQuery(window.location.search).get("sap-ui-xx-support-bootstrap")}if(o&&o!=="sap-ui-core.js"&&o.indexOf("/")===-1){t+="&sap-ui-xx-support-bootstrap="+a(o)}function f(e){return e.indexOf(".")==0||e.indexOf("/")==0||e.indexOf("://")<0}if(this._sType===p.APPLICATION){if(!this._isOpen){if(i.browser.msie){var d=sap.ui.require.toUrl("sap/ui/core/support/msiebridge.html");v().html("").append(h(d,t));this._sRemoteOrigin=f(d)?this._sLocalOrigin:d}else{this._oRemoteWindow=m(e+t);this._sRemoteOrigin=f(e)?this._sLocalOrigin:e}}else{this._oRemoteWindow.focus()}}else if(this._sType===p.IFRAME){this._oOpenedWindow=m(e+t)}};u._onSupportIFrameLoaded=function(){c._oRemoteWindow=o(document.getElementById(g+"-frame"))[0].contentWindow};u.prototype.toString=function(){return"sap.ui.core.support.Support"};var l=false;var c;var g="sap-ui-support";function v(){var e=o(document.getElementById(g));if(e.length===0){e=o("<DIV/>",{id:g}).addClass("sapUiHidden").appendTo(document.body)}return e}function h(e,t){var i=document.createElement("iframe");i.id=g+"-frame";i.src=e+t;i.onload=u._onSupportIFrameLoaded;return i}function m(e){return window.open(e,"sapUiSupportTool","width=800,height=700,status=no,toolbar=no,menubar=no,resizable=yes,location=no,directories=no,scrollbars=yes")}function S(e){if(!e){return}try{e.close()}catch(e){}}u.getDiagnosticLibraries=function(){var e=sap.ui.getCore().getLoadedLibraries(),t=[];for(var i in e){var n=e[i];if(n.extensions&&n.extensions["sap.ui.support"]&&n.extensions["sap.ui.support"].diagnosticPlugins){t.push(n)}}return t};u.initPlugins=function(e,i){return new Promise(function(i,n){d=[];var o=u.getDiagnosticLibraries();for(var r=0;r<o.length;r++){var s=o[r],a=s.extensions["sap.ui.support"].diagnosticPlugins;if(Array.isArray(a)){for(var p=0;p<a.length;p++){if(d.indexOf(a[p])===-1){d.push(a[p])}}}}var f=[],l=[],r;for(r=0;r<d.length;r++){if(typeof d[r]==="string"){f.push(d[r]);l.push(r)}}sap.ui.require(f,function(){var n,o,r;for(o=0;o<arguments.length;o++){r=arguments[o];n=l[o];if(e.isToolStub()&&r.prototype.isToolPlugin()){d[n]=new r(e);b(d[n])}else if(e.isAppStub()&&r.prototype.isAppPlugin()){d[n]=new r(e)}}for(n=0;n<d.length;n++){if(d[n]instanceof t){if(e.isToolStub()&&d[n].isToolPlugin()){d[n].init(e)}else if(e.isAppStub()&&d[n].isAppPlugin()){d[n].init(e)}}}i()})})};u.exitPlugins=function(e,i){for(var n=0;n<d.length;n++){if(d[n]instanceof t){if(d[n].isToolPlugin()&&e.isToolStub()&&i){d[n].exit(e,true)}else if(d[n].isAppPlugin()&&e.isAppStub()&&!i){d[n].exit(e,false)}}}};function b(e){e.$().replaceWith("<div  id='"+e.getId()+"-Panel' class='sapUiSupportPnl'>"+"<div id='"+e.getId()+"-PanelHeader' class='sapUiSupportPnlHdr'>"+"<div id='"+e.getId()+"-PanelHandle' class='sapUiSupportPnlHdrHdl sapUiSupportPnlHdrHdlClosed'>"+"</div>"+"<div class='sapUiSupportPanelTitle'>"+e.getTitle()+"</div>"+"</div>"+"<div id='"+e.getId()+"-PanelContent' class='sapUiSupportPnlCntnt sapUiSupportHidden'>"+"<div id='"+e.getId()+"' class='sapUiSupportPlugin'></div>"+"</div>"+"</div>");e.$("PanelHeader").on("click",function(){var t=e.$("PanelHandle");if(t.hasClass("sapUiSupportPnlHdrHdlClosed")){t.removeClass("sapUiSupportPnlHdrHdlClosed");e.$("PanelContent").removeClass("sapUiSupportHidden")}else{t.addClass("sapUiSupportPnlHdrHdlClosed");e.$("PanelContent").addClass("sapUiSupportHidden")}})}u.initializeSupportMode=function(e,t){if(e.indexOf("true")>-1||e.indexOf("viewinfo")>-1){u._initializeSupportInfo(t)}};u._initializeSupportInfo=function(e){var t=[],i=[],n=[],o="support:data",s="support",a="http://schemas.sap.com/sapui5/extension/sap.ui.core.support.Support.info/1",p={};var f=function(){var e="sap-ui-support.probe",t;try{localStorage.setItem(e,e);t=localStorage.getItem(e);localStorage.removeItem(e);return t===e}catch(e){return false}}();function d(){if(f){localStorage.setItem("sap-ui-support.aSupportInfosBreakpoints/"+document.location.href,JSON.stringify(i))}}function l(){if(f){localStorage.setItem("sap-ui-support.aSupportXMLModifications/"+document.location.href,JSON.stringify(n))}}if(f){var c=localStorage.getItem("sap-ui-support.aSupportInfosBreakpoints/"+document.location.href);if(c){i=JSON.parse(c)}var c=localStorage.getItem("sap-ui-support.aSupportXMLModifications/"+document.location.href);if(c){n=JSON.parse(c)}}u.info=function(e){e._idx=t.length;if(e._idx>0&&!e.context){e.context=t[t.length-1].context}if(!e.context){r.debug("Support Info does not have a context and is ignored");return e}if(e.context&&e.context.ownerDocument&&e.context.nodeType===1){var n=e._idx+"";if(!e.context.hasAttributeNS(a,"data")){e.context.setAttribute("xmlns:"+s,a)}else{n=e.context.getAttributeNS(a,"data")+","+n}e.context.setAttributeNS(a,o,n)}t.push(e);if(i.indexOf(e._idx)>-1){r.info(e);r.info("To remove this breakpoint execute:","\nsap.ui.core.support.Support.info.removeBreakpointAt("+e._idx+")");debugger}return e._idx};u.info.getAll=function(e){if(e===undefined){return t}else{return t.filter(function(t){return t.env&&t.env.caller===e})}};u.info.getInfos=function(e){if(e&&typeof e==="string"){e=e.split(",")}else{e=[]}var i=[];for(var n=0;n<e.length;n++){if(t[e[n]]){i.push(t[e[n]])}}return i};u.info.byIndex=function(e){return t[e]};u.info.getAllBreakpoints=function(){return i};u.info.hasBreakpointAt=function(e){return i.indexOf(e)>-1};u.info.addBreakpointAt=function(e){if(i.indexOf(e)>-1){return}i.push(e);d()};u.info.removeBreakpointAt=function(e){var t=i.indexOf(e);if(t>-1){i.splice(t,1);d()}};u.info.removeAllBreakpoints=function(){i=[];d()};u.info.addSupportInfo=function(e,t){if(e&&t){if(p[e]){p[e]+=","+t}else{p[e]=t}}};u.info.byId=function(e){return p[e]||null};u.info.getIds=function(e){var t=[];for(var i in p){var n=p[i];if(n&&n.indexOf(e)>-1){t.push(i)}}return t};u.info.getElements=function(e){var t=[];for(var i in p){var n=p[i];if(n&&n.indexOf(e)===0){var o=sap.ui.getCore().byId(i);if(o){t.push(sap.ui.getCore().byId(i))}}}return t};u.info.getAllXMLModifications=function(){return n};u.info.hasXMLModifications=function(){return n.length>0};u.info.addXMLModification=function(e,t,i){n.push({id:e,idx:t,change:i});l()};u.info.removeXMLModification=function(e){var t=n.indexOf(e);if(t>-1){n.splice(t,1);l()}};u.info.removeAllXMLModification=function(){n=[];l()};u.info.modifyXML=function(e,t){if(!u.info.hasXMLModifications()){return}var i=t;if(!i||!i.nodeType||!(i.nodeType==1||i.nodeType==9)){return}if(i.nodeType===9){i=i.firstChild}var o=i.querySelectorAll("*");var r=[i];for(var s=0;s<o.length;s++){r.push(o[s])}for(var s=0;s<n.length;s++){var a=n[s],p=a.change;if(a.id===e){var f=r[a.idx];if(f.nodeType===1&&p.setAttribute){var d=f.getAttribute(p.setAttribute[0]);f.setAttribute(p.setAttribute[0],p.setAttribute[1]);if(!f._modified){f._modified=[]}f._modified.push(p.setAttribute[0]);if(!f._oldValues){f._oldValues=[]}f._oldValues.push(d)}}}};u.info._breakAtProperty=function(e){return function(t){if(t.getParameter("name")===e){debugger}}};u.info._breakAtMethod=function(e){return function(){debugger;return e.apply(this,arguments)}};var g=["sap/ui/base/ManagedObject","sap/ui/core/mvc/View","sap/ui/core/XMLTemplateProcessor","sap/ui/thirdparty/datajs"];function v(e,t,i,n){e._supportInfo=u.info;t._supportInfo=u.info;i._supportInfo=u.info;if(window.datajs){window.datajs._sap={_supportInfo:u.info}}r.info("sap.ui.core.support.Support.info initialized.")}if(e){sap.ui.require(g,v)}else{v.apply(null,g.map(sap.ui.requireSync))}};return u});