/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/URI","../Element","sap/base/util/UriParameters","sap/base/Log","sap/base/util/extend","sap/ui/thirdparty/jquery"],function(e,r,a,t,n,i){"use strict";var s=window["sap-ui-config"]||{};var o=0;if(s["xx-nosync"]==="warn"||/(?:\?|&)sap-ui-xx-nosync=(?:warn)/.exec(window.location.search)){o=1}if(s["xx-nosync"]===true||s["xx-nosync"]==="true"||/(?:\?|&)sap-ui-xx-nosync=(?:x|X|true)/.exec(window.location.search)){o=2}var u={};var f=null;var c=null;var l=[];var p=/url[\s]*\('?"?([^\'")]*)'?"?\)/;var m=a.fromQuery(window.location.search).get("sap-ui-xx-no-inline-theming-parameters")!=="true";function g(){f=null}function d(r,a){var t=p.exec(r);if(t){var n=new e(t[1]);if(n.is("relative")){var i=n.absoluteTo(a).normalize().toString();r="url('"+i+"')"}}return r}function v(e,r,a){for(var t in r){if(typeof e[t]==="undefined"){e[t]=d(r[t],a)}}return e}function h(e,r){if(typeof e["default"]!=="object"){e={default:e,scopes:{}}}f=f||{};f["default"]=f["default"]||{};f["scopes"]=f["scopes"]||{};v(f["default"],e["default"],r);if(typeof e["scopes"]==="object"){for(var a in e["scopes"]){f["scopes"][a]=f["scopes"][a]||{};v(f["scopes"][a],e["scopes"][a],r)}}}function y(e){i("link[id^=sap-ui-theme-]").each(function(){e(this.getAttribute("id"))})}function b(r){var a=document.getElementById(r);if(!a){t.warning("Could not find stylesheet element with ID",r,"sap.ui.core.theming.Parameters");return}var n=a.href;var s=new e(n).filename("").query("").toString();var u=sap.ui.getCore().isThemeApplied();if(!u){t.warning("Parameters have been requested but theme is not applied, yet.","sap.ui.core.theming.Parameters")}if(u&&m){var f=i(a);var c=f.css("background-image");var l=/\(["']?data:text\/plain;utf-8,(.*?)['"]?\)$/i.exec(c);if(l&&l.length>=2){var p=l[1];if(p.charAt(0)!=="{"&&p.charAt(p.length-1)!=="}"){try{p=decodeURIComponent(p)}catch(e){t.warning("Could not decode theme parameters URI from "+n)}}try{var g=JSON.parse(p);h(g,s);return}catch(e){t.warning("Could not parse theme parameters from "+n+". Loading library-parameters.json as fallback solution.")}}}var d=n.replace(/\/(?:css_variables|library)([^\/.]*)\.(?:css|less)($|[?#])/,function(e,r,a){return"/library-parameters.json"+(a?a:"")});if(o===2){t.error("[nosync] Loading library-parameters.json ignored",d,"sap.ui.core.theming.Parameters");return}else if(o===1){t.error("[nosync] Loading library-parameters.json with sync XHR",d,"sap.ui.core.theming.Parameters")}i.ajax({url:d,dataType:"json",async:false,success:function(e,r,a){if(Array.isArray(e)){for(var t=0;t<e.length;t++){var n=e[t];h(n,s)}}else{h(e,s)}},error:function(e,r,a){t.error("Could not load theme parameters from: "+d,a)}})}function x(){if(!f){h({},"");c=sap.ui.getCore().getConfiguration().getTheme();y(b)}return f}function w(){l.forEach(b);l=[]}u._addLibraryTheme=function(e){if(f){l.push("sap-ui-theme-"+e)}};function N(e){var r=x();if(e.scopeName){r=r["scopes"][e.scopeName]}else{r=r["default"]}var a=r[e.parameterName];if(typeof a==="undefined"&&typeof e.parameterName==="string"){var t=e.parameterName.indexOf(":");if(t!==-1){e.parameterName=e.parameterName.substr(t+1)}a=r[e.parameterName]}if(e.loadPendingParameters&&typeof a==="undefined"){w();a=N({parameterName:e.parameterName,scopeName:e.scopeName,loadPendingParameters:false})}return a}function C(e,r){for(var a=0;a<r.length;a++){var t=r[a];for(var n=0;n<t.length;n++){var i=t[n];var s=N({parameterName:e,scopeName:i});if(s){return s}}}return N({parameterName:e})}u._getScopes=function(e){if(e&&!f){return}var r=x();var a=Object.keys(r["scopes"]);return a};u.getActiveScopesFor=function(e){var a=[];if(e instanceof r){var t=e.getDomRef();w();var n=this._getScopes();if(t){var i=function(e){var r=t.classList;return r&&r.contains(e)};while(t){var s=n.filter(i);if(s.length>0){a.push(s)}t=t.parentNode}}else{var o=function(r){return typeof e.hasStyleClass==="function"&&e.hasStyleClass(r)};while(e){var s=n.filter(o);if(s.length>0){a.push(s)}e=typeof e.getParent==="function"&&e.getParent()}}}return a};u.get=function(e,a){var n;if(!sap.ui.getCore().isInitialized()){t.warning("Called sap.ui.core.theming.Parameters.get() before core has been initialized. "+"This could lead to bad performance and sync XHR as inline parameters might not be available, yet. "+"Consider using the API only when required, e.g. onBeforeRendering.")}if(arguments.length===0){w();var i=x();return Object.assign({},i["default"])}if(!e){return undefined}if(a instanceof r){w();var s=this.getActiveScopesFor(a);if(typeof e==="string"){return C(e,s)}else if(Array.isArray(e)){var o={};for(var f=0;f<e.length;f++){var c=e[f];o[c]=C(c,s)}return o}}else{if(typeof e==="string"){n=N({parameterName:e,loadPendingParameters:true});return n}else if(Array.isArray(e)){var o={};for(var l=0;l<e.length;l++){var c=e[l];o[c]=u.get(c)}return o}}};u._setOrLoadParameters=function(e){f={default:{},scopes:{}};c=sap.ui.getCore().getConfiguration().getTheme();y(function(r){var a=r.substr(13);if(e[a]){n(f["default"],e[a])}else{b(r)}})};u.reset=function(){var e=arguments[0]===true;if(!e||sap.ui.getCore().getConfiguration().getTheme()!==c){g()}};u._getThemeImage=function(e,r){e=e||"sapUiGlobalLogo";var a=u.get(e);if(a){var t=p.exec(a);if(t){a=t[1]}else if(a==="''"||a==="none"){a=null}}if(!!r&&!a){return sap.ui.resource("sap.ui.core","themes/base/img/1x1.gif")}return a};return u},true);