/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/EventProvider","./Target","./async/Targets","./sync/Targets","sap/base/util/UriParameters","sap/base/Log","sap/base/util/deepExtend"],function(t,e,i,r,n,a,s){"use strict";var o=t.extend("sap.ui.core.routing.Targets",{constructor:function(e){var s,o;t.apply(this);this._mTargets={};this._oConfig=e.config;this._oCache=e.cache||e.views;if(!this._oConfig){this._oConfig={_async:false}}function h(){if(n.fromQuery(window.location.search).get("sap-ui-xx-asyncRouting")==="true"){a.warning("Activation of async view loading in routing via url parameter is only temporarily supported and may be removed soon","Targets");return true}return false}if(this._oConfig._async===undefined){this._oConfig._async=this._oConfig.async===undefined?h():this._oConfig.async}var f=this._oConfig._async?i:r;for(var g in f){this[g]=f[g]}for(s in e.targets){if(e.targets.hasOwnProperty(s)){this._createTarget(s,e.targets[s])}}for(o in this._mTargets){if(this._mTargets.hasOwnProperty(o)){this._addParentTo(this._mTargets[o])}}},destroy:function(){var e;t.prototype.destroy.apply(this);for(e in this._mTargets){if(this._mTargets.hasOwnProperty(e)){this._mTargets[e].destroy()}}this._mTargets=null;this._oCache=null;this._oConfig=null;this.bIsDestroyed=true;return this},getViews:function(){return this._oCache},getCache:function(){return this._oCache},getTarget:function(t){var e=this,i=this._alignTargetsInfo(t),r;r=i.reduce(function(t,i){var r=e._mTargets[i.name];if(r){t.push(r)}else{a.error('The target you tried to get "'+i.name+'" does not exist!',e)}return t},[]);return r.length<=1?r[0]:r},addTarget:function(t,e){var i=this.getTarget(t),r;if(i){a.error("Target with name "+t+" already exists",this)}else{r=this._createTarget(t,e);this._addParentTo(r)}return this},suspend:function(t){var e=this._alignTargetsInfo(t);e.forEach(function(t){var e=this.getTarget(t.name);if(e){e.suspend()}}.bind(this));return this},attachDisplay:function(t,e,i){return this.attachEvent(this.M_EVENTS.DISPLAY,t,e,i)},detachDisplay:function(t,e){return this.detachEvent(this.M_EVENTS.DISPLAY,t,e)},fireDisplay:function(t){return this.fireEvent(this.M_EVENTS.DISPLAY,t)},attachTitleChanged:function(t,e,i){this.attachEvent(this.M_EVENTS.TITLE_CHANGED,t,e,i);return this},detachTitleChanged:function(t,e){return this.detachEvent(this.M_EVENTS.TITLE_CHANGED,t,e)},fireTitleChanged:function(t){if(t.title!==this._sPreviousTitle){this._sPreviousTitle=t.title;this.fireEvent(this.M_EVENTS.TITLE_CHANGED,t)}return this},M_EVENTS:{DISPLAY:"display",TITLE_CHANGED:"titleChanged"},_alignTargetsInfo:function(t){if(t===undefined){return[]}if(!Array.isArray(t)){return typeof t==="object"?[t]:[{name:t}]}return t.map(function(t){if(typeof t!=="object"){t={name:t}}return t})},_createTarget:function(t,e){var i,r;r=s({_name:t},this._oConfig,e);i=this._constructTarget(r);i.attachDisplay(function(e){var i=e.getParameters();this.fireDisplay({name:t,view:i.view,control:i.control,config:i.config,data:i.data})},this);this._mTargets[t]=i;return i},_addParentTo:function(t){var e,i=t._oOptions.parent;if(!i){return}e=this._mTargets[i];if(!e){a.error("The target '"+t._oOptions._name+" has a parent '"+i+"' defined, but it was not found in the other targets",this);return}t._oParent=e},_constructTarget:function(t,i){return new e(t,this._oCache,i)},_setRootViewId:function(t){var e,i;for(e in this._mTargets){if(this._mTargets.hasOwnProperty(e)){i=this._mTargets[e]._oOptions;if(i.rootView===undefined){i.rootView=t}}}},_getTitleTargetName:function(t,e){var i,r;if(e){t=[e]}t=this._alignTargetsInfo(t);t.some(function(t){i=this.getTarget(t);while(i&&!i._oOptions.title){i=i._oParent}if(i){r=i._oOptions._name;return true}}.bind(this));return r},_forwardTitleChanged:function(t){this.fireTitleChanged({name:t.getParameter("name"),title:t.getParameter("title")})},_attachTitleChanged:function(t,e){var i,r;r=this._getTitleTargetName(t,e);if(r){i=this.getTarget(r)}if(this._oLastTitleTarget){this._oLastTitleTarget.detachTitleChanged(this._forwardTitleChanged,this);this._oLastTitleTarget._bIsDisplayed=false}if(i){i.attachTitleChanged({name:i._oOptions._name},this._forwardTitleChanged,this);this._oLastTitleTarget=i}else if(e){a.error('The target with the name "'+e+'" where the titleChanged event should be fired does not exist!',this)}}});return o});