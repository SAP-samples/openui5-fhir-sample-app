/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/core/Control","sap/ui/core/library","./library","sap/base/Log","sap/ui/events/KeyCodes","sap/ui/dom/jquery/Focusable"],function(t,e,i,n,r,o){"use strict";var a=i.TitleLevel;var s=e.extend("sap.uxap.ObjectPageSectionBase",{metadata:{abstract:true,library:"sap.uxap",properties:{title:{type:"string",group:"Appearance",defaultValue:null},titleLevel:{type:"sap.ui.core.TitleLevel",group:"Appearance",defaultValue:a.Auto},visible:{type:"boolean",group:"Appearance",defaultValue:true},importance:{type:"sap.uxap.Importance",group:"Behavior",defaultValue:n.Importance.High}},aggregations:{customAnchorBarButton:{type:"sap.m.Button",multiple:false}}}});s.prototype.init=function(){this._bInternalVisible=true;this._bInternalTitleVisible=true;this._sInternalTitle="";this._sInternalTitleLevel=a.Auto;this._isHidden=false;this._bRtl=sap.ui.getCore().getConfiguration().getRTL()};s.prototype.onAfterRendering=function(){if(this._getObjectPageLayout()){this._getObjectPageLayout()._requestAdjustLayout().catch(function(){r.debug("ObjectPageSectionBase :: cannot adjustLayout",this)});this._getObjectPageLayout()._setSectionsFocusValues()}};s.prototype.setCustomAnchorBarButton=function(t){var e=this.setAggregation("customAnchorBarButton",t,true);if(this._getObjectPageLayout()){this._getObjectPageLayout()._updateNavigation()}return e};s.prototype._setInternalVisible=function(t,e){if(t!=this._bInternalVisible){this._bInternalVisible=t;if(e){this.invalidate()}}};s.prototype._getInternalVisible=function(){return this._bInternalVisible};s.prototype._setInternalTitleVisible=function(t,e){if(t!=this._bInternalTitleVisible){this._bInternalTitleVisible=t;if(e){this.invalidate()}}};s.prototype._getInternalTitleVisible=function(){return this._bInternalTitleVisible};s.prototype._setInternalTitle=function(t,e){if(t!=this._sInternalTitle){this._sInternalTitle=t;if(e){this.invalidate()}}};s.prototype._getTitle=function(){return this._getInternalTitle()||this.getTitle()};s.prototype._getInternalTitle=function(){return this._sInternalTitle};s.prototype._getARIALevel=function(){return this._getTitleLevel().slice(-1)};s.prototype._getTitleLevel=function(){var t=this.getTitleLevel();return t===a.Auto?this._getInternalTitleLevel():t};s.prototype._setInternalTitleLevel=function(t){this._sInternalTitleLevel=t};s.prototype._getInternalTitleLevel=function(){return this._sInternalTitleLevel};s.prototype._getObjectPageLayout=function(){return n.Utilities.getClosestOPL(this)};s.prototype._notifyObjectPageLayout=function(){if(this._getObjectPageLayout()&&this._getObjectPageLayout().$().length){this._getObjectPageLayout()._requestAdjustLayoutAndUxRules()}};["addAggregation","insertAggregation","removeAllAggregation","removeAggregation","destroyAggregation"].forEach(function(t){s.prototype[t]=function(i,n,r,o){if(["addAggregation","removeAggregation"].indexOf(t)>-1){o=r}if(["removeAllAggregation","destroyAggregation"].indexOf(t)>-1){o=n}var a=e.prototype[t].apply(this,arguments);if(o!==true){this._notifyObjectPageLayout()}return a}});s.prototype.setVisible=function(t,e){if(this.getVisible()===t){return this}if(!this._getObjectPageLayout()){return this.setProperty("visible",t,e)}this.setProperty("visible",t,true);this._notifyObjectPageLayout();this.invalidate();return this};s.prototype.setTitle=function(t,e){this.setProperty("title",t,e);this._notifyObjectPageLayout();return this};s.prototype._shouldBeHidden=function(){return s._importanceMap[this.getImportance()]>s._importanceMap[this._sCurrentLowestImportanceLevelToShow]};s._importanceMap={Low:3,Medium:2,High:1};s.prototype._updateShowHideState=function(t){var e=this._getObjectPageLayout();this._isHidden=t;this.$().children(this._sContainerSelector).toggle(!t);if(e){e._requestAdjustLayout()}return this};s.prototype._getIsHidden=function(){return this._isHidden};s.prototype._expandSection=function(){return this._updateShowHideState(false)};s.prototype._showHideContent=function(){return this._updateShowHideState(!this._getIsHidden())};s.prototype._applyImportanceRules=function(t){this._sCurrentLowestImportanceLevelToShow=t;if(this.getDomRef()){this._updateShowHideState(this._shouldBeHidden())}else{this._isHidden=this._shouldBeHidden()}};s.PAGEUP_AND_PAGEDOWN_JUMP_SIZE=5;s.prototype.onkeydown=function(t){if(t.keyCode===o.SPACE&&t.srcControl.isA("sap.uxap.ObjectPageSection")){t.preventDefault()}if(t.keyCode===o.F7){var e=this.getSubSections(),i=e[0],n;if(e.length===1){n=i._oLastFocusedControlF7;if(n){n.$().trigger("focus")}else{i.$().firstFocusableDomRef().focus()}}else{if(i.getActions().length){i.getActions()[0].$().trigger("focus")}}}};s.prototype.onsapdown=function(t){this._handleFocusing(t,t.currentTarget.nextSibling)};s.prototype._handleFocusing=function(e,i){var n;if(this._targetIsCorrect(e)&&i){n=t(e.currentTarget).parent().children();e.preventDefault();i.focus();if(n.length>1){this._scrollParent(t(i).attr("id"))}}};s.prototype._targetIsCorrect=function(t){return t.srcControl===this};s.prototype.onsapright=function(t){var e=this._bRtl?"onsapup":"onsapdown";this[e](t)};s.prototype.onsapup=function(t){this._handleFocusing(t,t.currentTarget.previousSibling)};s.prototype.onsapleft=function(t){var e=this._bRtl?"onsapdown":"onsapup";this[e](t)};s.prototype.onsaphome=function(t){this._handleFocusing(t,t.currentTarget.parentElement.firstChild)};s.prototype.onsapend=function(t){this._handleFocusing(t,t.currentTarget.parentElement.lastChild)};s.prototype.onsappageup=function(e){if(!this._targetIsCorrect(e)){return}e.preventDefault();var i;var n=t(e.currentTarget).parent().children();var r;n.each(function(n,r){if(t(r).attr("id")===e.currentTarget.id){i=n-(s.PAGEUP_AND_PAGEDOWN_JUMP_SIZE+1);return}});if(i&&n[i]){n[i].focus();r=t(n[i]).attr("id")}else if(n[0]){n[0].focus();r=t(n[0]).attr("id")}if(n.length>1){this._scrollParent(r)}};s.prototype.onsappagedown=function(e){if(!this._targetIsCorrect(e)){return}e.preventDefault();var i;var n=t(e.currentTarget).parent().children();var r;n.each(function(n,r){if(t(r).attr("id")===e.currentTarget.id){i=n+s.PAGEUP_AND_PAGEDOWN_JUMP_SIZE+1;return}});if(i&&n[i]){n[i].focus();r=t(n[i]).attr("id")}else if(n[n.length-1]){n[n.length-1].focus();r=t(n[n.length-1]).attr("id")}if(n.length>1){this._scrollParent(r)}};s.prototype._scrollParent=function(t){if(this._getObjectPageLayout()){this._getObjectPageLayout().scrollToSection(t,0,10)}};return s});