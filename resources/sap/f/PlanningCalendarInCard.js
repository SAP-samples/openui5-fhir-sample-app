/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/delegate/DateNavigation","sap/ui/core/Control","sap/ui/core/format/DateFormat","sap/ui/core/ResizeHandler","sap/ui/unified/calendar/CalendarUtils","sap/ui/unified/calendar/CalendarDate","sap/ui/unified/calendar/YearRangePicker","sap/ui/unified/calendar/YearPicker","sap/ui/unified/calendar/MonthPicker","sap/m/Column","sap/m/library","sap/m/PlanningCalendar","sap/f/PlanningCalendarInCardLegend","./PlanningCalendarInCardRenderer"],function(e,t,i,r,a,o,s,n,h,c,l,_,g,d){"use strict";var u=_.extend("sap.f.PlanningCalendarInCard",{});var f=l.ScreenSize;var P=f.Desktop;u.prototype.init=function(){_.prototype.init.call(this,arguments);this._oInfoToolbar.addContent(this._getLegend());this.getAggregation("table").addColumn(new c({minScreenWidth:P,demandPopin:true}));this.getAggregation("table").setMode(l.ListMode.None)};u.prototype.onAfterRendering=function(){_.prototype.onAfterRendering.call(this,arguments);if(!this._sTwoColumnsResizeListener){this._sTwoColumnsResizeListener=r.register(this,this.resizeHandler)}};u.prototype.exit=function(){if(this._sTwoColumnsResizeListener){r.deregister(this._sTwoColumnsResizeListener);this._sTwoColumnsResizeListener=undefined}_.prototype.exit.call(this,arguments);if(this._oMonthPicker){this._oMonthPicker.destroy();this._oMonthPicker=null}if(this._oYearPicker){this._oYearPicker.destroy();this._oYearPicker=null}if(this._oYearRangePicker){this._oYearRangePicker.destroy();this._oYearRangePicker=null}};u.prototype.resizeHandler=function(e){e.control.toggleStyleClass("sapMPCInCardTwoColumns",e.target.getBoundingClientRect().width>576)};u.prototype._handlePickerButtonPress=function(e){var t;e.preventDefault();if(this._bYearPickerView){this._bYearRangePickerView=true;this._oYearPicker.setVisible(false);if(!this._oYearRangePicker){this._createYearRangePicker();this._oInfoToolbar.insertAggregation("content",this._oYearRangePicker,4)}else{this._oYearRangePicker.setVisible(true)}t=o.fromLocalJSDate(this.getStartDate());t.setMonth(0,1);this._oYearRangePicker.setDate(t.toLocalJSDate());this._getHeader()._oPickerBtn.setVisible(false)}else if(this._bMonthPickerView){this._bYearPickerView=true;this._oMonthPicker.setVisible(false);if(!this._oYearPicker){this._createYearPicker();this._oInfoToolbar.insertContent(this._oYearPicker,3)}else{this._oYearPicker.setVisible(true)}this._getHeader().setPickerText(this._formatYearPickerText())}else{this._bMonthPickerView=true;this._oInfoToolbar.getContent()[1].setVisible(false);if(!this._oMonthPicker){this._createMonthPicker();this._oInfoToolbar.insertContent(this._oMonthPicker,2)}else{this._oMonthPicker.setVisible(true)}this._getHeader().setPickerText(this._formatMonthPickerText())}};u.prototype._createYearRangePicker=function(){this._oYearRangePicker=new s({date:this.getStartDate(),select:function(){var e=o.fromLocalJSDate(this.getStartDate()),t;e.setYear(this._oYearRangePicker.getYear()+Math.floor(this._oYearRangePicker.getRangeSize()/2));t=e.toLocalJSDate();this.setStartDate(t);this._oYearRangePicker.setYear(t.getFullYear());this._oYearPicker.setDate(t);this._getHeader()._oPickerBtn.setVisible(true);this._getHeader().setPickerText(this._formatYearPickerText());this._bYearRangePickerView=false;this._oYearPicker.setVisible(true);this._oYearRangePicker.setVisible(false)}.bind(this)})};u.prototype._createYearPicker=function(){this._oYearPicker=new n({date:this.getStartDate(),select:function(){var e=o.fromLocalJSDate(this.getStartDate()),t;e.setYear(this._oYearPicker.getYear());t=e.toLocalJSDate();this.setStartDate(t);this._oYearPicker.setYear(t.getFullYear());this._getHeader().setPickerText(this._formatMonthPickerText());this._bYearPickerView=false;this._oMonthPicker.setVisible(true);this._oYearPicker.setVisible(false)}.bind(this)})};u.prototype._createMonthPicker=function(){this._oMonthPicker=new h({month:this.getStartDate().getMonth(),select:function(){var e=o.fromLocalJSDate(this.getStartDate());e.setMonth(this._oMonthPicker.getMonth());this.setStartDate(e.toLocalJSDate());this._getHeader().setPickerText(this._formatPickerText());this._bMonthPickerView=false;this._oInfoToolbar.getContent()[1].setVisible(true);this._oMonthPicker.setVisible(false)}.bind(this)})};u.prototype._formatMonthPickerText=function(){return i.getDateInstance({format:"y"}).format(this.getStartDate())};u.prototype._formatYearPickerText=function(){var e=this._oYearPicker.getYear(),t=this._oYearPicker.getYears(),i=e-Math.floor(t/2),r=e+t/2-1;return""+i+" - "+r};u.prototype._applyArrowsLogic=function(e){var t=e?-1:1,i,r=this._oInfoToolbar.getContent(),a;if(!this._bMonthPickerView){_.prototype._applyArrowsLogic.apply(this,arguments)}else{for(var s=2;s<r.length;s++){a=r[s];if(a.getVisible()){i=o.fromLocalJSDate(this.getStartDate());if(a.isA("sap.ui.unified.calendar.MonthPicker")){i.setYear(i.getYear()+t);this.setStartDate(i.toLocalJSDate());this._getHeader().setPickerText(this._formatMonthPickerText());return}else if(a.isA("sap.ui.unified.calendar.YearRangePicker")){e?a.previousPage():a.nextPage();return}else if(a.isA("sap.ui.unified.calendar.YearPicker")){e?a.previousPage():a.nextPage();this._getHeader().setPickerText(this._formatYearPickerText());return}}}}};u.prototype._handleTodayPress=function(){var e=new Date,t=o.fromLocalJSDate(e),i;if(this._bYearRangePickerView){this._oYearRangePicker.setYear(t.toLocalJSDate().getFullYear());this.setStartDate(t.toLocalJSDate());return}if(this._bYearPickerView){this._oYearPicker.setYear(t.toLocalJSDate().getFullYear());this.setStartDate(t.toLocalJSDate());return}if(this._bMonthPickerView){this._oMonthPicker.setMonth(t.toLocalJSDate().getMonth());this.setStartDate(t.toLocalJSDate());return}i=a.getFirstDateOfMonth(a._createUniversalUTCDate(e,undefined,true));this._adjustSelectedDate(o.fromLocalJSDate(e));e=a._createLocalDate(i,true);this.setStartDate(e);this._dateNav.setCurrent(e);this._getHeader().setPickerText(this._formatPickerText());this._updateTodayButtonState();this.fireStartDateChange();this.fireEvent("_todayPressed")};u.prototype._attachHeaderEvents=function(){_.prototype._attachHeaderEvents.call(this,arguments);this._getHeader().attachEvent("_pickerButtonPress",this._handlePickerButtonPress,this);return this};u.prototype._getLegend=function(){if(!this._oLegend){this._oLegend=new g({columnWidth:"120px",standardItems:[]})}return this._oLegend};u.prototype.addRow=function(e){var t=this._createPlanningCalendarListItem(e);t.addCell(e._getMoreButton());this.addAggregation("rows",e,true);this.getAggregation("table").addItem(t);return this};u.prototype.insertRow=function(e,t){var i=this._createPlanningCalendarListItem(e);i.addCell(e._getMoreButton());this.insertAggregation("rows",e,t);this.getAggregation("table").insertItem(i,t,true);return this};u.prototype._insertInterval=function(e){_.prototype._insertInterval.call(this,e);this._oInfoToolbar.addContent(this._oInfoToolbar.removeContent(this._getLegend()))};u.prototype._shiftStartDate=function(e){return e};u.prototype._setSelectionMode=function(){return};return u});