/*!
 * SAP SE
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/fhir/model/r4/FHIRFilterOperatorUtils","sap/fhir/model/r4/FHIRFilterOperator","sap/ui/model/ChangeReason","sap/base/util/merge","sap/base/util/deepEqual"],function(e,r,t,i,a){"use strict";var n={};n.createSortParams=function(e){var r;if(e&&Array.isArray(e)&&e.length>0){r="";for(var t=0;t<e.length;t++){var i=e[t];if(i.bDescending){r+="-"}r+=i.sPath;if(t!==e.length-1){r+=","}}}return r};n.addRequestQueryParameters=function(e,r){if(e.mParameters&&e.mParameters.hasOwnProperty("request")){if(!r.urlParameters){r.urlParameters={}}for(var t in e.mParameters.request){r.urlParameters[t]=e.mParameters.request[t]}}};n.insertArrayIntoArray=function(e,r,t){Array.prototype.splice.apply(e,[t,0].concat(r))};n.removeArrayFromArray=function(e,r){return e.filter(function(e){return r.indexOf(e)<0})};n.getIndexOfValueInArray=function(e,r){if(r&&Array.isArray(r)){for(var t=0;t<r.length;t++){var i=r[t];if(a(i,e)){return t}}return-1}return-1};n.isSubset=function(e,r){return e.every(function(e){return r.indexOf(e)>=0})};n.isQuantity=function(e){return false};n.isString=function(e){return typeof e==="string"};n.isObject=function(e){return typeof e==="object"};n.isNumber=function(e){return typeof e==="number"};n.isEmptyObject=function(e){for(var r in e){return false}return true};n.filterArray=function(e,r,t,i){return e.filter(function(e){if(i){return i(e)}else{return e[r]===t}})};n.filterObject=function(e,r,t,i,a,n){if(i>0){for(var s in e){this.filterObject(e[s],r,t,i-1,a,n)}}if(i===0&&e[r]===t){if(n){a.push(n(e))}else{a.push(e)}}};n.deepClone=function(e){if(e&&typeof e==="object"){if(Array.isArray(e)){return i([],e)}else if(e instanceof Date){return new Date(e.getTime())}else{return i({},e)}}else if(e){return e}return undefined};n.uuidv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=Math.floor(Math.random()*16),t=e==="x"?r:r%4+8;return t.toString(16)})};n.getLinkUrl=function(e,r){var t=this.filterArray(e,"relation",r)[0];return t&&t.url?t.url:undefined};n.getNumberOfLevelsByPath=function(e){return this.countOccurrence(e,"/")};n.countOccurrence=function(e,r){var t=-1;if(e===undefined){throw new Error("sBase is undefined")}if(!this.isString(e)){throw new Error("sBase is not a string")}for(var i=-2;i!==-1;t++){i=e.indexOf(r,i+1)}return t};n.checkStringParameter=function(e,r){if(!e.hasOwnProperty(r)){throw new Error("Missing parameter: '"+r+"'.")}else if(!n.isString(e[r])){throw new Error("Unsupported parameter type: '"+r+"'. Parameter has to be of type string.")}};n.checkPathParameter=function(e,r){this.checkStringParameter(e,r);if(e[r].startsWith("/")){throw new Error("Unsupported parameter: '"+r+"'. Parameter must not start with a '/'.")}else if(e[r].endsWith("/")){throw new Error("Unsupported parameter: '"+r+"'. Parameter must not end with a '/'.")}};n.checkFHIRSearchParameter=function(e,r){this.checkStringParameter(e,r)};n.checkRegularExpression=function(e,r){if(!e){throw new Error("Empty string. Can not check the regular expression: "+r+" for an undefined text.")}if(!r){throw new Error("Empty regular expression")}return e.match(r)?true:false};n.splitPath=function(e){var r=/((\s*(\[|ยง)(.*?)(\]|ยง)\s*)+)/g;var t=e.match(r);var i=e.replace(r,"");var a=i.split("/");for(var n=1;n<a.length;n++){if(!a[n]&&t){a[n]=t.shift()}}return a};n.filterBuilder=function(e,r,t,i,a,n,s){if(a===undefined){a=0}if(e){for(var u=0;u<e.length;u++){var f=e[u];if(f._bMultiFilter&&a<=t){this.filterBuilder(f.aFilters,r,t,i,a+1,f._bMultiFilter,f.bAnd)}else if(a>t){throw new Error("A depth of "+a+" is not supported for simple filtering, please reduce it to a maximum of 2")}else{this._filterBuilder(f,r,i,n,s)}}}};n._filterBuilder=function(t,i,a,n,s){var u=t.sPath;var f=e.getFHIRSearchParameterModifier(t);var o=e.getFilterValue(t.oValue1);var c=e.getFHIRSearchPrefix(t);var l;if(c){l=c+o}else{l=o}if(a){i.filter=t.oValue1}else if(t.sOperator===r.BT){var h=e.getFilterValue(t.oValue2);i[u+f]=["ge"+o,"le"+h]}else if(n&&!s){if(i[u+f]){i[u+f].push(l)}else{i[u+f]=[l]}}else{i[u+f]=l}};n.filter=function(e,r){if(r.bPendingRequest){var i=function(){if(!r.bPendingRequest){r.detachDataReceived(i);r.bIsDataReceivedAttached=false;r.aFilters=r.aFilterCache;r.refresh(t.Filter)}};if(!r.bIsDataReceivedAttached){r.bIsDataReceivedAttached=true;r.attachDataReceived(i)}r.aFilterCache=e}else{r.aFilters=e;r.refresh(t.Filter)}};n.sort=function(e,r,i){if(r.bPendingRequest){var a=function(){if(!r.bPendingRequest){r.detachDataReceived(a);r.bIsDataReceivedAttached=false;r.aSorters=r.aSortersCache;if(i){r.refresh(t.Sort)}}};if(!r.bIsDataReceivedAttached){r.bIsDataReceivedAttached=true;r.attachDataReceived(a)}r.aSortersCache=e}else{r.aSorters=e;if(i){r.refresh(t.Sort)}}};n.isRequestable=function(e){return e&&(e.indexOf("$")>-1||(e.match(/\//g)||[]).length<=2||e.indexOf("_history")>-1)};n.isContextBinding=function(e){return e&&e.getMetadata().getName()==="sap.fhir.model.r4.FHIRContextBinding"};n.isPropertyBinding=function(e){return e&&e.getMetadata().getName()==="sap.fhir.model.r4.FHIRPropertyBinding"};n.generateFullUrl=function(e,r,t,i){var a;if(e){switch(e.getName()){case"sap.fhir.model.r4.type.Uuid":a="urn:"+e.toString()+":";if(t&&e.validateValue(t)){a+=t}else{a+=this.uuidv4()}break;case"sap.fhir.model.r4.type.Url":a=i+r;break;default:break}}return a};return n});