/*!
 * SAP SE
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/fhir/model/r4/FHIRFilterOperatorUtils","sap/fhir/model/r4/FHIRFilterOperator","sap/fhir/model/r4/FHIRFilterComplexOperator","sap/ui/model/ChangeReason","sap/base/util/merge","sap/base/util/deepEqual","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/model/FilterProcessor","sap/ui/model/FilterType"],function(e,r,t,i,a,n,s,f,o,l){"use strict";var u={};u.createSortParams=function(e){var r;if(e&&Array.isArray(e)&&e.length>0){r="";for(var t=0;t<e.length;t++){var i=e[t];if(i.bDescending){r+="-"}r+=i.sPath;if(t!==e.length-1){r+=","}}}return r};u.addRequestQueryParameters=function(e,r){if(e.mParameters&&e.mParameters.hasOwnProperty("request")){if(!r.urlParameters){r.urlParameters={}}for(var t in e.mParameters.request){r.urlParameters[t]=e.mParameters.request[t]}}};u.insertArrayIntoArray=function(e,r,t){Array.prototype.splice.apply(e,[t,0].concat(r))};u.removeArrayFromArray=function(e,r){return e.filter(function(e){return r.indexOf(e)<0})};u.getIndexOfValueInArray=function(e,r){if(r&&Array.isArray(r)){for(var t=0;t<r.length;t++){var i=r[t];if(n(i,e)){return t}}return-1}return-1};u.isSubset=function(e,r){return e.every(function(e){return r.indexOf(e)>=0})};u.isQuantity=function(e){return false};u.isString=function(e){return typeof e==="string"};u.isObject=function(e){return typeof e==="object"};u.isNumber=function(e){return typeof e==="number"};u.isEmptyObject=function(e){for(var r in e){return false}return true};u.filterArray=function(e,r,t,i){return e.filter(function(e){if(i){return i(e)}else{return e[r]===t}})};u.filterObject=function(e,r,t,i,a,n){if(i>0){for(var s in e){this.filterObject(e[s],r,t,i-1,a,n)}}if(i===0&&e[r]===t){if(n){a.push(n(e))}else{a.push(e)}}};u.deepClone=function(e){if(e&&typeof e==="object"){if(Array.isArray(e)){return a([],e)}else if(e instanceof Date){return new Date(e.getTime())}else{return a({},e)}}else if(e){return e}return undefined};u.uuidv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=Math.floor(Math.random()*16),t=e==="x"?r:r%4+8;return t.toString(16)})};u.getLinkUrl=function(e,r){var t=this.filterArray(e,"relation",r)[0];return t&&t.url?t.url:undefined};u.getNumberOfLevelsByPath=function(e){return this.countOccurrence(e,"/")};u.countOccurrence=function(e,r){var t=-1;if(e===undefined){throw new Error("sBase is undefined")}if(!this.isString(e)){throw new Error("sBase is not a string")}for(var i=-2;i!==-1;t++){i=e.indexOf(r,i+1)}return t};u.checkStringParameter=function(e,r){if(!e.hasOwnProperty(r)){throw new Error("Missing parameter: '"+r+"'.")}else if(!u.isString(e[r])){throw new Error("Unsupported parameter type: '"+r+"'. Parameter has to be of type string.")}};u.checkPathParameter=function(e,r){this.checkStringParameter(e,r);if(e[r].startsWith("/")){throw new Error("Unsupported parameter: '"+r+"'. Parameter must not start with a '/'.")}else if(e[r].endsWith("/")){throw new Error("Unsupported parameter: '"+r+"'. Parameter must not end with a '/'.")}};u.checkFHIRSearchParameter=function(e,r){this.checkStringParameter(e,r)};u.checkRegularExpression=function(e,r){if(!e){throw new Error("Empty string. Can not check the regular expression: "+r+" for an undefined text.")}if(!r){throw new Error("Empty regular expression")}return e.match(r)?true:false};u.splitPath=function(e){var r=/((\s*(\[|ยง)(.*?)(\]|ยง)\s*)+)/g;var t=e.match(r);var i=e.replace(r,"");var a=i.split("/");for(var n=1;n<a.length;n++){if(!a[n]&&t){a[n]=t.shift()}}return a};u.filterBuilder=function(e,r,t,i,a,n,s){if(a===undefined){a=0}if(e){for(var f=0;f<e.length;f++){var o=e[f];if(!t){if(!r._filter){r._filter=""}this._complexFilterBuilder(o,r)}else if(o._bMultiFilter&&a<=t){this.filterBuilder(o.aFilters,r,t,i,a+1,o._bMultiFilter,o.bAnd)}else if(a>t){throw new Error("A depth of "+a+" is not supported for simple filtering, please reduce it to a maximum of 2")}else{this._filterBuilder(o,r,i,n,s)}}}};u._filterBuilder=function(t,i,a,n,s){var f=t.sPath;var o=e.getFHIRSearchParameterModifier(t);var l=e.getFilterValue(t.oValue1);var u=e.getFHIRSearchPrefix(t);var c;if(u){c=u+l}else{c=l}if(a){i.filter=t.oValue1}else if(t.sOperator===r.BT){var d=e.getFilterValue(t.oValue2);i[f+o]=[r.GE.toLowerCase()+l,r.LE.toLowerCase()+d]}else if(n&&!s){if(i[f+o]){i[f+o].push(c)}else{i[f+o]=[c]}}else{i[f+o]=c}};u._complexFilterBuilder=function(r,i){var a;if(r instanceof s){if(r._bMultiFilter){a=r.bAnd&&r.bAnd==true?"and":"or";if(r.aFilters){i._filter=i._filter+"( ";this._complexFilterBuilder(r.aFilters[0],i);for(var n=1;n<r.aFilters.length;n++){if(a){i._filter=i._filter+" "+a+" "}this._complexFilterBuilder(r.aFilters[n],i)}i._filter=i._filter+" )"}}else{var f=r.sPath;var o=e.getFHIRFilterPrefix(r);var l=e.getFilterValueForComplexFilter(r.sValueType,r.oValue1);var u;var c;if(r.sOperator===t.BT){u=e.getFilterValueForComplexFilter(r.sValueType,r.oValue2);c="( "+f+" "+t.GE.toLowerCase()+" "+l+" and "+f+" "+t.LE.toLowerCase()+" "+u+" )"}else{c=f+" "+o+" "+l}i._filter=i._filter+c}}};u.filter=function(e,r,t){if(!e){e=[]}if(e instanceof s){e=[e]}if(t==l.Application){r.aApplicationFilters=e}if(!r.aApplicationFilters||!Array.isArray(r.aApplicationFilters)||r.aApplicationFilters.length===0){r.aApplicationFilters=[]}r.oCombinedFilter=o.combineFilters(r.aFilters,r.aApplicationFilters);if(r.bPendingRequest){var a=function(){if(!r.bPendingRequest){r.detachDataReceived(a);r.bIsDataReceivedAttached=false;r.aFilters=r.aFilterCache;r.refresh(i.Filter)}};if(!r.bIsDataReceivedAttached){r.bIsDataReceivedAttached=true;r.attachDataReceived(a)}r.aFilterCache=e}else{r.aFilters=e;r.refresh(i.Filter)}};u.sort=function(e,r,t){if(!e){e=[]}if(e instanceof f){e=[e]}if(r.bPendingRequest){var a=function(){if(!r.bPendingRequest){r.detachDataReceived(a);r.bIsDataReceivedAttached=false;r.aSorters=r.aSortersCache;if(t){r.refresh(i.Sort)}}};if(!r.bIsDataReceivedAttached){r.bIsDataReceivedAttached=true;r.attachDataReceived(a)}r.aSortersCache=e}else{r.aSorters=e;if(t){r.refresh(i.Sort)}}};u.isRequestable=function(e){return e&&(e.indexOf("$")>-1||(e.match(/\//g)||[]).length<=2||e.indexOf("_history")>-1)};u.isContextBinding=function(e){return e&&e.getMetadata().getName()==="sap.fhir.model.r4.FHIRContextBinding"};u.isPropertyBinding=function(e){return e&&e.getMetadata().getName()==="sap.fhir.model.r4.FHIRPropertyBinding"};u.generateFullUrl=function(e,r,t,i){var a;if(e){switch(e.getName()){case"sap.fhir.model.r4.type.Uuid":a="urn:"+e.toString()+":";if(t&&e.validateValue(t)){a+=t}else{a+=this.uuidv4()}break;case"sap.fhir.model.r4.type.Url":a=i+r;break;default:break}}return a};u.getIdFromOperationOutcome=function(e){var r=[];var t;var i;for(var a in e){if(e.hasOwnProperty(a)){var n=e[a];var s=n._aIssue[0];if(s){i=s.details.text;if(i){t=i.match(/[0-9a-fA-F]{8}(?:-[0-9a-fA-F]{4}){3}-[0-9a-fA-F]{12}/)}if(t&&t.length>0){r.push(t[0])}}}}return r};u.filterResourcesByIds=function(e,r){function t(e){return!r.includes(e.id)}return e.filter(t)};return u});
//# sourceMappingURL=FHIRUtils.js.map