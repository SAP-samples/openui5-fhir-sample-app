//@ui5-bundle sap/fhir/library-preload.js
sap.ui.predefine("sap/fhir/library",function(){"use strict";sap.ui.getCore().initLibrary({name:"sap.fhir",version:"2.1.1",noLibraryCSS:true,dependencies:["sap.ui.core"],controls:[],types:[]});return sap.fhir});
sap.ui.predefine("sap/fhir/model/r4/Context",["sap/base/Log","sap/ui/model/ChangeReason","sap/fhir/model/r4/FHIRUtils","sap/ui/model/Context"],function(e,t,i,n){"use strict";var s=n.extend("sap.fhir.model.r4.Context",{constructor:function(e,t,i,s){n.call(this,e,i);this.oBinding=t;this.sGroupId=s}});s.prototype._loadContext=function(e){var n=this.oModel.getBindingInfo(this.sPath,this.oBinding.oContext,this.oBinding.bUnique);if(n&&!this.oBinding.bPendingRequest){var s=this.oModel._getProperty(this.oModel.mChangedResources,n.getBinding().slice(0,2));if(!s||s.method!=="POST"){var o=this.oModel._getProperty(this.oModel.oData,n.getBinding());if(!o||e===t.Refresh){var r=function(t){if(t.message!=="abort"){this._markAsReady(t&&t.total,e)}}.bind(this);var d={binding:this.oBinding,forceDirectCall:false,success:r,error:r};i.addRequestQueryParameters(this.oBinding,d);this.oBinding.bPendingRequest=true;this.oModel.loadData(n.getRequestPath(),d);this.bPendingRequest=true}else{this.oBinding.bIsLoaded=true}}else{this.oBinding.bIsCreatedResource=true}}};s.prototype.getBinding=function(){return this.oBinding};s.prototype._markAsReady=function(e,i){this.iTotal=e;this.oBinding.bInitial=false;this.oBinding.bPendingRequest=false;this.oBinding._fireChange({reason:i||t.Change})};s.prototype.refresh=function(e){this.oBinding.bInitial=true;this._loadContext(t.Refresh)};s.create=function(e,t,i,n){if(e.mContexts.hasOwnProperty(i)&&!e.mContexts[i].hasOwnProperty(t.sId)){e.mContexts[i][t.sId]=new s(e,t,i,n)}else if(!e.mContexts.hasOwnProperty(i)){e.mContexts[i]={};e.mContexts[i][t.sId]=new s(e,t,i,n)}return e.mContexts[i][t.sId]};return s});
sap.ui.predefine("sap/fhir/model/r4/FHIRContextBinding",["sap/ui/model/ContextBinding","sap/ui/model/ChangeReason","sap/fhir/model/r4/FHIRUtils","sap/fhir/model/r4/Context","sap/base/Log"],function(t,e,o,n,s){"use strict";var i=t.extend("sap.fhir.model.r4.FHIRContextBinding",{constructor:function(s,i,r,h){t.call(this,s,i,r,h);this.mParameters=h;this.sId=o.uuidv4();this.sGroupId=h&&h.groupId||r&&r.sGroupId;this.bUnique=h&&h.unique;this.oElementContext=n.create(this.oModel,this,this.sPath,this.sGroupId);var a=o.getNumberOfLevelsByPath(this.sPath)===1?e.Refresh:undefined;this.oElementContext._loadContext(a)}});i.prototype.checkUpdate=function(t){if(this.isRelative()||this.bIsCreatedResource||this.bIsLoaded){this.oElementContext._markAsReady(this.oElementContext.iTotal)}};i.prototype.refresh=function(t){this.oElementContext.refresh(t)};i.prototype.getBoundContext=function(){return this.oElementContext};i.prototype.setContext=function(t){this.oContext=t;this._fireChange({reason:e.Context})};return i});
sap.ui.predefine("sap/fhir/model/r4/FHIRFilter",["sap/ui/model/Filter"],function(e){"use strict";var i=e.extend("sap.fhir.model.r4.FHIRFilter",{constructor:function(i,r,t,l){e.call(this,i,r,t,l);this.sValueType=i?i.valueType:undefined}});return i});
sap.ui.predefine("sap/fhir/model/r4/FHIRFilterComplexOperator",["sap/fhir/model/r4/FHIRFilterOperator"],function(r){"use strict";var e={PR:"pr",PO:"po",SS:"ss",SB:"sb",IN:"in",NI:"ni",RE:"re"};return Object.assign(e,r)});
sap.ui.predefine("sap/fhir/model/r4/FHIRFilterOperator",["sap/ui/model/FilterOperator"],function(e){"use strict";var i={Missing:"Missing",SA:"sa",EB:"eb",AP:"ap"};return Object.assign(i,e)});
sap.ui.predefine("sap/fhir/model/r4/FHIRFilterOperatorUtils",["sap/fhir/model/r4/FHIRFilterOperator","sap/fhir/model/r4/FHIRFilterType","sap/fhir/model/r4/FHIRFilterComplexOperator"],function(e,a,r){"use strict";var s={};s.getFHIRSearchParameterModifier=function(a){var r="";if(this.isSearchParameterModifiable(a)||e.Missing===a.sOperator){switch(a.sOperator){case e.Contains:r=":contains";break;case e.StartsWith:r="";break;case e.EQ:r=":exact";break;case e.Missing:r=":missing";break;default:break}}return r};s.isSearchParameterModifiable=function(e){return e.sValueType!==a.date&&e.sValueType!==a.number&&(typeof e.oValue1==="string"||Array.isArray(e.oValue1))};s.isSearchParameterPrefixable=function(e){return!(typeof e.oValue1==="string"||Array.isArray(e.oValue1))||e.sValueType===a.date||!isNaN(e.oValue1)};s.getFilterValue=function(e){var a=e;if(e instanceof Date){a=e.toISOString()}return a};s.getFHIRSearchPrefix=function(a){var r;if(this.isSearchParameterPrefixable(a)){switch(a.sOperator){case e.EQ:r="eq";break;case e.NE:r="ne";break;case e.GT:r="gt";break;case e.GE:r="ge";break;case e.LT:r="lt";break;case e.LE:r="le";break;case e.SA:r="sa";break;case e.EB:r="eb";break;case e.AP:r="ap";break;default:break}}return r};s.getFHIRFilterPrefix=function(e){var a;switch(e.sOperator){case r.EQ:a="eq";break;case r.NE:a="ne";break;case r.GT:a="gt";break;case r.GE:a="ge";break;case r.LT:a="lt";break;case r.LE:a="le";break;case r.SA:a="sa";break;case r.EB:a="eb";break;case r.AP:a="ap";break;case r.StartsWith:a="sw";break;case r.EndsWith:a="ew";break;case r.Contains:a="co";break;case r.PR:a="pr";break;case r.PO:a="po";break;case r.SS:a="ss";break;case r.SB:a="sb";break;case r.IN:a="in";break;case r.NI:a="ni";break;case r.RE:a="re";break;default:break}return a};s.getFilterValueForComplexFilter=function(e,r){var s=e&&e===a.string?true:false;var t;if(s){t='"'+r+'"'}else if(r instanceof Date){t=r.toISOString()}else{t=r}return t};return s});
sap.ui.predefine("sap/fhir/model/r4/FHIRFilterProcessor",["sap/ui/model/FilterProcessor","sap/ui/model/Filter","sap/fhir/model/r4/FHIRFilterOperator","sap/base/Log"],function(e,r,t,i){"use strict";var a={};a._evaluateFilter=function(r,t,i){var a,n;e._normalizeCache={true:{},false:{}};if(r.aFilters){return this._evaluateMultiFilter(r,t,i)}a=i(t,r.sPath);n=this.getFilterFunction(r);if(!r.fnCompare||r.bCaseSensitive!==undefined){a=e.normalizeFilterValue(a,r.bCaseSensitive)}return n(a)};a.getFilterFunction=function(r){if(r.sOperator===t.Missing){return function(e,r){return e===r}}else{return e.getFilterFunction(r)}};a._evaluateMultiFilter=function(e,r,t){var i=this,a=!!e.bAnd,n=e.aFilters,l,s,u=a;for(var o=0;o<n.length;o++){l=n[o];s=i._evaluateFilter(l,r,t);if(a){if(!s){u=false;break}}else if(s){u=true;break}}return u};return a});
sap.ui.predefine("sap/fhir/model/r4/FHIRFilterType",function(){"use strict";var e={string:"string",date:"date",number:"number"};return e});
sap.ui.predefine("sap/fhir/model/r4/FHIRListBinding",["sap/ui/model/ListBinding","sap/ui/model/ChangeReason","sap/ui/model/Sorter","sap/ui/model/FilterProcessor","sap/ui/model/SorterProcessor","sap/fhir/model/r4/FHIRUtils","sap/fhir/model/r4/OperationMode","sap/ui/model/Filter","sap/fhir/model/r4/lib/HTTPMethod","sap/base/Log","sap/base/util/each","sap/fhir/model/r4/Context"],function(e,t,i,s,r,n,o,a,h,u,l,d){"use strict";var f=e.extend("sap.fhir.model.r4.FHIRListBinding",{constructor:function(t,s,r,h,u,l){e.apply(this,arguments);this.aFilters=u instanceof a?[u]:u;this.aSorters=h instanceof i?[h]:h;this.mParameters=l;this.sOperationMode=l&&l.operationMode||this.oModel.sDefaultOperationMode;if(this.sOperationMode!==o.Server){throw new Error("Unsupported OperationMode: "+this.sOperationMode+". Only sap.fhir.model.r4.OperationMode.Server is supported.")}this.sGroupId=l&&l.groupId||r&&r.sGroupId;this.bUnique=l&&l.unique;if(l){this.bValueSetLookupInStructureDefinition=l.valueSetLookupInStructureDefinition===undefined?true:l.valueSetLookupInStructureDefinition}else{this.bValueSetLookupInStructureDefinition=true}this.sId=n.uuidv4();this._resetData()}});f.prototype._buildParameters=function(e){var t={urlParameters:{_sort:n.createSortParams(this.aSorters),_count:e}};n.addRequestQueryParameters(this,t);n.filterBuilder(this.aFilters,t.urlParameters,this.oModel.iSupportedFilterDepth,this._isValueSet());return t};f.prototype.getContexts=function(e,t){if(!this.iLength&&t!==undefined){this.iLength=t>this.oModel.iSizeLimit?this.oModel.iSizeLimit:t}else if(!this.iLength){this.iLength=this.oModel.iSizeLimit}var i=this._buildParameters(this.iLength);var s=function(t){if(t.total===undefined){throw new Error('FHIR Server error: The "total" property is missing in the response for the requested FHIR resource '+this.sPath)}this.bDirectCallPending=false;if(!this.aKeys){this.aKeys=[];e=0}else{e=this.aKeys.length}if(t.entry&&t.entry.length){var i;var s=this.oModel.getBindingInfo(this.sPath,this.oContext,this.bUnique);var r=s.getResourceType();for(var n=0;n<t.entry.length;n++){i=t.entry[n].resource;s=this.oModel.getBindingInfo(this.sPath,this.oContext,this.bUnique,i);if(i.resourceType===r){this.aKeys[e+n]=s.getAbsolutePath().substring(1)}}}this._markSuccessRequest(t,t.total)}.bind(this);var r=function(e){var t=e.expansion.total||e.expansion.contains&&e.expansion.contains.length||0;this._buildKeys("ValueSet/"+"§"+e.expansion.identifier+"§",e.expansion.contains,t);this._markSuccessRequest(e,t)}.bind(this);var n=function(){var e=this._getValueSetUriFromStructureDefinition();if(e){this._submitRequest("/ValueSet/$expand",{urlParameters:{url:e,displayLanguage:sap.ui.getCore().getConfiguration().getLanguage()}},r)}else{this._loadResources(t)}}.bind(this);var o=function(e){this.bDirectCallPending=false;if(e&&e.entry){this.oStructureDefinition=e.entry[0].resource;n()}else{this.bPendingRequest=false;this.bInitial=false;var t=this.oModel.getBindingInfo(this.sPath,this.oContext,this.bUnique);var i=this.oModel.getProperty(t.getResourcePath())||{};i.resourceType=i.resourceType||t.getResourceType();var s=this.oModel.getStructureDefinitionUrl(i);throw new Error("The structuredefinition "+s+" could not be loaded from the server for binding with path "+t.getRelativePath())}}.bind(this);if(!this.bPendingRequest&&!this.bResourceNotAvailable){if(this._isValueSetHardCoded()&&this.iTotalLength===undefined){i.urlParameters.displayLanguage=sap.ui.getCore().getConfiguration().getLanguage();this._submitRequest("/ValueSet/$expand",i,r)}else if(!this.aSortersCache&&!this.aFilterCache&&this.sNextLink&&t>this.iLastLength){this.iLastLength+=this.iLength;this._submitRequest(this.sNextLink,undefined,s,true)}else if(this.iTotalLength===undefined){this.iLastLength=this.iLength;this._loadProfile(o,n,s,i,t)}else if(!this._isValueSet()){if(t>this.iLastLength){this.iLastLength+=this.iLength}this._loadResources(this.iLastLength)}}this._buildContexts(t);return this.aContexts};f.prototype._loadResources=function(e){var t=this.oModel.getBindingInfo(this.sPath,this.oContext,this.bUnique);var i=this.oModel.getProperty(this.sPath,this.oContext);var s=0;if(t&&t.getAbsolutePath().endsWith("]")){s=i&&Object.keys(i).length;this._buildKeys(t.getAbsolutePath().substring(1),i,s)}else if(Array.isArray(i)){var r=this.oModel.getProperty(this.sPath,this.oContext,this.oModel.oDataServerState);var o=r?Object.keys(r).length:0;s=Object.keys(i).length;this.iClientChanges=s-o;this._buildKeys(t.getAbsolutePath().substring(1),i,e||s);s-=this.iClientChanges}else if(i&&typeof i==="object"){var a=this.oModel.mOrderResources[t.getResourceType()];this.iClientChanges=a&&a.length||0;if(this.iClientChanges>0){this.aKeys=a.concat(this.aKeysServerState)}else{this.aKeys=n.deepClone(this.aKeysServerState)}s=this.aKeys.length-this.iClientChanges}else{this.iClientChanges=0;this.aKeys=this.aKeysServerState}if(this.iTotalLength===undefined){this._markSuccessRequest(i,s)}};f.prototype._buildContexts=function(e){if(!this.aContexts){this.aContexts=[]}if(this.aKeys){if(e===undefined||e>this.aKeys.length||isNaN(e)){e=this.aKeys.length}this.aContexts=[];for(var t=0;t<e;t++){this.aContexts.push(d.create(this.oModel,this,"/"+this.aKeys[t],this.sGroupId))}}};f.prototype._submitRequest=function(e,t,i,s){var r=function(e){if(e.message!=="abort"){this.bPendingRequest=false;this.bResourceNotAvailable=true;this.fireDataReceived({data:e})}}.bind(this);this.bDirectCallPending=s;if(!t){t={}}t.binding=this;t.forceDirectCall=s;t.successBeforeMapping=i;t.error=r;this.oModel.loadData(e,t);this.bPendingRequest=true};f.prototype._buildKeys=function(e,t,i){this.aKeys=[];var s=0;for(var r in t){var n=e+"/"+r;if(s<i){this.aKeys[s]=n;s++}}};f.prototype._markSuccessRequest=function(e,t){if(e&&e.hasOwnProperty("link")){this.sNextLink=n.getLinkUrl(e.link,"next");this.sPrevLink=n.getLinkUrl(e.link,"previous")}this.aKeysServerState=n.deepClone(this.aKeys);this.iTotalLength=t;this.bPendingRequest=false;this.bInitial=false;this.oModel.attachAfterUpdate(function(){this.fireDataReceived({data:e})}.bind(this))};f.prototype._loadProfile=function(e,t,i,s,r){if(!this.isRelative()){this._submitRequest(this.sPath,s,i)}else if(this.oContext&&this.bValueSetLookupInStructureDefinition){var o=this.oModel.getBindingInfo(this.sPath,this.oContext,this.bUnique);var a=this.oModel.getProperty(o.getResourcePath())||{};a.resourceType=a.resourceType||o.getResourceType();var h=this.oModel.getStructureDefinitionUrl(a);var u=[];n.filterObject(this.oModel.oData.StructureDefinition,"url",h,1,u);if(u.length>0){this.oStructureDefinition=u[0];t()}else{this._submitRequest("/StructureDefinition",{urlParameters:{url:h}},e,true)}}else{this._loadResources(r)}};f.prototype.checkUpdate=function(e,i,s){var r=this.oModel.getBindingInfo(this.sPath,this.oContext,this.bUnique);var o=r&&i&&i[r.getResourceType()];if(o&&s&&s!==h.GET){for(var a in o){if(!this.isRelative()){if(s===h.DELETE){this.iTotalLength--;this.aKeysServerState.splice(this.aKeysServerState.indexOf(r.getResourceType()+"/"+a),1)}else if(s===h.POST){this.iTotalLength++;this.aKeysServerState.unshift(r.getResourceType()+"/"+a)}else if(s===h.PUT&&r.getBinding().length===3){this.iTotalLength++;this.aKeysServerState.unshift(r.getAbsolutePath().substring(1)+"/"+o[a].meta.versionId)}}else if(s===h.PUT){this.iTotalLength=undefined}}}var u=this.oModel._getProperty(i,["path","lastUpdated"]);if(r&&(u&&n.getNumberOfLevelsByPath(u)<3&&u.indexOf(r.getResourceType())>-1||u===r.getAbsolutePath())||e===true||s){this._fireChange({reason:t.Change})}};f.prototype._isValueSetHardCoded=function(){return this.mParameters&&this.mParameters.request&&this.mParameters.request.hasOwnProperty("url")};f.prototype._getValueSetUriFromStructureDefinition=function(){var e=this.oModel._getProperty(this.oStructureDefinition,["snapshot","element"]);if(e&&e.length>0){var t=this.oModel._getProperty(this.oStructureDefinition,["snapshot","element","[id="+e[0].id+"."+this.sPath+"]","type"]);if(t&&(t[0].code==="code"||t[0].code==="CodeableConcept")){return this.oModel._getProperty(this.oStructureDefinition,["snapshot","element","[id="+e[0].id+"."+this.sPath+"]","binding","valueSet"])}}return undefined};f.prototype._isValueSet=function(){if(this.aKeys&&this.aKeys.length>0){return this.aKeys[0].indexOf("ValueSet")>-1}else if(this.sPath.indexOf("ValueSet")>-1||this._isValueSetHardCoded()||this._getValueSetUriFromStructureDefinition()){return true}return false};f.prototype.getLength=function(){if(this.iTotalLength!==undefined){return this.iTotalLength+this.iClientChanges}else{return undefined}};f.prototype.filter=function(e){n.filter(e,this)};f.prototype.sort=function(e,t){n.sort(e,this,t)};f.prototype.setContext=function(e){if(this.oContext!==e&&this.isRelative()){this.oContext=e;this.refresh(t.Context)}};f.prototype.refresh=function(e){this._resetData();this._fireChange({reason:e})};f.prototype._resetData=function(){this.aKeys=undefined;this.aKeysServerState=[];this.bResourceNotAvailable=false;this.aContexts=undefined;this.iTotalLength=undefined;this.bInitial=true;this.sNextLink=undefined;this.sPrevLink=undefined;this.iLastLength=undefined;this.aFilterCache=undefined;this.aSortersCache=undefined;this.iClientChanges=0};f.prototype._isClientMode=function(){return this.sOperationMode===o.Client};f.prototype._isServerMode=function(){return this.sOperationMode===o.Server};f.prototype.getFilters=function(){return this.aFilters};f.prototype.getSorters=function(){return this.aSorters};return f});
sap.ui.predefine("sap/fhir/model/r4/FHIRModel",["sap/ui/model/Model","sap/fhir/model/r4/FHIRListBinding","sap/fhir/model/r4/FHIRPropertyBinding","sap/fhir/model/r4/FHIRContextBinding","sap/fhir/model/r4/FHIRTreeBinding","sap/fhir/model/r4/FHIRUtils","sap/fhir/model/r4/OperationMode","sap/ui/thirdparty/URI","sap/fhir/model/r4/lib/BindingInfo","sap/fhir/model/r4/lib/Sliceable","sap/fhir/model/r4/SubmitMode","sap/fhir/model/r4/lib/FHIRRequestor","sap/fhir/model/r4/lib/HTTPMethod","sap/fhir/model/r4/lib/FHIRBundle","sap/ui/model/ChangeReason","sap/fhir/model/r4/lib/FHIRUrl","sap/base/Log","sap/base/util/deepEqual","sap/base/util/each","sap/fhir/model/r4/Context","sap/ui/core/message/Message","sap/ui/core/library","sap/fhir/model/r4/FHIRFilterProcessor","sap/fhir/model/r4/FHIRFilterOperator","sap/fhir/model/r4/type/Url","sap/fhir/model/r4/type/Uuid"],function(e,t,r,s,i,o,a,n,u,p,h,l,d,f,c,g,v,y,m,R,P,b,_,U,T,I){"use strict";var S=b.MessageType;var C=e.extend("sap.fhir.model.r4.FHIRModel",{constructor:function(t,r){e.apply(this);if(!t){throw new Error("Missing service root URL")}t=t.slice(-1)==="/"?t.slice(0,-1):t;this.oServiceUrl=new n(t);this.sServiceUrl=this.oServiceUrl.query("").toString();this._setupData();this.aCallAfterUpdate=[];this.sDefaultOperationMode=a.Server;this.sBaseProfileUrl=r&&r.baseProfileUrl?r.baseProfileUrl:"http://hl7.org/fhir/StructureDefinition/";this._buildGroupProperties(r);this.oDefaultQueryParameters=r&&r.defaultQueryParameters&&r.defaultQueryParameters instanceof Object?r.defaultQueryParameters:{};this.oRequestor=new l(t,this,r&&r["x-csrf-token"],r&&r.Prefer,this.oDefaultQueryParameters);this.sDefaultSubmitMode=r&&r.defaultSubmitMode?r.defaultSubmitMode:h.Direct;this.sDefaultFullUrlType=r&&r.defaultSubmitMode&&r.defaultSubmitMode!==h.Direct&&r.defaultFullUrlType?r.defaultFullUrlType:"uuid";this.oDefaultUri=this.sDefaultFullUrlType==="url"?new T:new I;this.iSizeLimit=10;if(r&&r.filtering&&r.filtering.complex===true){this.iSupportedFilterDepth=undefined}else{this.iSupportedFilterDepth=2}},metadata:{publicMethods:[]}});C.prototype._setupData=function(){this.oData={};this.oDataServerState={};this.mChangedResources={};this.mOrderResources={};this.mResourceGroupId={};this.mContexts={};this.mMessages={}};C.prototype.getBaseProfileUrl=function(){return this.sBaseProfileUrl};C.prototype.getServiceUrl=function(){return this.sServiceUrl};C.prototype.bindList=function(e,r,s,i,o){var a=new t(this,e,r,s,i,o);return a};C.prototype.bindProperty=function(e,t,s){var i=new r(this,e,t,s);return i};C.prototype.bindTree=function(e,t,r,s,o){var a=new i(this,e,t,r,s,o);return a};C.prototype.bindContext=function(e,t,r){var i=new s(this,e,t,r);return i};C.prototype._mapFHIRResponse=function(e,t,r,s,i){if(e.entry&&e.resourceType==="Bundle"){for(var o=0;o<e.entry.length;o++){var a=e.entry[o].resource;if(!a&&e.entry[o].response){this._updateResourceFromFHIRResponse(e.entry[o].response,e.entry[o].fullUrl,r)}else{this._storeResourceInModel(a,s,i)}}}else if(e.resourceType!=="Bundle"){this._storeResourceInModel(e,s,i)}};C.prototype._storeResourceInModel=function(e,t,r){var s;if(e.resourceType==="ValueSet"&&e.expansion&&e.expansion.identifier){s=[e.resourceType,"§"+e.expansion.identifier+"§"];e=e.expansion.contains}else{if(!e.id){e.id=o.uuidv4()}s=[e.resourceType,e.id];var i=["$_history",e.resourceType,e.id];if(e.meta&&e.meta.versionId){i.push(e.meta.versionId)}if(t){var a=this.getBindingInfo(t.sPath,t.oContext,t.mParameters&&t.mParameters.unique,e);s=a.getBinding()}this._setProperty(this.mResourceGroupId,o.deepClone(s),r,true);this._setProperty(this.oData,i,e,true)}this._setProperty(this.oData,s,e,true)};C.prototype._getUpdatedResourceFromFHIRResponse=function(e,t){if(e.location&&e.location.charAt(0)==="/"){e.location=e.location.slice(1)}var r=this.getBindingInfo("/"+e.location);var s;if(t){s=t.getResource()}else{s=this._getProperty(this.oData,[r.getResourceType(),r.getResourceId()])}s.id=r.getResourceId();return s};C.prototype._updateResourceFromFHIRResponse=function(e,t,r){var s=this._getUpdatedResourceFromFHIRResponse(e,r);this._setProperty(s,["meta","versionId"],e.etag);this._setProperty(s,["meta","lastUpdated"],e.lastModified);return s};C.prototype._mapBundleEntriesToResourceMap=function(e){var t={};for(var r=0;r<e.length;r++){var s;if(!e[r]){throw new Error("No response from the FHIR Service available")}if(!e[r].resource&&e[r].response){s=this._getUpdatedResourceFromFHIRResponse(e[r].response)}else{s=e[r].resource}if(s&&s.resourceType&&s.id){this._setProperty(t,[s.resourceType,s.id],s,true)}else{throw new Error("No resource could be found for bundle entry: "+e[r])}}return t};C.prototype._mapResourceToResourceMap=function(e){var t={};if(e&&e.resourceType==="ValueSet"&&e.expansion&&e.expansion.identifier){this._setProperty(t,["ValueSet","§"+e.expansion.identifier+"§"],e.expansion.contains,true)}else if(e&&e.resourceType&&e.id&&e.resourceType!=="Bundle"){this._setProperty(t,[e.resourceType,e.id],e,true)}else if(!e){throw new Error("No data could be found which should be mapped as updated resource")}return t};C.prototype._onSuccessfulRequest=function(e,t,r,s,i,a,n){var u;var p;var h;var l;if(r){l=r.getRequest().getBinding();u=r.getRequest().getUrl();h=e.getBundle().getGroupId();if(t.resource&&d.GET===a){t=t.resource}else{p=t.response;t=this._updateResourceFromFHIRResponse(p,r.getFullUrl(),r)}}else{u=e.getUrl();p=this.oRequestor.getResponseHeaders(e.getRequest());l=e.getBinding()}if(s){s(t)}if(a!==d.HEAD){var f;if(a===d.DELETE){f=new g(u,this.sServiceUrl);t=o.deepClone(this.oData[f.getResourceType()][f.getResourceId()]);delete this.oData[f.getResourceType()][f.getResourceId()]}else if(!t){t=JSON.parse(e.getData());f=new g(p.location,this.sServiceUrl);t.id=f.getResourceId();t.meta={};t.meta.versionId=f.getHistoryVersion();t.meta.lastUpdated=p["last-modified"];this.oData[t.resourceType][t.id]=t}else{this._mapFHIRResponse(t,p,r,l,h)}var c=t.entry?this._mapBundleEntriesToResourceMap(t.entry):this._mapResourceToResourceMap(t);this.checkUpdate(false,c,l,a)}if(i){i(t)}};C.prototype._processError=function(e,t,r,s,i,o,a){var n=this._publishMessage(e,t,r,s,a);v.fatal(o+" "+n.getDescriptionUrl()+", Statuscode: "+n.getCode()+"\nError message: "+n.getMessage());if(i){i(n)}};C.prototype._publishMessage=function(e,t,r,s,i){var o;if(r&&t){var a=parseInt(t.response.status.substring(0,3),10);o={message:t.response.status.substring(4),description:JSON.stringify(t.response),code:a,descriptionUrl:r.getRequest().getUrl(),binding:s,additionalText:a}}else{o={message:e.getRequest().statusText,description:e.getRequest().responseText,code:e.getRequest().status,descriptionUrl:e.getUrl(),binding:s,additionalText:e.getRequest().status}}o.type=S.Error;if(i){o.message=i.message;o.additionalText=i.stack}var n=new P(o);if((!this.mMessages[n.descriptionUrl]||!s)&&n.code){this.mMessages[n.descriptionUrl]=n;this.fireMessageChange({newMessages:n})}return n};C.prototype.loadData=function(e,t,r,s){r=r||d.GET;if(!t){t={}}var i=t.binding;var o=t.groupId||i&&i.sGroupId;var a=function(e,s,o){if(!s){s=e.getRequest().responseJSON}try{this._onSuccessfulRequest(e,s,o,t.successBeforeMapping,t.success,r,t.urlParameters);var a=o?o.getRequest().getUrl():e.getUrl();if(this.mMessages[a]){this.fireMessageChange({oldMessages:this.mMessages[a]});delete this.mMessages[a]}}catch(a){this._processError(e,s,o,i,t.error,r,a)}}.bind(this);var n=function(e,s,o){this._processError(e,s,o,i,t.error,r)}.bind(this);var u=this.oRequestor._request(r,e,t.forceDirectCall,t.urlParameters,o,t.headers,s,a,n,i,t.manualSubmit);return u};C.prototype.submitChanges=function(e,t,r){if(typeof e==="function"){r=t;t=o.deepClone(e);e=undefined}var s=function(e){if(r){r(e)}};var i=function(){this.resetChanges(e,true)}.bind(this);var a;var n=[];var u=0;var p=function(){var e={};var s=function(t){e.resolve(t)};var i=function(t,r,s){var i={};i.requestHandle=t;i.resources=r;i.operationOutcomes=s;e.reject(i)};for(var o in a){if(o!=="direct"){var u=new Promise(function(t,r){e.resolve=t;e.reject=r});n.push(u);u.then(function(e){t(e)}).catch(function(e){if(r&&e.requestHandle){var t={message:e.requestHandle.getRequest().statusText,description:e.requestHandle.getRequest().responseText,code:e.requestHandle.getRequest().status,descriptionUrl:e.requestHandle.getUrl()};var s=new P(t);r(s,e.resources,e.operationOutcomes)}});a[o]=this.oRequestor.submitBundle(o,s,i)}}}.bind(this);var h;var l=function(){var r=0;var o=h.getResourcePathArray();var n=this._getProperty(this.oData,o);var l=this._getProperty(this.mResourceGroupId,o);var c;if(e&&l===e){c=true}else if(!e){c=true}else{c=false}if(c){var g=this._getProperty(this.oDataServerState,o);var v=this._getProperty(this.mChangedResources,o);if(!y(n,g)||v&&v.method===d.DELETE){var m;var R=function(){var r={successBeforeMapping:i,success:t,error:s,headers:m,groupId:l,manualSubmit:true};if(e&&l===e&&this.getGroupSubmitMode(e)!=="Direct"){r.success=function(){};r.error=function(){}}var o=this.loadData(v.url,r,v.method,n);a=a?a:{};if(o instanceof f&&!a[o.getGroupId()]){a[o.getGroupId()]={}}else if(!a.direct){a.direct=[];a.direct.push(o)}else{a.direct.push(o)}}.bind(this);var P=function(e){r++;m={"If-Match":e};R();if(u===r){p()}};if(v.method===d.PUT){var b=h.getETag();if(!b){this.readLatestVersionOfResource(h.getResourceServerPath(),P);u++}else{m={"If-Match":b};R()}}else{R()}}}}.bind(this);for(var c in this.mChangedResources){for(var g in this.mChangedResources[c]){if(c==="$_history"){for(var v in this.mChangedResources[c][g]){for(var m in this.mChangedResources[c][g][v]){h=this.getBindingInfo("/"+c+"/"+g+"/"+v+"/"+m);l()}}}else{h=this.getBindingInfo("/"+c+"/"+g);l()}}}if(u===0){p()}return a};C.prototype.checkUpdate=function(e,t,r,s){var i=this.aBindings.slice(0);m(i,function(r,i){i.checkUpdate(e,t,s)});this._processAfterUpdate()};C.prototype.attachAfterUpdate=function(e){this.aCallAfterUpdate.push(e)};C.prototype._processAfterUpdate=function(){var e=this.aCallAfterUpdate;this.aCallAfterUpdate=[];for(var t=0;t<e.length;t++){e[t]()}};C.prototype.refresh=function(){this._setupData();for(var e=0;e<this.aBindings.length;e++){this.aBindings[e].refresh(c.Refresh)}};C.prototype.getProperty=function(e,t,r){var s=this.oData;if(r){s=r}var i=this.getBindingInfo(e,t);if(i){return this._getProperty(s,i.getBinding())}return undefined};C.prototype._getProperty=function(e,t){t=o.deepClone(t);if(!e){return undefined}var r;var s;if(t.length===1){if(p.containsSliceable(t[0])){s=p.getSliceables(t[0]);return this._findMatchingSlice(e,s)}else{return e[t[0]]}}var i;var a=t.shift();if(a==="reference"&&e.reference&&typeof e.reference==="string"){r=o.splitPath(e.reference);i=this.oData[r[0]][r[1]]}else if(p.containsSliceable(a)){s=p.getSliceables(a);i=this._findMatchingSlice(e,s,false);var n=i&&Object.keys(i);if(n&&!isNaN(n[0])){a=t.shift();i=e[a]}}else{i=e[a]}return this._getProperty(i,t)};C.prototype._handleClientChanges=function(e,t){if(!t){t=e.getGroupId()}var r=e.getResourcePathArray();var s=this._getProperty(this.oDataServerState,r);var i=this._getProperty(this.mChangedResources,r);var a=this._getProperty(this.oData,r);if(!i&&a){i=this._createRequestInfo(d.PUT,e.getResourceServerPath());this._setProperty(this.mChangedResources,o.deepClone(r),i,true)}else if(!i){i=this._createRequestInfo(d.POST,e.getResourceType());this._setProperty(this.mChangedResources,o.deepClone(r),i,true)}if(t){this._setProperty(this.mResourceGroupId,o.deepClone(r),t,true)}if(!this._isServerStateUpToDate(s,a,i.method)){this._setProperty(this.oDataServerState,r,o.deepClone(a),true)}};C.prototype.setProperty=function(e,t,r,s){var i=this.getBindingInfo(e,r);this._handleClientChanges(i);this._setProperty(this.oData,i.getBinding(),t,undefined,i.getGroupId());var o=i.getResourcePathArray();var a=this._getProperty(this.oDataServerState,o);var n=this._getProperty(this.mChangedResources,o);var u=this._getProperty(this.oData,o);if(n&&n.method===d.PUT&&y(a,u)){delete this.mChangedResources[o[0]][o[1]]}else{this.mChangedResources.path={lastUpdated:i.getAbsolutePath()}}this.checkUpdate(false,this.mChangedResources,s)};C.prototype._setProperty=function(e,t,r,s,i,a){if(a===undefined){a=0}var n;var u;var h=t[a];var l;if(h==="reference"&&t.length-1!==a){u=o.splitPath(e[h]);var d=this.getBindingInfo("/"+e[h]);this._handleClientChanges(d,i);n=this.oData[u[0]][u[1]]}else if(t.length-1===a){if(r){e[h]=r}else{delete e[h]}return}else if(p.containsSliceable(h)){l=t[a+1];if(!isNaN(l)){a++;n=e[l]}else{var f=p.getSliceables(h);n=this._findMatchingSlice(e,f);if(!n){n={};for(var c in f){var g=f[c];if(g.aFilters){for(var v=0;v<g.aFilters.length;v++){this._setProperty(n,o.splitPath(g.aFilters[v].sPath),g.aFilters[v].oValue1)}}else{this._setProperty(n,o.splitPath(g.sPath),g.oValue1)}}e.push(n)}}}else if(!e.hasOwnProperty(h)){l=t[a+1];if(s||isNaN(l)&&!p.containsSliceable(l)){e[h]={}}else{e[h]=[]}}this._setProperty(n||e[h],t,r,s,i,a+1)};C.prototype._createRequestInfo=function(e,t){return{method:e,url:t}};C.prototype._resolvePath=function(e,t){if(t&&(!e||e&&!e.startsWith("/"))){var r=t.sPath;var s=t.getBinding().getContext();var i=e?"/"+e:"";return this._resolvePath(r,s)+i}else if(e&&e.startsWith("/")){return e}else{return undefined}};C.prototype.getBindingInfo=function(e,t,r,s){var i=this._resolvePath(e,t);if(i){var a=o.splitPath(i);var n;var p;var h;var l;var d;var f;var c;var g;var v;var y;var m=t&&t.sGroupId;var R="";if(i.indexOf("_history")>-1||r){if(s){h=s.resourceType;p=s.id;f=this._getProperty(s,["meta","versionId"])}else if(i.startsWith("/$")){h=a[2];p=a[3];f=a[4]}else{h=a[1];p=a[2];f=a[4]}if(f){f="/"+f}else{f=""}d=a.slice(5).join("/");g="/"+h+"/"+p+"/_history"+f;l="/$_history"+"/"+h+"/"+p+f;if(d){c=l+"/"+d}else{c=l}}else if(s){h=s.resourceType;p=s.id;l="/"+h+"/"+p;c=l}else{R=this.determineOperation(i);h=a[1];if(a[2]&&a[2]!==R){p=a[2];l="/"+a[1]+"/"+a[2];d=a.slice(3).join("/")}if(R){c=i.replace(R,"");d=d.replace(R.substring(1)+"/","")}}if(c){a=o.splitPath(c);i=c}if(!g){g=(l||h||"")+R}if(l){n=o.splitPath(l).slice(1)}if(h&&p){v="/"+h+"/"+p;y=this._getProperty(this.oData,[h,p,"meta","versionId"]);if(y){y='W/"'+y+'"'}}return new u(p,h,l,d,i,a.slice(1),m,g,n,v,y)}return undefined};C.prototype.determineOperation=function(e){var t="";var r=e.indexOf("$");if(r>-1&&r!==1){var s=e.substring(r);var i=s.indexOf("/");if(i>-1){t="/"+s.substring(0,i)}else{t="/"+s}}return t};C.prototype._findMatchingSlice=function(e,t,r){var s={};var i;var a=function(e,t){return this._getProperty(e,o.splitPath(t))}.bind(this);for(var n in t){if(t[n].sPath&&t[n].sPath.startsWith("revreference/")){var u=t[n].sPath.substring(13);if(r!==false){var p=o.splitPath(t[n].oValue1);for(var h in this.oData[u]){var l=this._getProperty(this.oData[u][h],p);if(l===e.resourceType+"/"+e.id){s[u+"/"+h]=this.oData[u][h]}}return s}else{return this.oData}}else{for(var d=0;d<e.length;d++){i=e[d];if(_._evaluateFilter(t[n],i,a)){s[d]=i}}}}var f=Object.keys(s);s=f.length===0?undefined:s;return f.length===1?s[f[0]]:s};C.prototype.hasResourceTypePendingChanges=function(e){return this.mChangedResources[e]!==undefined&&Object.keys(this.mChangedResources[e]).length>0};C.prototype.destroy=function(){this.oRequestor.destroy();this.aCallAfterUpdate=[];this.mChangedResources={};e.prototype.destroy.apply(this,arguments)};C.prototype.getGroupProperty=function(e,t){switch(t){case"submit":return this.getGroupSubmitMode(e);case"uri":return this.getGroupUri(e);default:throw new Error("Unsupported group property: "+t)}};C.prototype.getGroupSubmitMode=function(e){return this.mGroupProperties&&this.mGroupProperties[e]&&this.mGroupProperties[e].submit||this.sDefaultSubmitMode};C.prototype.getGroupUri=function(e){var t=this.oDefaultUri;if(this.mGroupProperties&&this.mGroupProperties[e]&&this.mGroupProperties[e].fullUrlType==="url"){t=new T}return t};C.prototype._buildGroupProperties=function(e){if(e){var t;for(var r in e.groupProperties){t=e.groupProperties[r];if(typeof t!=="object"){throw new Error('Group "'+r+'" has invalid properties. The properties must be of type object, found "'+t+'"')}else if(Object.keys(t).length===2&&(!t.submit||!t.fullUrlType)){throw new Error('Group "'+r+'" has invalid properties. Only the property "submit" and "fullUrlType" is allowed and has to be set, found "'+JSON.stringify(t)+'"')}else if(Object.keys(t).length===1&&!t.submit&&t.fullUrlType){throw new Error('Group "'+r+'" has invalid properties. The property "fullUrlType" is allowed only when submit property is present, found "'+JSON.stringify(t)+'"')}else if(Object.keys(t).length===1&&!t.submit){throw new Error('Group "'+r+'" has invalid properties. Only the property "submit" is allowed and has to be set, found "'+JSON.stringify(t)+'"')}else if(t.submit&&!(t.submit in h)){throw new Error('Group "'+r+'" has invalid properties. The value of property "submit" must be of type sap.fhir.model.r4.SubmitMode, found: "'+t.submit+'"')}else if(t.fullUrlType&&(t.fullUrlType!=="uuid"&&t.fullUrlType!=="url")){throw new Error('Group "'+r+'" has invalid properties. The value of property "fullUrlType" must be either uuid or url, found: "'+t.fullUrlType+'"')}else if(t.submit&&(t.submit!==h.Batch&&t.submit!==h.Transaction)&&t.fullUrlType){throw new Error('Group "'+r+'" has invalid properties. The value of property "fullUrlType" is applicable only for batch and transaction submit modes, found: "'+t.submit+'"')}}this.mGroupProperties=e.groupProperties}else{v.info("no parameters are defined to build group properties")}};C.prototype.sendGetRequest=function(e,t){return this.loadData(e,t)};C.prototype.sendPostRequest=function(e,t,r){return this.loadData(e,r,d.POST,t)};C.prototype.readLatestVersionOfResource=function(e,t){var r;var s=function(e){var s=this.oRequestor.getResponseHeaders(r.getRequest());var i=s?s["etag"]:undefined;var o=s?s["location"]||s["content-location"]:undefined;var a=o?new g(o,this.sServiceUrl):undefined;var n;if(i){n=i}else if(a&&a.getHistoryVersion()){n='W/"'+a.getHistoryVersion()+'"'}else if(e&&e.meta&&e.meta.versionId){n='W/"'+e.meta.versionId+'"'}t(n)}.bind(this);var i={success:s,error:function(){r.getRequest().complete(function(){i={success:s};r=this.loadData(e,i,d.GET)}.bind(this))}.bind(this)};r=this.loadData(e,i,d.HEAD)};C.prototype.create=function(e,t,r){var s=o.uuidv4();var i="/"+e+"/"+s;if(!this.mOrderResources[e]){this.mOrderResources[e]=[i.substring(1)]}else{this.mOrderResources[e].unshift(i.substring(1))}if(!t){t={resourceType:e,id:s}}else{t.resourceType=e;t.id=s}this.setProperty(i,t);if(r){this._setProperty(this.mResourceGroupId,[e,s],r,true)}return s};C.prototype.remove=function(e,t){for(var r=0;r<e.length;r++){var s=t?t(e[r]):e[r];var i=this.getBindingInfo(s);var a=i.getResourcePathArray();var n=this._getProperty(this.mChangedResources,a);if(n&&n.method==d.POST){this._setProperty(this.oData,o.deepClone(a));this._setProperty(this.mResourceGroupId,o.deepClone(a));this._setProperty(this.mChangedResources,o.deepClone(a));this._removeFromOrderResources(i);this.checkUpdate(true)}else{n=this._createRequestInfo(d.DELETE,i.getResourceServerPath());this._setProperty(this.mChangedResources,o.deepClone(a),n,true)}}};C.prototype.resetChanges=function(e,t){var r;var s=function(){var t=r.getResourcePathArray();var s=this._getProperty(this.mResourceGroupId,t);var i=function(){var e=this._getProperty(this.mChangedResources,t);if(e.method===d.PUT){var s=this._getProperty(this.oDataServerState,t);this._setProperty(this.oData,o.deepClone(t),s)}else if(e.method===d.POST){this._setProperty(this.oData,o.deepClone(t));this._setProperty(this.mResourceGroupId,o.deepClone(t));this._removeFromOrderResources(r)}this._setProperty(this.mChangedResources,o.deepClone(t))}.bind(this);if(s===e){i()}else if(!e){i()}}.bind(this);for(var i in this.mChangedResources){for(var a in this.mChangedResources[i]){if(i==="$_history"){for(var n in this.mChangedResources[i][a]){for(var u in this.mChangedResources[i][a][n]){r=this.getBindingInfo("/"+i+"/"+a+"/"+n+"/"+u);s()}}}else{r=this.getBindingInfo("/"+i+"/"+a);s()}}}if(!t){this.checkUpdate(true)}};C.prototype._removeFromOrderResources=function(e){var t=e.getResourceType();var r=e.getResourceId();var s=this.mOrderResources[t].indexOf(t+"/"+r);this.mOrderResources[t].splice(s,1);if(this.mOrderResources[t].length===0){delete this.mOrderResources[t]}};C.prototype.getContext=function(){throw new Error("Unsupported operation: sap.fhir.model.r4.FHIRModel#getContext")};C.prototype.getStructureDefinitionUrl=function(e){var t;if(e&&e.meta&&e.meta.profile&&e.meta.profile.length>0){t=e.meta.profile[0]}else if(e&&e.resourceType){t=this.getBaseProfileUrl()+e.resourceType}return t};C.prototype._isServerStateUpToDate=function(e,t,r){if(!e&&r===d.PUT){return false}else if(e&&r===d.PUT&&y(e,t)){return false}return true};return C});
sap.ui.predefine("sap/fhir/model/r4/FHIRPropertyBinding",["sap/ui/model/PropertyBinding","sap/ui/model/Context","sap/ui/model/ChangeReason","sap/fhir/model/r4/FHIRUtils","sap/base/Log","sap/base/util/deepEqual"],function(t,e,i,o,s,n){"use strict";var r=t.extend("sap.fhir.model.r4.FHIRPropertyBinding",{constructor:function(e,i,s,n){t.apply(this,arguments);this.oValue=this._getValue();this.sId=o.uuidv4();this.mParameters=n}});r.prototype.initialize=function(){this.checkUpdate(false);return this};r.prototype.checkUpdate=function(t,e,s,n){var r=this._getValue();this.oValue=o.deepClone(r);this._fireChange({reason:n||i.Change})};r.prototype.setContext=function(t){this.oContext=t;this.checkUpdate(false,undefined,undefined,i.Context)};r.prototype.getValue=function(){return this.oValue};r.prototype._getValue=function(){if(this.sPath==="%total%"&&this.oContext){return this.oContext.iTotal}else if(this.sPath!=="%total%"){return this.oModel.getProperty(this.sPath,this.oContext)}else{return undefined}};r.prototype.setValue=function(t){this.oModel.setProperty(this.sPath,t,this.oContext,this)};return r});
sap.ui.predefine("sap/fhir/model/r4/FHIRTreeBinding",["sap/ui/model/TreeBinding","sap/ui/model/ChangeReason","sap/ui/model/Sorter","sap/ui/model/FilterProcessor","sap/ui/model/SorterProcessor","sap/fhir/model/r4/FHIRUtils","sap/fhir/model/r4/OperationMode","sap/ui/model/Filter","sap/base/Log","sap/base/util/deepEqual","sap/base/util/each","sap/fhir/model/r4/Context"],function(e,t,i,r,s,o,n,a,d,h,l,u){"use strict";var f=e.extend("sap.fhir.model.r4.FHIRTreeBinding",{constructor:function(t,r,s,d,h,l){e.apply(this,arguments);this.aFilters=d instanceof a?[d]:d;this.aSorters=l instanceof i?[l]:l;this.aSorters=l;this.sId=o.uuidv4();this._checkParameters(h);this.iExpandedNodesLength=0;this.mParameters=h;this.sRootSearch=h.rootSearch;this.sRootProperty=h.rootProperty;this.aRootProperty=o.splitPath(this.sRootProperty);this.sRootValue=h.rootValue;this.sNodeProperty=h.nodeProperty;this.aNodeProperty=o.splitPath(this.sNodeProperty);this.sOperationMode=h.operationMode||this.oModel.sDefaultOperationMode;this.sGroupId=h&&h.groupId||s&&s.sGroupId;if(this.sOperationMode!==n.Server){throw new Error("Unsupported OperationMode: "+this.sOperationMode+". Only sap.fhir.model.r4.OperationMode.Server is supported.")}this.iNumberOfExpandedLevels=h.numberOfExpandedLevels||0;this._aRowIndexMap=[];this.oBindingInfo=this.oModel.getBindingInfo(this.sPath,this.oContext);if(this.mParameters.collapseRecursive===undefined){this.bCollapseRecursive=true}else{this.bCollapseRecursive=!!this.mParameters.collapseRecursive}this._resetData()}});f.prototype.attachTreeLoadingStarted=function(e,t,i){this.attachEvent("treeLoadingStarted",e,t,i);return this};f.prototype.detachTreeLoadingStarted=function(e,t){this.detachEvent("treeLoadingStarted",e,t);return this};f.prototype.fireTreeLoadingStarted=function(e){this.fireEvent("treeLoadingStarted",e);return this};f.prototype.attachTreeLoadingCompleted=function(e,t,i){this.attachEvent("treeLoadingCompleted",e,t,i);return this};f.prototype.detachTreeLoadingCompleted=function(e,t){this.detachEvent("treeLoadingCompleted",e,t);return this};f.prototype.fireTreeLoadingCompleted=function(e){this.fireEvent("treeLoadingCompleted",e);return this};f.prototype._checkParameters=function(e){if(!e||!o.isObject(e)||o.isEmptyObject(e)){throw new Error("Missing parameters: rootSearch, rootProperty, rootValue and nodeProperty have to be set in parameters.")}o.checkFHIRSearchParameter(e,"rootSearch");o.checkPathParameter(e,"rootProperty");o.checkStringParameter(e,"rootValue");o.checkPathParameter(e,"nodeProperty")};f.prototype.getContexts=function(e,t,i,r){if(!this.iLength&&t!==undefined){this.iLength=t}else if(!this.iLength){this.iLength=this.oModel.iSizeLimit}var s=this._buildParameters(this.iLength);this._buildContexts();this._createRootNode(e,this.iLength);if(!this.sNextLink&&!this.bPendingRequest&&this.aFilters&&o.isEmptyObject(this.mRequestHandle)){this.aKeys=undefined;var n=[];this._buildFilteredTree(n);this._mTreeStateOld=o.deepClone(this._mTreeState);if(this.aKeys){this.iTotalLength=this.aKeys.length}this._buildContexts()}else if(!this.bPendingRequest&&!this.aFilters){this._buildTree()}var a=function(t){if(t.total===undefined){throw new Error('FHIR Server error: The "total" property is missing in the response for the requested FHIR resource '+this.sPath)}this.bDirectCallPending=false;var i=this.oModel.getBindingInfo(this.sPath,this.oContext);this.bInitial=false;if(t.entry){if(this.aFilters){if(Object.keys(this.mRequestHandle).length===0){this._handlePaging(t);this.bPendingRequest=false}l(t.entry,function(e,t){if(i.getResourceType()===t.resource.resourceType){this._mFilteredTreeItems[t.resource.id]=t.resource}}.bind(this));if(!this.sNextLink){var r;var s;for(var n in this._mFilteredTreeItems){if(this._mFilteredTreeItems.hasOwnProperty(n)){var d=this.oModel._getProperty(this._mFilteredTreeItems[n],this.aRootProperty);var h=this.oModel._getProperty(this._mFilteredTreeItems[n],this.aNodeProperty);if(d&&d!==this.sRootValue&&h!==this.sRootValue){var u=[];o.filterObject(this._mFilteredTreeItems,this.sNodeProperty,d,1+o.getNumberOfLevelsByPath(this.sNodeProperty),u);if(u.length===0){s={urlParameters:{}};s.urlParameters[this.sNodeProperty+":exact"]=d;r=this._submitRequest(this.sPath,s,a);this.mRequestHandle[r.getId()]=r;r.getRequest().complete(function(e){delete this.mRequestHandle[e.getId()];this._canRootAggregationsBeResolved(t)}.bind(this,r));break}}}}}}else{var f=this._oRootNode.nodeState.sections[0];if(!this.aKeys){this.aKeys=[];e=0;f.startIndex=0;f.length=t.entry.length}else{e=this.aKeys.length;f.startIndex+=t.entry.length;f.length+=t.entry.length}l(t.entry,function(t,r){if(i.getResourceType()===r.resource.resourceType){this.aKeys[e+t]=r.resource.resourceType+"/"+r.resource.id}}.bind(this));this._markSuccessRequest(t,t.total)}}else{this._markSuccessRequest(t,t.total)}}.bind(this);var d=[];if(this._oRootNode){d=this._retrieveNodeSection(this._oRootNode,e,this.iLength)}this._updateRowIndexMap(d,e);if(!this.bPendingRequest){if(!this.aSortersCache&&!this.aFilterCache&&this.sNextLink&&(!r||e>this.iStartIndex)){this.iStartIndex+=this.iLength;this._callNextLink(a)}else if(this.iTotalLength===undefined){this.iStartIndex=0;this._submitRequest(this.sPath,s,a)}else{this.bTreeLoadingStartedFired=false;this.fireTreeLoadingCompleted()}}if(r){return d}else{return this.aContexts}};f.prototype.getSelectedIndex=function(){if(!this._sLeadSelectionGroupID||o.isEmptyObject(this._mTreeState.selected)){return-1}var e=-1;var t=function(t){if(!t||!t.isArtificial){e++}if(t){if(t.groupID===this._sLeadSelectionGroupID){return true}}return undefined};this._match(this._oRootNode,[],1,t);return e};f.prototype.getContextByIndex=function(e){if(this.isInitial()){return undefined}var t=this.findNode(e);return t!==undefined?t.context:undefined};f.prototype._callNextLink=function(e){if(o.isEmptyObject(this.mRequestHandle)){var t=this._submitRequest(this.sNextLink,undefined,e,undefined,true);this.mRequestHandle[t.getId()]=t;t.getRequest().complete(function(e){delete this.mRequestHandle[e.getId()]}.bind(this,t))}};f.prototype._buildFilteredTree=function(e,t){if(t&&e.length>0){var i;for(var r=0;r<e.length;r++){i=[];o.filterObject(this._mFilteredTreeItems,this.sRootProperty,e[r].object[this.sNodeProperty],1+o.getNumberOfLevelsByPath(this.sNodeProperty),i,function(e){return{children:undefined,object:e}});e[r].children=i;var s=t.nodeState.sections[0];s.startIndex=0;s.length=e.length;var n=this._buildFilteredChildContexts(e[r],r,t);if(i.length!==0){this._buildFilteredTree(i,n)}}}else if(!this.aKeys&&!o.isEmptyObject(this._mFilteredTreeItems)){o.filterObject(this._mFilteredTreeItems,this.sRootProperty,this.sRootValue,1+o.getNumberOfLevelsByPath(this.sNodeProperty),e,function(e){return{children:undefined,object:e}});this._buildFilteredTree(e,this._oRootNode)}};f.prototype._buildFilteredChildContexts=function(e,t,i){if(i.nodeState.expanded){var r;if(!this.aKeys){this.aKeys=[];r=0}else{r=this.aKeys.length}this.aKeys[r]=e.object.resourceType+"/"+e.object.id;this._buildContexts();var s=this.aContexts.splice(r,this.aKeys.length);var o=this._processChildren(i,s[0],t,{total:e.children.length,expanded:true});return o}return undefined};f.prototype._canRootAggregationsBeResolved=function(){if(o.isEmptyObject(this.mRequestHandle)){this.bPendingRequest=false;var e=[];this._buildFilteredTree(e);this.iTotalLength=this.aKeys.length;this._fireChange({reason:t.Change})}};f.prototype._buildParameters=function(e){var t={urlParameters:{_sort:o.createSortParams(this.aSorters)}};o.addRequestQueryParameters(this,t);if(this.aFilters){o.filterBuilder(this.aFilters,t.urlParameters,this.oModel.iSupportedFilterDepth)}else{t.urlParameters[this.sRootSearch]=this.sRootValue;t.urlParameters._count=e}return t};f.prototype._handlePaging=function(e){if(e&&e.link){this.sNextLink=o.getLinkUrl(e.link,"next");this.sPrevLink=o.getLinkUrl(e.link,"previous")}};f.prototype._markSuccessRequest=function(e,t){this._handlePaging(e);if(this.iTotalLength===undefined){this.iTotalLength=t}this.bPendingRequest=false;this.oModel.attachAfterUpdate(function(){this.fireDataReceived({data:e})}.bind(this))};f.prototype.getLength=function(){return this.iTotalLength};f.prototype.refresh=function(e){this._resetData();this._fireChange({reason:e})};f.prototype._resetData=function(){for(var e in this.mRequestHandle){this.mRequestHandle[e].getRequest().abort()}this.mRequestHandle={};this.aKeys=undefined;this.aContexts=undefined;this.iTotalLength=undefined;this.bInitial=true;this.sNextLink=undefined;this.sPrevLink=undefined;this._oRootNode=undefined;this._mTreeState=undefined;this._mTreeStateOld=undefined;this.bPendingRequest=false;this.iLength=undefined;this.bTreeLoadingStartedFired=false;this.aSortersCache=undefined;this.aFilterCache=undefined;this._mFilteredTreeItems={};this._createTreeState();this.iExpandedNodesLength=0};f.prototype._isClientMode=function(){return this.sOperationMode===n.Client};f.prototype._isServerMode=function(){return this.sOperationMode===n.Server};f.prototype.filter=function(e){o.filter(e,this)};f.prototype.sort=function(e,t){o.sort(e,this,t)};f.prototype.setContext=function(e){if(this.oContext!==e&&this.isRelative()){this.oContext=e;this._resetData()}};f.prototype._submitRequest=function(e,t,i,r,s){this.bPendingRequest=true;var o=function(){this.bPendingRequest=false;this.bInitial=false}.bind(this);this.bDirectCallPending=s;if(!t){t={}}t.binding=this;t.forceDirectCall=s;t.successBeforeMapping=i;t.success=r;t.error=o;var n=this.oModel.loadData(e,t);this.bPendingRequest=true;if(!this.bTreeLoadingStartedFired){this.bTreeLoadingStartedFired=true;this.fireTreeLoadingStarted()}return n};f.prototype._buildContexts=function(){if(!this.aContexts){this.aContexts=[]}if(this.aKeys){this.aContexts=[];for(var e=0;e<this.aKeys.length;e++){this.aContexts.push(u.create(this.oModel,this,"/"+this.aKeys[e],this.sGroupId))}}};f.prototype.getNodeByIndex=function(e){if(this.bInitial){return undefined}if(e>=this.getLength()){return undefined}return this.findNode(e)};f.prototype.findNode=function(e){if(this.bInitial){return undefined}var t=typeof e;var i;var r=[];if(t==="number"){i=this._aRowIndexMap[e];if(!i){var s=-1;this._match(this._oRootNode,r,1,function(){if(s===e){return true}s+=1;return undefined});i=r[0]}}return i};f.prototype._match=function(e,t,i,r,s,o){if(t.length===i){return true}var n=r.call(this,e,s,o);if(n){t.push(e)}if(!e){return false}if(e.nodeState.expanded){for(var a=0;a<e.children.length;a++){var d=e.children[a];var h=this._match(d,t,i,r,a,e);if(h){return true}}}return false};f.prototype._retrieveNodeSection=function(e,t,i){var r=-1;var s=[];this._match(e,[],i,function(e){if(!e||!e.isArtificial){r++}if(r>=t&&e&&this.aContexts.indexOf(e.context)>-1){s.push(e);return true}return false});return s};f.prototype._createRootNode=function(e,t){if(!this._oRootNode){var i=this._calculateGroupID({context:null,parent:null});var r=this._getNodeState(i);if(!r){r=this._createNodeState({groupID:i,sum:true,sections:[{startIndex:e,length:t}]});this._updateTreeState({groupID:r.groupID,fallbackNodeState:r,expanded:true})}this._oRootNode=this._createNode({context:null,parent:null,level:this.bDisplayRootNode&&this.oRootContext?0:-1,nodeState:r,isLeaf:false,autoExpand:this.getNumberOfExpandedLevels()+1});this._oRootNode.isArtificial=true;this.vNodeLastInteraction=this._oRootNode}};f.prototype._buildTree=function(){if(this._mTreeState.expanded[this._oRootNode.groupID]){if(Array.isArray(this.vNodeLastInteraction)){for(var e=0;e<this.vNodeLastInteraction.length;e++){this._loadChildContexts(this.vNodeLastInteraction[e])}}else{this._loadChildContexts(this.vNodeLastInteraction||this._oRootNode)}this.vNodeLastInteraction=this._oRootNode}};f.prototype._updateRowIndexMap=function(e,t){this._aRowIndexMap=[];for(var i=0;i<e.length;i++){this._aRowIndexMap[t+i]=e[i]}};f.prototype._createNode=function(e){e=e||{};var t=e.context;var i={context:t,level:e.level||0,children:e.children||[],parent:e.parent,nodeState:e.nodeState,isLeaf:e.isLeaf,positionInParent:e.positionInParent,magnitude:e.magnitude||0,numberOfTotals:e.numberOfTotals||0,numberOfLeafs:e.numberOfLeafs||0,autoExpand:e.autoExpand||0,absoluteNodeIndex:e.absoluteNodeIndex||0,totalNumberOfLeafs:0};if(t!==undefined){i.groupID=this._calculateGroupID(i)}return i};f.prototype._getNodeState=function(e){var t=this._mTreeState.expanded[e];var i=this._mTreeState.collapsed[e];var r=this._mTreeState.selected[e];var s=this._mTreeState.deselected[e];return t||i||r||s};f.prototype._calculateGroupID=function(e){var t=this.getPath();var i;if(e.context){var r=e.context.getPath();if(t!=="/"){var s=r.match(t+"(.*)");if(s&&s[1]){i=s[1]}else{d.warning("CTBA: BindingPath/ContextPath matching problem!")}}if(!i){i=r}if(i.startsWith("/")){i=i.substring(1,i.length)}var o;if(!e.parent){o=this._calculateGroupID({context:e.context._parentContext||null})}else{o=e.parent.groupID}i=o+i.replace(/\//g,"_")+"/"}else if(e.context===null){i="/"}return i};f.prototype._createNodeState=function(e){if(!e.groupID){d.fatal("To create a node state a group ID is mandatory!");return undefined}var t;var i;if(this._oInitialTreeState){t=this._oInitialTreeState._isExpanded(e.groupID);i=this._oInitialTreeState._isCollapsed(e.groupID);this._oInitialTreeState._remove(e.groupID)}var r=e.expanded||t||false;var s=e.selected||false;var o={groupID:e.groupID,expanded:r,sections:e.sections||[{startIndex:0,length:this._iPageSize}],sum:e.sum||false,selected:s};if(t||i){this._updateTreeState({groupID:e.groupID,fallbackNodeState:o,expanded:t,collapsed:i})}return o};f.prototype._updateTreeState=function(e){e=e||{};var t=e.expanded?this._mTreeState.expanded:this._mTreeState.collapsed;var i=e.expanded?this._mTreeState.collapsed:this._mTreeState.expanded;var r=this._getNodeState(e.groupID);if(!r){r=e.fallbackNodeState||this._createNodeState({groupID:e.groupID,expanded:e.expanded,sum:e.sum})}delete i[e.groupID];t[e.groupID]=r;r.expanded=e.expanded;return r};f.prototype._getGroupSize=function(e){return this.getChildCount(e.context)};f.prototype._loadChildContexts=function(e){var t=e.nodeState;var i;for(var r=0;r<t.sections.length;r++){var s=t.sections[r];var n=function(t){var r=[];for(var n in t.entry){var a=t.entry[n].resource;r[n]=a.resourceType+"/"+a.id}var d=this.aKeys.indexOf(e.context.sPath.substring(1))+1;var l=d+r.length;var u=this.aKeys.slice(d,l);if(!h(r,u)){o.insertArrayIntoArray(this.aKeys,r,d);this._buildContexts();this.iExpandedNodesLength+=r.length;this.iTotalLength+=r.length;i=this.aContexts.slice(d,l);this._iterateChildContexts(i,s,e)}}.bind(this);if(t.expanded){if(e.isArtificial){if(e.children.length===0){i=this.aContexts}else if(e.children.length!==s.length){i=this.aContexts.slice(this.aContexts.length-(s.length-s.startIndex),this.aContexts.length)}if(i!==undefined){this._iterateChildContexts(i,s,e)}}else if(!e.isLeaf&&e.children.length===0){this.getNodeContexts(e.context,n)}else if(!e.isLeaf&&e.children.length>0){for(var a=0;a<e.children.length;a++){this._loadChildContexts(e.children[a])}var d=[];l(e.children,function(e,t){d[e]=t.context.sPath.substring(1)});if(!o.isSubset(d,this.aKeys)){var u=this.aKeys.indexOf(e.context.sPath.substring(1))+1;o.insertArrayIntoArray(this.aKeys,d,u);this._buildContexts();this.iExpandedNodesLength+=d.length;this.iTotalLength+=d.length}}}else{this._removeFromKeysAndContexts(e)}}};f.prototype._removeFromKeysAndContexts=function(e){var t=[];this._flatTree(e,t,e,function(e){return e.context});var i=[];l(t,function(e,t){var r=t.sPath.substring(1);if(this.aKeys.indexOf(r)>-1){i.push(r)}}.bind(this));this.aKeys=o.removeArrayFromArray(this.aKeys,i);this._buildContexts();this.iExpandedNodesLength-=i.length;this.iTotalLength-=i.length};f.prototype._flatTree=function(e,t,i,r,s){if(e!==i){t.push(r?r(e):e)}if(e&&e.children&&(!s||s(e))){for(var o=0;o<e.children.length;o++){this._flatTree(e.children[o],t,i,r,s)}}};f.prototype._iterateChildContexts=function(e,i,r){l(e,function(e,s){if(s){var n=this._loadNumberOfChildren(s,function(t){this._processChildren(r,s,e+i.startIndex,t)}.bind(this));n.getRequest().complete(function(e){delete this.mRequestHandle[e.getId()];if(o.isEmptyObject(this.mRequestHandle)){this.bPendingRequest=false;this._mTreeStateOld=o.deepClone(this._mTreeState);this._fireChange({reason:t.Change})}}.bind(this,n));this.mRequestHandle[n.getId()]=n}}.bind(this))};f.prototype._processChildren=function(e,t,i,r){var s=e.children[i];var o={context:t,parent:e,level:e.level+1,positionInParent:i,autoExpand:Math.max(e.autoExpand-1,-1)};if(s){s.context=o.context;s.parent=o.parent;s.level=o.level;s.positionInParent=o.positionInParent;s.magnitude=0;s.numberOfTotals=0;s.autoExpand=o.autoExpand;var n=this._calculateGroupID(s);s.groupID=n}else{s=this._createNode(o)}s.nodeState=this._getNodeState(s.groupID);if(!s.nodeState){s.nodeState=this._createNodeState({groupID:s.groupID,expanded:r.expanded||false,sections:[{startIndex:0,length:r.total}]})}s.nodeState.parentGroupID=e.groupID;e.children[i]=s;s.isLeaf=!this.nodeHasChildren(s,r.total);if(s.isLeaf){e.numberOfLeafs+=1}if(s.parent.nodeState.selectAllMode&&!this._mTreeState.deselected[s.groupID]){this.setNodeSelection(s.nodeState,true)}if((s.autoExpand>0||s.nodeState.expanded)&&!this.aFilters){if(!this._mTreeState.collapsed[s.groupID]&&!s.isLeaf){this._updateTreeState({groupID:s.nodeState.groupID,fallbackNodeState:s.nodeState,expanded:true});this._loadChildContexts(s)}e.magnitude+=Math.max(s.magnitude||0,0);e.numberOfLeafs+=s.numberOfLeafs}return s};f.prototype.isGrouped=function(){return true};f.prototype._createTreeState=function(e){if(!this._mTreeState||e){this._mTreeState={expanded:{},collapsed:{},selected:{},deselected:{}}}};f.prototype.getNumberOfExpandedLevels=function(){return this.iNumberOfExpandedLevels};f.prototype.setNumberOfExpandedLevels=function(e){this.iNumberOfExpandedLevels=parseInt(e,10)};f.prototype.toggleIndex=function(e){var t=this.findNode(e);if(!t){d.fatal("There is no node at index "+e+".");return}if(t.nodeState.expanded){this.collapse(e)}else{this.expand(e)}};f.prototype._handleLastNodeInteraction=function(e,t){if(this.vNodeLastInteraction===this._oRootNode){this.vNodeLastInteraction=[]}if(e||this.vNodeLastInteraction.length>0){this.vNodeLastInteraction.push(t)}else{this.vNodeLastInteraction=t}};f.prototype.collapse=function(e,i){this._mTreeStateOld=o.deepClone(this._mTreeState);var r=this;var s=this.findNode(e);this._handleLastNodeInteraction(i,s);if(!s){d.fatal("No node found for index "+e);return}var n=s.nodeState;this._updateTreeState({groupID:n.groupID,fallbackNodeState:n,expanded:false});n.selectAllMode=false;if(this.bCollapseRecursive){var a=n.groupID;var h;for(h in this._mTreeState.expanded){if(h.startsWith(a)){r._updateTreeState({groupID:h,expanded:false})}}var l=[];for(h in this._mTreeState.selected){var u=this._mTreeState.selected[h];if(h.startsWith(a)&&h!==a){u.selectAllMode=false;r.setNodeSelection(u,false);l.push(h)}}if(l.length){var f={rowIndices:[]};var p=-1;this._map(this._oRootNode,function(e){if(!e||!e.isArtificial){p++}if(e&&l.indexOf(e.groupID)!==-1){if(e.groupID===this._sLeadSelectionGroupID){f.oldIndex=p;f.leadIndex=-1}f.rowIndices.push(p)}});this._publishSelectionChanges(f)}}if(!i){this._fireChange({reason:t.Collapse})}};f.prototype.expand=function(e,i){this._mTreeStateOld=o.deepClone(this._mTreeState);var r=this.findNode(e);if(!r){d.fatal("No node found for index "+e);return}this._handleLastNodeInteraction(i,r);this._updateTreeState({groupID:r.nodeState.groupID,fallbackNodeState:r.nodeState,expanded:true});if(!i){this._fireChange({reason:t.Expand})}};f.prototype.getNodes=function(e,t,i){return this.getContexts(e,t,i,true)};f.prototype.nodeHasChildren=function(e,t){if(!e){return false}else if(e.isArtificial||t>0){return true}else if(e.isLeaf===false){return true}else{return e.children.length>0}};f.prototype._loadNumberOfChildren=function(e,t){var i=this.oModel.getProperty(undefined,e);var r={urlParameters:{_count:1}};r.urlParameters[this.sRootSearch]=i[this.sNodeProperty];return this._submitRequest(this.sPath,r,t)};f.prototype.getNodeContexts=function(e,t){var i=this.oModel.getProperty(undefined,e);var r={urlParameters:{}};r.urlParameters[this.sRootSearch]=i[this.sNodeProperty];this._submitRequest(this.sPath,r,undefined,t)};f.prototype.isExpanded=function(e){var t=this.findNode(e);return t&&t.nodeState?t.nodeState.expanded:false};f.prototype._map=function(e,t){t.call(this,e);if(!e){return}for(var i=0;i<e.children.length;i++){var r=e.children[i];this._map(r,t)}if(this._afterMapHook){this._afterMapHook(e,t)}};f.prototype.setNodeSelection=function(e,t){if(!e.groupID){d.fatal("NodeState must have a group ID!");return}e.selected=t;if(t){this._mTreeState.selected[e.groupID]=e;delete this._mTreeState.deselected[e.groupID]}else{delete this._mTreeState.selected[e.groupID];this._mTreeState.deselected[e.groupID]=e}};f.prototype.isIndexSelected=function(e){var t=this.getNodeByIndex(e);return t&&t.nodeState?t.nodeState.selected:false};f.prototype.isIndexSelectable=function(e){var t=this.getNodeByIndex(e);return this._isNodeSelectable(t)};f.prototype._isNodeSelectable=function(e){return!!e&&!e.isArtificial};f.prototype.setSelectedIndex=function(e){var t=this.findNode(e);if(t&&this._isNodeSelectable(t)){var i=this._clearSelection();var r=i.rowIndices.indexOf(e);if(r>=0){i.rowIndices.splice(r,1)}else{i.rowIndices.push(e)}i.leadGroupID=t.groupID;i.leadIndex=e;this.setNodeSelection(t.nodeState,true);this._publishSelectionChanges(i)}else{d.warning("The selection was ignored. Please make sure to only select rows, for which data has been fetched to the client. For AnalyticalTables, some rows might not be selectable at all.")}};f.prototype.getSelectedIndices=function(){var e=[];var t=this;if(o.isEmptyObject(this._mTreeState.selected)){return e}var i=Object.keys(this._mTreeState.selected).length;var r=-1;var s=function(i){if(!i||!i.isArtificial){r++}if(i){if(i.nodeState&&i.nodeState.selected&&!i.isArtificial){e.push(r);t._aRowIndexMap[r]=i;return true}}return undefined};this._match(this._oRootNode,[],i,s);return e};f.prototype.getSelectedNodesCount=function(){var e;if(this._oRootNode&&this._oRootNode.nodeState.selectAllMode){var t,i,r,s;var o,n=[];if(this.filterInfo&&this.aAllFilters){for(var a=this.filterInfo.aFilteredContexts.length-1;a>=0;a--){o=this.filterInfo.aFilteredContexts[a];n.push(this._calculateGroupID({context:o}))}}i=0;for(t in this._mTreeState.expanded){if(!this.aAllFilters||n.indexOf(t)!==-1){s=this._mTreeState.expanded[t];if(!s.selectAllMode&&s.leafCount!==undefined){i+=s.leafCount}}}for(t in this._mTreeState.selected){if(!this.aAllFilters||n.indexOf(t)!==-1){s=this._mTreeState.selected[t];r=this._mTreeState.expanded[s.parentGroupID];if(r&&!r.selectAllMode){i--}}}for(t in this._mTreeState.deselected){if(!this.aAllFilters||n.indexOf(t)!==-1){s=this._mTreeState.deselected[t];r=this._mTreeState.expanded[s.parentGroupID];if(r&&r.selectAllMode){i++}}}e=this._getSelectableNodesCount(this._oRootNode)-i}else{e=Object.keys(this._mTreeState.selected).length}return e};f.prototype._getSelectableNodesCount=function(e){if(e){return e.magnitude}else{return 0}};f.prototype.getSelectedContexts=function(){var e=[];var t=this;if(o.isEmptyObject(this._mTreeState.selected)){return e}var i=Object.keys(this._mTreeState.selected).length;var r=-1;var s=function(i){if(!i||!i.isArtificial){r++}if(i){if(i.nodeState&&i.nodeState.selected&&!i.isArtificial){e.push(i.context);t._aRowIndexMap[r]=i;return true}}return undefined};this._match(this._oRootNode,[],i,s);return e};f.prototype.setSelectionInterval=function(e,t){var i=this._clearSelection();var r=this._setSelectionInterval(e,t,true);var s={};var o=[];var n;for(var a=0;a<i.rowIndices.length;a++){n=i.rowIndices[a];s[n]=true}for(var d=0;d<r.rowIndices.length;d++){n=r.rowIndices[d];if(s[n]){delete s[n]}else{s[n]=true}}for(n in s){if(s[n]){o.push(parseInt(n,10))}}this._publishSelectionChanges({rowIndices:o,oldIndex:i.oldIndex,leadIndex:r.leadIndex,leadGroupID:r.leadGroupID})};f.prototype._setSelectionInterval=function(e,t,i){var r=Math.min(e,t);var s=Math.max(e,t);var o=[];var n=[];var a=Math.abs(s-r)+1;var d;var h=-1;var l=function(e){if(!e||!e.isArtificial){h++}if(e){if(h>=r&&h<=s){if(this._isNodeSelectable(e)){if(e.nodeState.selected!==!!i){n.push(h)}if(e.groupID===this._sLeadSelectionGroupID){d=h}this.setNodeSelection(e.nodeState,!!i)}return true}}return undefined};this._match(this._oRootNode,o,a,l);var u={rowIndices:n,oldIndex:d,leadIndex:d&&!i?-1:undefined};if(o.length>0&&i){var f=o[o.length-1];u.leadGroupID=f.groupID;u.leadIndex=s}return u};f.prototype.addSelectionInterval=function(e,t){var i=this._setSelectionInterval(e,t,true);this._publishSelectionChanges(i)};f.prototype.removeSelectionInterval=function(e,t){var i=this._setSelectionInterval(e,t,false);this._publishSelectionChanges(i)};f.prototype.selectAll=function(){this._mTreeState.deselected={};var e={rowIndices:[],oldIndex:-1,selectAll:true};var t=-1;this._map(this._oRootNode,function(i){if(!i||!i.isArtificial){t++}if(i){if(i.groupID===this._sLeadSelectionGroupID){e.oldIndex=t}if(this._isNodeSelectable(i)){if(i.nodeState.selected!==true){e.rowIndices.push(t)}this.setNodeSelection(i.nodeState,true);e.leadGroupID=i.groupID;e.leadIndex=t}if(i.nodeState.expanded){i.nodeState.selectAllMode=true}}});this._publishSelectionChanges(e)};f.prototype._clearSelection=function(){var e=-1;var t=-1;var i=0;var r=[];for(var s in this._mTreeState.selected){if(s){i++}}var o=function(i){if(!i||!i.isArtificial){e++}if(i){i.nodeState.selectAllMode=false;if(this._mTreeState.selected[i.groupID]){if(!i.isArtificial){r.push(e)}this.setNodeSelection(i.nodeState,false);if(i.groupID===this._sLeadSelectionGroupID){t=e}return true}}return undefined};this._match(this._oRootNode,[],i,o);if(this._oRootNode&&this._oRootNode.nodeState&&this._oRootNode.isArtificial){this._oRootNode.nodeState.selectAllMode=false}return{rowIndices:r,oldIndex:t,leadIndex:-1}};f.prototype.clearSelection=function(e){var t=this._clearSelection();if(!e){this._publishSelectionChanges(t)}};f.prototype._publishSelectionChanges=function(e){e.oldIndex=e.oldIndex||this.getSelectedIndex();e.rowIndices.sort(function(e,t){return e-t});if(e.leadIndex>=0&&e.leadGroupID){this._sLeadSelectionGroupID=e.leadGroupID}else if(e.leadIndex===-1){this._sLeadSelectionGroupID=undefined}else{e.leadIndex=e.oldIndex}if(e.rowIndices.length>0||e.leadIndex!==undefined&&e.leadIndex!==-1){this.fireSelectionChanged(e)}};f.prototype.setCollapseRecursive=function(e){this.bCollapseRecursive=!!e};f.prototype.getCollapseRecursive=function(){return this.bCollapseRecursive};f.prototype.attachSelectionChanged=function(e,t,i){this.attachEvent("selectionChanged",e,t,i);return this};f.prototype.detachSelectionChanged=function(e,t){this.detachEvent("selectionChanged",e,t);return this};f.prototype.fireSelectionChanged=function(e){this.fireEvent("selectionChanged",e);return this};return f});
sap.ui.predefine("sap/fhir/model/r4/FHIRUtils",["sap/fhir/model/r4/FHIRFilterOperatorUtils","sap/fhir/model/r4/FHIRFilterOperator","sap/fhir/model/r4/FHIRFilterComplexOperator","sap/ui/model/ChangeReason","sap/base/util/merge","sap/base/util/deepEqual","sap/ui/model/Filter","sap/ui/model/Sorter"],function(e,r,t,i,a,n,s,f){"use strict";var o={};o.createSortParams=function(e){var r;if(e&&Array.isArray(e)&&e.length>0){r="";for(var t=0;t<e.length;t++){var i=e[t];if(i.bDescending){r+="-"}r+=i.sPath;if(t!==e.length-1){r+=","}}}return r};o.addRequestQueryParameters=function(e,r){if(e.mParameters&&e.mParameters.hasOwnProperty("request")){if(!r.urlParameters){r.urlParameters={}}for(var t in e.mParameters.request){r.urlParameters[t]=e.mParameters.request[t]}}};o.insertArrayIntoArray=function(e,r,t){Array.prototype.splice.apply(e,[t,0].concat(r))};o.removeArrayFromArray=function(e,r){return e.filter(function(e){return r.indexOf(e)<0})};o.getIndexOfValueInArray=function(e,r){if(r&&Array.isArray(r)){for(var t=0;t<r.length;t++){var i=r[t];if(n(i,e)){return t}}return-1}return-1};o.isSubset=function(e,r){return e.every(function(e){return r.indexOf(e)>=0})};o.isQuantity=function(e){return false};o.isString=function(e){return typeof e==="string"};o.isObject=function(e){return typeof e==="object"};o.isNumber=function(e){return typeof e==="number"};o.isEmptyObject=function(e){for(var r in e){return false}return true};o.filterArray=function(e,r,t,i){return e.filter(function(e){if(i){return i(e)}else{return e[r]===t}})};o.filterObject=function(e,r,t,i,a,n){if(i>0){for(var s in e){this.filterObject(e[s],r,t,i-1,a,n)}}if(i===0&&e[r]===t){if(n){a.push(n(e))}else{a.push(e)}}};o.deepClone=function(e){if(e&&typeof e==="object"){if(Array.isArray(e)){return a([],e)}else if(e instanceof Date){return new Date(e.getTime())}else{return a({},e)}}else if(e){return e}return undefined};o.uuidv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=Math.floor(Math.random()*16),t=e==="x"?r:r%4+8;return t.toString(16)})};o.getLinkUrl=function(e,r){var t=this.filterArray(e,"relation",r)[0];return t&&t.url?t.url:undefined};o.getNumberOfLevelsByPath=function(e){return this.countOccurrence(e,"/")};o.countOccurrence=function(e,r){var t=-1;if(e===undefined){throw new Error("sBase is undefined")}if(!this.isString(e)){throw new Error("sBase is not a string")}for(var i=-2;i!==-1;t++){i=e.indexOf(r,i+1)}return t};o.checkStringParameter=function(e,r){if(!e.hasOwnProperty(r)){throw new Error("Missing parameter: '"+r+"'.")}else if(!o.isString(e[r])){throw new Error("Unsupported parameter type: '"+r+"'. Parameter has to be of type string.")}};o.checkPathParameter=function(e,r){this.checkStringParameter(e,r);if(e[r].startsWith("/")){throw new Error("Unsupported parameter: '"+r+"'. Parameter must not start with a '/'.")}else if(e[r].endsWith("/")){throw new Error("Unsupported parameter: '"+r+"'. Parameter must not end with a '/'.")}};o.checkFHIRSearchParameter=function(e,r){this.checkStringParameter(e,r)};o.checkRegularExpression=function(e,r){if(!e){throw new Error("Empty string. Can not check the regular expression: "+r+" for an undefined text.")}if(!r){throw new Error("Empty regular expression")}return e.match(r)?true:false};o.splitPath=function(e){var r=/((\s*(\[|§)(.*?)(\]|§)\s*)+)/g;var t=e.match(r);var i=e.replace(r,"");var a=i.split("/");for(var n=1;n<a.length;n++){if(!a[n]&&t){a[n]=t.shift()}}return a};o.filterBuilder=function(e,r,t,i,a,n,s){if(a===undefined){a=0}if(e){for(var f=0;f<e.length;f++){var o=e[f];if(!t){if(!r._filter){r._filter=""}this._complexFilterBuilder(o,r,undefined)}else if(o._bMultiFilter&&a<=t){this.filterBuilder(o.aFilters,r,t,i,a+1,o._bMultiFilter,o.bAnd)}else if(a>t){throw new Error("A depth of "+a+" is not supported for simple filtering, please reduce it to a maximum of 2")}else{this._filterBuilder(o,r,i,n,s)}}}};o._filterBuilder=function(t,i,a,n,s){var f=t.sPath;var o=e.getFHIRSearchParameterModifier(t);var u=e.getFilterValue(t.oValue1);var l=e.getFHIRSearchPrefix(t);var c;if(l){c=l+u}else{c=u}if(a){i.filter=t.oValue1}else if(t.sOperator===r.BT){var d=e.getFilterValue(t.oValue2);i[f+o]=[r.GE.toLowerCase()+u,r.LE.toLowerCase()+d]}else if(n&&!s){if(i[f+o]){i[f+o].push(c)}else{i[f+o]=[c]}}else{i[f+o]=c}};o._complexFilterBuilder=function(r,i,a){var n;if(r instanceof s){if(r._bMultiFilter){n=r.bAnd&&r.bAnd==true?"and":"or";if(r.aFilters){i._filter=i._filter+"( ";this._complexFilterBuilder(r.aFilters[0],i,undefined);for(var f=1;f<r.aFilters.length;f++){this._complexFilterBuilder(r.aFilters[f],i,n)}i._filter=i._filter+" )"}}else{var o=r.sPath;var u=e.getFHIRFilterPrefix(r);var l=e.getFilterValueForComplexFilter(r.sValueType,r.oValue1);var c;var d;if(r.sOperator===t.BT){c=e.getFilterValueForComplexFilter(r.sValueType,r.oValue2);d="( "+o+" "+t.GE.toLowerCase()+" "+l+" and "+o+" "+t.LE.toLowerCase()+" "+c+" )"}else{d=o+" "+u+" "+l}if(a){i._filter=i._filter+" "+a+" "+d}else{i._filter=i._filter+d}}}};o.filter=function(e,r){if(!e){e=[]}if(e instanceof s){e=[e]}if(r.bPendingRequest){var t=function(){if(!r.bPendingRequest){r.detachDataReceived(t);r.bIsDataReceivedAttached=false;r.aFilters=r.aFilterCache;r.refresh(i.Filter)}};if(!r.bIsDataReceivedAttached){r.bIsDataReceivedAttached=true;r.attachDataReceived(t)}r.aFilterCache=e}else{r.aFilters=e;r.refresh(i.Filter)}};o.sort=function(e,r,t){if(!e){e=[]}if(e instanceof f){e=[e]}if(r.bPendingRequest){var a=function(){if(!r.bPendingRequest){r.detachDataReceived(a);r.bIsDataReceivedAttached=false;r.aSorters=r.aSortersCache;if(t){r.refresh(i.Sort)}}};if(!r.bIsDataReceivedAttached){r.bIsDataReceivedAttached=true;r.attachDataReceived(a)}r.aSortersCache=e}else{r.aSorters=e;if(t){r.refresh(i.Sort)}}};o.isRequestable=function(e){return e&&(e.indexOf("$")>-1||(e.match(/\//g)||[]).length<=2||e.indexOf("_history")>-1)};o.isContextBinding=function(e){return e&&e.getMetadata().getName()==="sap.fhir.model.r4.FHIRContextBinding"};o.isPropertyBinding=function(e){return e&&e.getMetadata().getName()==="sap.fhir.model.r4.FHIRPropertyBinding"};o.generateFullUrl=function(e,r,t,i){var a;if(e){switch(e.getName()){case"sap.fhir.model.r4.type.Uuid":a="urn:"+e.toString()+":";if(t&&e.validateValue(t)){a+=t}else{a+=this.uuidv4()}break;case"sap.fhir.model.r4.type.Url":a=i+r;break;default:break}}return a};return o});
sap.ui.predefine("sap/fhir/model/r4/OperationMode",function(){"use strict";var e={Server:"Server",Client:"Client"};return e});
sap.ui.predefine("sap/fhir/model/r4/SubmitMode",function(){"use strict";var r={Batch:"Batch",Transaction:"Transaction",Direct:"Direct"};return r});
sap.ui.predefine("sap/fhir/model/r4/lib/BindingInfo",[],function(){"use strict";var t=function(t,e,r,s,o,i,n,u,h,a,p){this._sResourceId=t;this._sResourceType=e;this._sResourcePath=r;this._sRelativePath=s;this._sAbsolutePath=o;this._sGroupId=n;this._sRequestPath=u;this._aResourcePath=h;this._sResourceServerPath=a;this._sETag=p;if(i.indexOf("")>-1){throw new Error("Invalid property binding path")}this._aBinding=i};t.prototype.getResourceId=function(){return this._sResourceId};t.prototype.getResourceType=function(){return this._sResourceType};t.prototype.getResourcePath=function(){return this._sResourcePath};t.prototype.getRelativePath=function(){return this._sRelativePath};t.prototype.getAbsolutePath=function(){return this._sAbsolutePath};t.prototype.getGroupId=function(){return this._sGroupId};t.prototype.getBinding=function(){return this._aBinding};t.prototype.getRequestPath=function(){return this._sRequestPath};t.prototype.getResourcePathArray=function(){return this._aResourcePath};t.prototype.getResourceServerPath=function(){return this._sResourceServerPath};t.prototype.getETag=function(){return this._sETag};return t});
sap.ui.predefine("sap/fhir/model/r4/lib/FHIRBundle",["sap/fhir/model/r4/FHIRUtils"],function(t){"use strict";var e=function(e,n){this._sId=t.uuidv4();this._sBundleType=e;this._aBundleEntries=[];this._sGroupId=n};e.prototype.getBundleData=function(){var t={};t.id=this._sId;t.type=this._sBundleType;t.resourceType="Bundle";t.entry=this.getBundleEntriesData();return t};e.prototype.getBundleEntriesData=function(){var t=[];for(var e=0;e<this._aBundleEntries.length;e++){t.push(this._aBundleEntries[e].getBundleEntryData())}return t};e.prototype.getBundlyEntry=function(t){return this._aBundleEntries[t]};e.prototype.addBundleEntry=function(t){this._aBundleEntries.push(t)};e.prototype.getId=function(){return this._sId};e.prototype.getBundleType=function(){return this._sBundleType};e.prototype.getBundleEntries=function(){return this._aBundleEntries};e.prototype.getNumberOfBundleEntries=function(){return this._aBundleEntries.length};e.prototype.getGroupId=function(){return this._sGroupId};return e});
sap.ui.predefine("sap/fhir/model/r4/lib/FHIRBundleEntry",[],function(){"use strict";var e=function(e,t,r){this._sFullUrl=e;this._oResource=t;this._oRequest=r};e.prototype.getBundleEntryData=function(){var e={};e.fullUrl=this._sFullUrl?this._sFullUrl:undefined;e.resource=this._oResource?this._oResource:undefined;e.request=this._oRequest.getBundleRequestData();return e};e.prototype.getRequest=function(){return this._oRequest};e.prototype.getResource=function(){return this._oResource};e.prototype.getFullUrl=function(){return this._sFullUrl};return e});
sap.ui.predefine("sap/fhir/model/r4/lib/FHIRBundleRequest",[],function(){"use strict";var t=function(t,i,e,s,n,f,o,h,r){this._sMethod=i;this._sUrl=e;this._sIfMatch=f;this._sIfNoneMatch=o;this._sIfNoneExist=h;this._sIfModifiedSince=r;this._fnSuccess=s;this._fnError=n;this._oBinding=t};t.prototype.getBundleRequestData=function(){var t={};t.method=this._sMethod;t.url=this._sUrl;t.ifMatch=this._sIfMatch?this._sIfMatch:undefined;t.ifNoneMatch=this._sIfNoneMatch?this._sIfNoneMatch:undefined;t.ifNoneExist=this._sIfNoneExist?this._sIfNoneExist:undefined;t.ifModifiedSince=this._sIfModifiedSince?this._sIfModifiedSince:undefined;return t};t.prototype.getBinding=function(){return this._oBinding};t.prototype.getUrl=function(){return this._sUrl};t.prototype.executeSuccessCallback=function(){this._fnSuccess.apply(undefined,arguments)};t.prototype.executeErrorCallback=function(){this._fnError.apply(undefined,arguments)};return t});
sap.ui.predefine("sap/fhir/model/r4/lib/FHIRBundleType",function(){"use strict";var e={Document:"document",Message:"message",Transaction:"transaction",TransactionResponse:"transaction-response",Batch:"batch",BatchResponse:"batch-response",History:"history",SearchSet:"searchset",Collection:"collection"};return e},true);
sap.ui.predefine("sap/fhir/model/r4/lib/FHIROperationOutcome",[],function(){"use strict";var t=function(t){this._sResourceType=t.resourceType;this._aIssue=t.issue?t.issue:[]};t.prototype.getIssues=function(){return this._aIssue};t.prototype.getIssueBySeverity=function(t){return this._aIssue.find(function(e){return e.severity===t})};t.prototype.getIssueByCode=function(t){return this._aIssue.find(function(e){return e.code===t})};t.prototype.getDetailsTextBySeverity=function(t){var e=this._aIssue.find(function(e){return e.severity===t});return e&&e.details&&e.details.text?e.details.text:""};t.prototype.getDiagnosticsBySeverity=function(t){var e=this._aIssue.find(function(e){return e.severity===t});return e&&e.diagnostics?e.diagnostics:""};t.prototype.getErrorText=function(){return this.getDetailsTextBySeverity("error")};t.prototype.getErrorDiagnostics=function(){return this.getDiagnosticsBySeverity("error")};return t});
sap.ui.predefine("sap/fhir/model/r4/lib/FHIRRequestor",["sap/ui/thirdparty/jquery","sap/fhir/model/r4/FHIRUtils","sap/fhir/model/r4/SubmitMode","sap/fhir/model/r4/lib/FHIRBundle","sap/fhir/model/r4/lib/FHIRBundleEntry","sap/fhir/model/r4/lib/FHIRBundleRequest","sap/fhir/model/r4/lib/FHIRBundleType","sap/fhir/model/r4/lib/RequestHandle","sap/fhir/model/r4/lib/HTTPMethod","sap/fhir/model/r4/lib/FHIRUrl","sap/base/util/each","sap/base/util/merge","sap/fhir/model/r4/lib/FHIROperationOutcome"],function(e,t,r,n,i,s,u,o,a,d,l,h,p){"use strict";var f=function(e,t,r,n,i){this._mBundleQueue={};this.oModel=t;this._sServiceUrl=e;this._aPendingRequestHandles=[];this.bCSRF=!!r;this.sPrefer=n?"return=minimal":n;this.oDefaultQueryParams=i;this._oRegex={rAmpersand:/&/g,rEquals:/\=/g,rHash:/#/g,rPlus:/\+/g}};f.prototype.submitBundle=function(e,t,r){var n=this._mBundleQueue[e];return this._sendBundle(n,t,r)};f.prototype._request=function(e,n,i,s,u,a,d,l,h,p,f){if(!t.isRequestable(n)&&!i){return undefined}var c;if(!i&&this._getGroupSubmitMode(u)!==r.Direct){var g=this._getBundleByGroup(u);var _=this._getGroupUri(u);var m=this._createBundleEntry(e,n,s,d,l,h,p,_);g.addBundleEntry(m);if(f){this._mBundleQueue[u]=g;return g}else{c=this._mBundleQueue[u];if(c&&c instanceof o){c.getRequest().abort()}c=this._sendBundle(g);this._mBundleQueue[u]=c;return c}}c=this._sendRequest(e,n,s,a,d,l,h,p);return c};f.prototype._createBundleEntry=function(e,r,n,u,o,d,l,h){if(r&&r.charAt(0)==="/"){r=r.slice(1)}var p=e===a.POST?this.oModel.getBindingInfo("/"+r,undefined,false,u):this.oModel.getBindingInfo("/"+r);var f=r+(a.GET===e?this._buildQueryParameters(n,p,e):"");var c;var g;if(a.GET!==e){c=t.generateFullUrl(h,p.getResourceServerPath(),p.getResourceId(),this._sServiceUrl);g=p.getETag()}var _=new s(l,e,f,o,d,g);var m=new i(c,u,_);return m};f.prototype._sendBundle=function(e,t,r){var n=function(n,i){var s=[];var u=[];this._deleteBundleFromQueue(e.getGroupId());for(var o=0;o<n.getNumberOfBundleEntries();o++){var a=n.getBundlyEntry(o);var d=i.getRequest().responseJSON.entry[o];if(d&&d.response.status.startsWith("2")){if(d.resource){s.push(d.resource)}else if(a.getResource()){s.push(a.getResource())}a.getRequest().executeSuccessCallback(i,d,a)}else{if(d&&d.response.outcome){u.push(new p(d.response.outcome))}a.getRequest().executeErrorCallback(i,d,a)}}if(r&&u.length>0){r(i,s,u)}else if(t){t(s)}}.bind(this,e);var i=function(t,n){this._deleteBundleFromQueue(e.getGroupId());for(var i=0;i<t.getNumberOfBundleEntries();i++){var s=t.getBundlyEntry(i);s.getRequest().executeErrorCallback(n)}if(r){r(n)}}.bind(this,e);var s=this._sendRequest(a.POST,"",{},{},e.getBundleData(),n,i);s.setBundle(e);return s};f.prototype._sendRequest=function(e,r,n,i,s,u,a,l){var h=new o(l);var p=new d(r,this._sServiceUrl);var f=p.getQueryParameters()?"":this._buildQueryParameters(n,this.oModel.getBindingInfo(p.getRelativeUrlWithoutQueryParameters()),e);var c=r.startsWith("http")?r:this._sServiceUrl+p.getRelativeUrlWithQueryParameters()+f;i=i?i:{};i["Accept-Language"]=sap.ui.getCore().getConfiguration().getLanguageTag();i["cache-control"]="no-cache";i.Prefer=this.sPrefer;var g=function(){return this._ajax(h,{url:c,data:JSON.stringify(s),beforeSend:function(e,r){h.setUrl(r.url);h.setData(r.data);h.setRequest(e);h.setHeaders(r.headers);var n=[];if(r.url!==this._sServiceUrl){n=t.filterArray(this._aPendingRequestHandles,undefined,undefined,function(e){return e.getUrl()===r.url})}if(n.length>0){this._add(n[0],u,a);e.abort()}else{this.oModel.fireRequestSent(this._createEventParameters(h))}}.bind(this),headers:i,type:e,contentType:"application/json",traditional:true},u,a)}.bind(this);if(this.bCSRF&&!this.sToken){i["x-csrf-token"]="fetch";var _=t.deepClone(u);var m=t.deepClone(a);u=this._callBackForXcsrfToken.bind(this,_);a=function(e,t){m(e,t)};return g()}else if(this.bCSRF&&this.sToken){i["x-csrf-token"]=this.sToken;return g()}else{return g()}};f.prototype._callBackForXcsrfToken=function(e,t){this.sToken=this.getResponseHeaders(t.getRequest())["x-csrf-token"];e(t)};f.prototype._ajax=function(t,r,n,i){var s=e.ajax(r);if(!t.isAborted()){s.complete(function(e){this.oModel.fireRequestCompleted(this._createEventParameters(e))}.bind(this,t));this._add(t,n,i);this._aPendingRequestHandles.push(t)}return t};f.prototype._add=function(e,t,r){var n=e.getRequest();n.done(function(e){this._deleteRequestHandle(e);t(e)}.bind(this,e));n.fail(function(e){this._deleteRequestHandle(e);r(e);if(!e.isAborted()){this.oModel.fireRequestFailed(this._createEventParameters(e))}}.bind(this,e))};f.prototype._createEventParameters=function(e){return{requestHandle:e}};f.prototype._getGroupSubmitMode=function(e){return this.oModel.getGroupProperty(e,"submit")};f.prototype._getGroupUri=function(e){return this.oModel.getGroupProperty(e,"uri")};f.prototype._getBundleByGroup=function(e){var t=this._mBundleQueue[e];if(!t){t=new n(this._getBundleTypeBySubmitMode(this._getGroupSubmitMode(e)),e)}else if(t instanceof o){t=t.getBundle()}return t};f.prototype._getBundleTypeBySubmitMode=function(e){switch(e){case r.Batch:return u.Batch;case r.Transaction:return u.Transaction;default:throw new Error("Unsupported SubmitMode: "+e)}};f.prototype._deleteBundleFromQueue=function(e){delete this._mBundleQueue[e]};f.prototype._buildQueryParameters=function(e,t,r){var n;r=r?r:a.GET;e=e?e:{};if(!t){return""}if(!t.getResourceId()&&r===a.GET){e=h(e,this.oDefaultQueryParams)}if(!this._isFormatSupported(e._format)){e._format="json"}n=[];l(e,function(e,t){if(t&&Array.isArray(t)){t.forEach(function(t){n.push(this._encodePair(e,t))}.bind(this))}else if(t){n.push(this._encodePair(e,t))}}.bind(this));return"?"+n.join("&")};f.prototype._encodePair=function(e,t){return this._encode(e,true)+"="+this._encode(t,false)};f.prototype._encode=function(e,t){var r=encodeURI(e).replace(this._oRegex.rAmpersand,"%26").replace(this._oRegex.rHash,"%23").replace(this._oRegex.rPlus,"%2B");if(t){r=r.replace(this._oRegex.rEquals,"%3D")}return r};f.prototype._deleteRequestHandle=function(e){var r=t.getIndexOfValueInArray(e,this._aPendingRequestHandles);this._aPendingRequestHandles.splice(r,1)};f.prototype.destroy=function(){this._mBundleQueue={};for(var e=0;e<this._aPendingRequestHandles.length;e+=0){this._aPendingRequestHandles[e].abort()}};f.prototype.getResponseHeaders=function(e){var t={};var r=e.getAllResponseHeaders().trim();var n=r.split("\n");for(var i=0;i<n.length;i++){var s=n[i];var u=s.split(":");t[u[0]]=e.getResponseHeader(u[0])}return t};f.prototype._isFormatSupported=function(e){var t=["json","application/json","application/fhir+json"];return t.indexOf(e)>=0};return f});
sap.ui.predefine("sap/fhir/model/r4/lib/FHIRUrl",[],function(){"use strict";var e=function(r,t){this._sServiceUrl=t;var s=r.indexOf(t);r=s>-1?r.substring(s+t.length):r;r=r&&r.charAt(0)!=="/"&&r.charAt(0)!=="?"?"/"+r:r;if(r.indexOf("?")>-1){this._sRelativeUrlWithQueryParameters=r;this._sRelativeUrlWithoutQueryParameters=r.substring(0,r.indexOf("?"))}else{this._sRelativeUrlWithQueryParameters=r;this._sRelativeUrlWithoutQueryParameters=r}var i=this._sRelativeUrlWithoutQueryParameters?this._sRelativeUrlWithoutQueryParameters.split("/"):undefined;this._sResourceType=i?i[1]:undefined;this._sResourceId=i&&i.length>=3?i[2]:undefined;this._sHistoryVersion=i&&i.length===5?i[4]:undefined;this._mQueryParameter=e.getQueryParametersByUrl(this._sRelativeUrlWithQueryParameters)};e.prototype.getRelativeUrlWithoutQueryParameters=function(){return this._sRelativeUrlWithoutQueryParameters};e.prototype.getRelativeUrlWithQueryParameters=function(){return this._sRelativeUrlWithQueryParameters};e.prototype.getResourceType=function(){return this._sResourceType};e.prototype.getResourceId=function(){return this._sResourceId};e.prototype.getQueryParameters=function(){return this._mQueryParameter};e.prototype.getHistoryVersion=function(){return this._sHistoryVersion};e.prototype.getFullUrl=function(e){if(e&&e.substring(0,4)==="http"){var r=e.indexOf("?");return e.substring(0,r>-1?r:undefined)}else if(this._sServiceUrl.charAt(0)!=="/"&&this._sResourceType&&this._sResourceId){return this._sServiceUrl+"/"+this._sResourceType+"/"+this._sResourceId}else{return undefined}};e.getQueryParametersByUrl=function(e){if(e){var r=e.indexOf("?");if(r>-1){var t=e.substring(r+1).split("&");var s={};var i;for(var u=0;u<t.length;u++){i=t[u].split("=");s[i[0]]=i[1]}return s}}return undefined};return e});
sap.ui.predefine("sap/fhir/model/r4/lib/HTTPMethod",function(){"use strict";var T={DELETE:"DELETE",POST:"POST",PUT:"PUT",PATCH:"PATCH",GET:"GET",HEAD:"HEAD"};return T});
sap.ui.predefine("sap/fhir/model/r4/lib/RequestHandle",["sap/fhir/model/r4/FHIRUtils"],function(t){"use strict";var e=function(e){this._sId=t.uuidv4();this.setBinding(e)};e.prototype.setBinding=function(t){this._oBinding=t};e.prototype.setBundle=function(t){this._oBundle=t};e.prototype.setUrl=function(t){this._sUrl=t};e.prototype.setRequest=function(t){this._jqRequest=t};e.prototype.setData=function(t){this._sData=t};e.prototype.setHeaders=function(t){this._mHeaders=t};e.prototype.getBinding=function(){return this._oBinding};e.prototype.getBundle=function(){return this._oBundle};e.prototype.getUrl=function(){return this._sUrl};e.prototype.getRequest=function(){return this._jqRequest};e.prototype.getData=function(){return this._sData};e.prototype.getHeaders=function(){return this._mHeaders};e.prototype.getId=function(){return this._sId};e.prototype.abort=function(){this.getRequest().abort()};e.prototype.isAborted=function(){return this.getRequest().statusText==="abort"||this.getRequest().statusText==="canceled"};return e});
sap.ui.predefine("sap/fhir/model/r4/lib/Sliceable",["sap/fhir/model/r4/FHIRUtils","sap/fhir/model/r4/FHIRFilterOperator","sap/ui/model/Filter"],function(e,r,i){"use strict";var t={};function n(e){e=e.trim();return e===0||e===null||e?e:undefined}t.getSliceables=function(e){var t;var a="&amp;&amp;";if(!e){throw new Error("Invalid Sliceable: Expression is empty.")}else if(!e.startsWith("[")||!e.endsWith("]")){throw new Error('Invalid Sliceable: "'+e+"\" doesn't start or end with a square bracket.")}else{var l=e.substring(1,e.length-1);var s=l.split(",");t={};for(var f=0;f<s.length;f++){var o;if(s[f].indexOf(a)>-1){o=s[f].split(a)}else{o=s[f].split("&&")}var u;var v;var d;for(var p=0;p<o.length;p++){if(o[p].indexOf("=")===-1){for(var h in r){var c=o[p].indexOf(h);if(c>-1){var b=h.length;u=o[p].substring(0,c).trim();v=o[p].substring(c+b).trim();d=h;break}}}else{var g=o[p].split("=");u=g[0].trim();v=n(g[1]);d=r.EQ}if(u){var m=new i({path:u,value1:n(v),operator:d});if(o.length===1){t[s[f]]=m}else{if(!t[s[f]]){t[s[f]]=[]}t[s[f]].push(m);if(p===o.length-1){t[s[f]]=new i({filters:t[s[f]],and:true})}}}else{throw new Error('Invalid Sliceable: "'+e+"\". Key can't be determined.")}}}}return t};t.containsSliceable=function(r){return e.checkRegularExpression(r,/(\s)*(\[)+(.*)(\])+(\s)*/g)};return t});
sap.ui.predefine("sap/fhir/model/r4/type/Uri",["sap/ui/model/SimpleType"],function(t){"use strict";var e=t.extend("sap.fhir.model.r4.type.Uri",{constructor:function(t,e){},metadata:{abstract:true}});e.prototype.getInterface=function(){return this};e.prototype.setConstraints=function(t){};e.prototype.setFormatOptions=function(t){};e.prototype.validateValue=function(t){return true};return e});
sap.ui.predefine("sap/fhir/model/r4/type/Url",["sap/fhir/model/r4/type/Uri"],function(r){"use strict";var t=r.extend("sap.fhir.model.r4.type.Uri",{constructor:function(t,e){r.apply(this,arguments)}});t.prototype.getName=function(){return"sap.fhir.model.r4.type.Url"};t.prototype.toString=function(){return"url"};return t});
sap.ui.predefine("sap/fhir/model/r4/type/Uuid",["sap/fhir/model/r4/type/Uri","sap/fhir/model/r4/FHIRUtils"],function(r,t){"use strict";var e=r.extend("sap.fhir.model.r4.type.Uri",{constructor:function(t,e){r.apply(this,arguments)}});e.prototype.getName=function(){return"sap.fhir.model.r4.type.Uuid"};e.prototype.toString=function(){return"uuid"};e.prototype.validateValue=function(r){return t.checkRegularExpression(r,/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i)};return e});
