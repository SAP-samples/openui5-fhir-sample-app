/*
 * ! OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Control","sap/m/Toolbar","sap/m/Button","sap/m/ResponsivePopover","sap/m/ToolbarSpacer","sap/ui/dom/containsOrEquals"],function(t,e,o,i,r,a){"use strict";var n=t.extend("sap.m.ColumnHeaderPopover",{library:"sap.m",metadata:{properties:{},aggregations:{items:{type:"sap.m.ColumnPopoverItem",multiple:true,singularName:"item",bindable:true},_popover:{type:"sap.m.ResponsivePopover",multiple:false,visibility:"hidden"}},defaultAggregation:"items",associations:{ariaLabelledBy:{type:"sap.ui.core.Control",multiple:true,singularName:"ariaLabelledBy"}}}});n.prototype.init=function(){this._bPopoverCreated=false;this._oShownCustomContent=null;var t=this;this._minWidthDelegate=function(){this.$().css("min-width",t.minWidth)}};n.prototype.exit=function(){if(this._oToolbar){this._oToolbar.destroy();this._oToolbar=null}this._closeBtn=null;this._spacer=null;this._aButtons=null;this._oShownCustomContent=null};n.prototype._createPopover=function(){var t=this;this._oShownCustomContent=null;var a=sap.ui.getCore().getLibraryResourceBundle("sap.m"),n=a.getText("COLUMNHEADERPOPOVER_CLOSE_BUTTON");var s=new i(this.getId()+"-popover",{showArrow:false,showHeader:false,placement:"Bottom",verticalScrolling:true,horizontalScrolling:false,ariaLabelledBy:this.getAriaLabelledBy(),beforeClose:function(e){if(t._oShownCustomContent){t._oShownCustomContent.setVisible(false);t._oShownCustomContent=null}t._cleanSelection()}});s._oControl.addDelegate({onAfterRendering:this._minWidthDelegate},s._oControl);this.setAggregation("_popover",s);var l=new e(this.getId()+"-tb");this._spacer=new r;this._closeBtn=new o(l.getId()+"-closeBtn",{type:"Transparent",icon:"sap-icon://decline",tooltip:n,press:[s.close,s]});l.addContent(this._spacer);l.addContent(this._closeBtn);s.addContent(l);this._oToolbar=l};n.prototype._cleanSelection=function(t){var e=this._aButtons;if(e){e.forEach(function(e){if((!t||e!==t)&&e.getPressed&&e.getPressed()){e.setPressed(false)}})}};n.prototype.openBy=function(t){if(!this._bPopoverCreated){this._createPopover();this._bPopoverCreated=true}else{this._oToolbar.removeContent(this._spacer);this._oToolbar.removeContent(this._closeBtn);this._oToolbar.destroyContent()}var e=this.getAggregation("_popover");var o=[];var i=this.getItems();var r=5;for(var a=0;a<i.length&&o.length<r;a++){var n=i[a];if(n.getVisible()){var s=n._createButton(this._oToolbar.getId()+"-btn_"+a,this);s._sContentId=n._sContentId;o.push(s);this._oToolbar.insertContent(s,a)}}if(o.length===0){return}this._aButtons=o;this._oToolbar.addContent(this._spacer);this._oToolbar.addContent(this._closeBtn);if(!this._bAppendedToUIArea&&!this.getParent()){var l=sap.ui.getCore().getStaticAreaRef();l=sap.ui.getCore().getUIArea(l);l.addContent(this,true);this._bAppendedToUIArea=true}var p=t.getFocusDomRef();if(p){e.setOffsetY(-p.clientHeight);this.minWidth=p.clientWidth}e.openBy(t)};n.prototype.invalidate=function(e){var o=this.getAggregation("_popover");if(e===o){t.prototype.invalidate.apply(this,arguments)}return this};n.prototype.addAriaLabelledBy=function(t){var e=this.getAggregation("_popover");if(e){e.addAriaLabelledBy(t)}return this.addAssociation("ariaLabelledBy",t)};n.prototype.removeAriaLabelledBy=function(t){var e=this.getAggregation("_popover");if(e){e.removeAriaLabelledBy(t)}return this.removeAssociation("ariaLabelledBy",t)};n.prototype.removeAllAssociation=function(e,o){if(e==="ariaLabelledBy"){var i=this.getAggregation("_popover");if(i){i.removeAllAssociation(e,o)}}return t.prototype.removeAllAssociation.apply(this,arguments)};return n});