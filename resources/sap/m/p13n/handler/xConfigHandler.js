/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/p13n/Engine","sap/m/p13n/modules/xConfigAPI"],function(e,t){"use strict";var n={};var a=function(e,t){var n=function(t){if(e._pQueue===t){delete e._pQueue}};e._pQueue=e._pQueue instanceof Promise?e._pQueue.then(t):t();e._pQueue.then(n.bind(null,e._pQueue));return e._pQueue};function r(t,n){if(t.isA){e.getInstance().trace(t,{selectorElement:t,changeSpecificData:{changeType:n.getChangeType(),content:n.getContent()}});if(!t._pPendingModification){t._pPendingModification=e.getInstance().waitForChanges(t).then(function(){e.getInstance().fireStateChange(t);e.getInstance().clearTrace(t);delete t._pPendingModification})}}}function g(e){const t=["add","remove","move","set"];return t.find(t=>e.indexOf(t)===0)}function o(e){const t={add:"remove",remove:"add",move:"move",set:"set"};const n=g(e);return t[n]}n.createHandler=function(t){if(!t||!t.hasOwnProperty("property")){throw new Error("Please provide a map containing the affected aggregation and property name!")}var n=t.property;var i;return{changeHandler:{applyChange:function(o,u,c){return a(u,function(){return e.getInstance().readXConfig(u,{propertyBag:c}).then(function(a){var r=g(o.getChangeType());i=o.getContent().targetAggregation;var p={key:o.getContent().key};if(r!=="set"){p.value=r!=="add"}else{p.value=null}var f=e.getInstance().getController(u,o.getChangeType());var s=f?.getCurrentState(),d;if(s&&s instanceof Array){d=s.find(function(e,t){return e.key===o.getContent().key})}p.targetAggregation=o.getContent().targetAggregation;if(d){p.index=s.indexOf(d)}if(a&&a.aggregations&&a.aggregations[i]&&a.aggregations[i][o.getContent().key]&&a.aggregations[i][o.getContent().key][n]){p.value=a.aggregations[i][o.getContent().key][n]}o.setRevertData(p);var y={property:n,key:o.getContent().key,value:o.getContent(),operation:r,changeType:o.getChangeType(),propertyBag:c,markAsModified:true};if(t.aggregationBased){y.controlMeta={aggregation:i}}return e.getInstance().enhanceXConfig(u,y)}).then(function(){r(u,o)})})},completeChangeContent:function(e,t,n){},revertChange:function(a,g,u){var c=o(a.getChangeType());i=a.getContent().targetAggregation;var p={controlMeta:{aggregation:i,property:n},property:n,operation:c,changeType:a.getChangeType(),key:a.getRevertData().key,value:a.getRevertData(),propertyBag:u};if(t.aggregationBased){p.controlMeta={aggregation:i}}return e.getInstance().enhanceXConfig(g,p).then(function(){a.resetRevertData();r(g,a)})}},layers:{USER:true}}};return n});
//# sourceMappingURL=xConfigHandler.js.map